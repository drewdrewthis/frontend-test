"use strict";function getData(e){return $.ajax({dataType:"json",url:"https://www.deskbookers.com/nl-nl/sajax.json?q=Amsterdam&type=-&people=any&favorite=0&pid=&sw=52.293753%2C4.634942&ne=52.455562%2C5.162286&ids=17201%2C19640%2C13692%2C13691%2C12136%2C17938%2C15292%2C14886%2C14885%2C14884%2C14883%2C15730%2C15353%2C15351%2C15330%2C15080%2C17290%2C15454%2C15451%2C15379"})}function setDimensionsForResponsiveElements(){}function createCarousel(e,a){function t(){var e='\n            <div class="control-wrapper left">\n                <div class="control left-control">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                </div>\n            </div>\n            <div class="control-wrapper right">\n                <div class="control right-control">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                </div>\n            </div>\n        ';n.append(e),n.find(".right-control").on("click",function(){n.nextImage()}),n.find(".left-control").on("click",function(){n.prevImage()})}var n=$(e);return n.current_image_index=0,n.images=a,n.goToImage=function(e){$(".carousel-item").fadeOut(2e3),$('.carousel-item[data-id="'+e+'"]').fadeIn(2e3),0===n.images.length?n.find(".control").hide():n.find(".control").show()},n.updateSlides=function(e,a){n.images=e,n.find("ul").html(""),e.forEach(function(e,t){"string"==typeof e&&n.find("ul").append('<li \n                    id="image-'+t+'" \n                    data-id="'+t+'" \n                    class="carousel-item" \n                    style="background-image:url(\''+e+'\')">\n                        <h1 class="headline">'+(a[t]||"Headline #"+(t+1))+"</h1>\n                    </li>\n                ")}),n.goToImage(0)},n.nextImage=function(){n.images[n.current_image_index+1]?n.goToImage(++n.current_image_index):(n.goToImage(0),n.current_image_index=0)},n.prevImage=function(){n.images[n.current_image_index-1]?n.goToImage(--n.current_image_index):(n.goToImage(n.images.length-1),n.current_image_index=n.images.length-1)},t(),n.append("<ul></ul>"),n.updateSlides(a,["Fast, Easy, Flexible","Book one of our spaces"]),setInterval(function(){n.is(":hover")||n.nextImage()},6e3),n}function updateResults(e){console.log("Update Results",e),e.map(function(e,a){var t=e.points[0].latitude,n=e.points[0].longitude,o=e.url,i=e.name,r=e.location_name,s=e.rating||"-",l=e.day_price?"$"+e.day_price+"/day":"",c=e.image_urls2[0];$(".results-list").append('<li \n            id="location-'+a+'" \n            class="result-item" \n            style="background-image:url(\''+c+'\'); display: none;">\n                <a href="'+(o||"#")+'">\n                    <ul class="location-info">\n                        <li>'+i+"</li>\n                        <li>"+r+"</li>\n                        <li>Score: "+s+"</li>\n                        <li>"+l+"</li>\n                    </ul>\n                </a>\n            </li>"),$("#location-"+a).fadeIn(1e3*a),app.components.map.setMarker&&app.components.map.setMarker(r,t,n)})}function revealResultsArea(){$("html, body").animate({scrollTop:$(".results-section").height()},1e3)}function createResultsArea(){return{update:updateResults,scrollTo:revealResultsArea}}function initialize(){var e=new google.maps.LatLng(52.305584,4.949819),a={zoom:8,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),a),google.maps.event.addDomListener(window,"load",initialize)}function setMarker(e,a,t){var n=new google.maps.LatLng(a,t),o=new google.maps.Marker({position:n,map:map,title:e});return o}function updateMap(e,a){var t=new google.maps.LatLng(e,a);map.setCenter(t)}function createSearchList(e){var a={},t=e.reduce(function(e,a){return e.concat([a.name,a.location_name,a.location_city])},[]).filter(function(e){return!a[e]&&(a[e]=!0,!0)});return t.sort(function(e,a){return e.localeCompare(a)}),t}function predictSearch(e){var a=app.model.location_names.filter(function(a){return a.toLowerCase().includes(e.toLowerCase())});fillPredictor(".predictive-results",a.slice(0,5))}function fillPredictor(e,a){var t=$(e);t.html(""),t.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="All">Search all locations..</li>');var n=!0,o=!1,i=void 0;try{for(var r,s=a[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;t.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="'+l+'">'+l+"</li>")}}catch(c){o=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw i}}$(".predictive-item").on("click",function(){var e=$(this).data("name");"All"===e?($('#location-search-form input[type="text"]').val(""),processSearch(),revealResultsArea(),$(".predictive-box").hide()):($('#location-search-form input[type="text"]').val(e),$(".predictive-box").hide())})}function createResultsList(e){var a=app.model.raw_data.rows;if(!e)return a;var t=a.filter(function(a){return a.name===e||a.location_name===e||a.location_city===e});return t}function processSearch(e){$(".results-list").html(""),$(".results-section .loader").show(),$('#location-search-form input[type="text"]').val(""),$.when(getData(e)).then(function(a){app.model.locations=createResultsList(e),app.results_area.update(app.model.locations),$(".results-section .loader").fadeOut()})}function setEventHandlers(){$("#location-search-form").submit(function(e){var a=$('input[type="text"]').val();e.preventDefault(),a&&(processSearch(a),$('input[type="text"]').val(""),revealResultsArea())}),$('#location-search-form input[type="text"]').focus(function(){$('#location-search-form input[type="text"]').keyup(function(e){var a=$('#location-search-form input[type="text"]').val();predictSearch(a),$(".predictive-box").show()})}),$('#location-search-form input[type="text"]').focusout(function(){$(".predictive-box").is(":hover")||$(".predictive-box").hide()}),$(".predictive-item").on("click",function(){$(".predictive-results").html(""),$(this).data("name"),$(".predictive-box").hide()})}var max_results=20,maps_key="AIzaSyD6_xJymcFN1dZJUZAQiQ81lprzaZFXnWM",app={model:{raw_data:void 0,locations:void 0,location_names:void 0},components:{main_carousel:void 0,results_area:void 0,map:{map:null,center:{lat:null,lng:null},update:null,setMarker:null}},init:function(){if(sessionStorage.getItem("location_data")){var e=sessionStorage.getItem("location_data");app.model.raw_data=JSON.parse(e),console.log("Data from session storate",app.model.raw_data),app.setUp()}else $(".loader").show(),app.setData()},setData:function(){$.when(getData()).then(function(e){console.log("Retrieved data",e),sessionStorage.setItem("location_data",JSON.stringify(e)),app.model.raw_data=e,app.setUp(),$(".loader").fadeOut()})},setUp:function(){app.model.locations=app.model.raw_data.rows;var e=app.model.locations.slice(0,Math.min(max_results,app.model.locations.length-1)),a=app.model.locations.reduce(function(e,a){return e.concat(a.image_urls)},[]);$(document).ready(function(){app.model.location_names=createSearchList(app.model.raw_data.rows),console.log("Location Names",app.model.location_names),app.components.main_carousel=createCarousel("carousel",a),app.results_area=createResultsArea(),app.results_area.update(e),$(".search-box").show(),setEventHandlers(),setDimensionsForResponsiveElements()})}};app.init(),$(window).resize(function(){setDimensionsForResponsiveElements()});var map,marker;app.components.map.map=map,app.components.map.setMarker=setMarker,app.components.map.update=updateMap;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJjcmVhdGVDYXJvdXNlbC5qcyIsImNyZWF0ZVJlc3VsdHNBcmVhLmpzIiwibWFwLmpzIiwic2VhcmNoX2Z1bmN0aW9ucy5qcyIsInNldEV2ZW50SGFuZGxlcnMuanMiXSwibmFtZXMiOlsiZ2V0RGF0YSIsInNlYXJjaF9pbnF1aXJ5IiwiJCIsImFqYXgiLCJkYXRhVHlwZSIsInVybCIsInNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMiLCJjcmVhdGVDYXJvdXNlbCIsImVsZW1lbnQiLCJpbWFnZV9hcnIiLCJjcmVhdGVDb250cm9scyIsInRlbXBsYXRlIiwiJGNhcm91c2VsIiwiYXBwZW5kIiwiZmluZCIsIm9uIiwibmV4dEltYWdlIiwicHJldkltYWdlIiwiY3VycmVudF9pbWFnZV9pbmRleCIsImltYWdlcyIsImdvVG9JbWFnZSIsImluZGV4IiwiZmFkZU91dCIsImZhZGVJbiIsImxlbmd0aCIsImhpZGUiLCJzaG93IiwidXBkYXRlU2xpZGVzIiwic2xpZGVzIiwiaGVhZGxpbmVzIiwiaHRtbCIsImZvckVhY2giLCJzZXRJbnRlcnZhbCIsImlzIiwidXBkYXRlUmVzdWx0cyIsImxvY2F0aW9ucyIsImNvbnNvbGUiLCJsb2ciLCJtYXAiLCJsb2NhdGlvbiIsImxhdCIsInBvaW50cyIsImxhdGl0dWRlIiwibG5nIiwibG9uZ2l0dWRlIiwibG9jYXRpb25fdXJsIiwid29ya3BsYWNlIiwibmFtZSIsImxvY2F0aW9uX25hbWUiLCJyZXZpZXdfc2NvcmUiLCJyYXRpbmciLCJwcmljZSIsImRheV9wcmljZSIsImltYWdlX3VybCIsImltYWdlX3VybHMyIiwiYXBwIiwiY29tcG9uZW50cyIsInNldE1hcmtlciIsInJldmVhbFJlc3VsdHNBcmVhIiwiYW5pbWF0ZSIsInNjcm9sbFRvcCIsImhlaWdodCIsImNyZWF0ZVJlc3VsdHNBcmVhIiwidXBkYXRlIiwic2Nyb2xsVG8iLCJpbml0aWFsaXplIiwibXlMYXRMbmciLCJnb29nbGUiLCJtYXBzIiwiTGF0TG5nIiwibXlPcHRpb25zIiwiem9vbSIsImNlbnRlciIsIm1hcFR5cGVJZCIsIk1hcFR5cGVJZCIsIlJPQURNQVAiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZXZlbnQiLCJhZGREb21MaXN0ZW5lciIsIndpbmRvdyIsInRpdGxlIiwibWFya2VyIiwiTWFya2VyIiwicG9zaXRpb24iLCJ1cGRhdGVNYXAiLCJuZXdMYXRMbmciLCJzZXRDZW50ZXIiLCJjcmVhdGVTZWFyY2hMaXN0IiwicGxhY2VfaGFzaCIsImxvY2F0aW9uX25hbWVzIiwicmVkdWNlIiwiYWxsX25hbWVzIiwiY29uY2F0IiwibG9jYXRpb25fY2l0eSIsImZpbHRlciIsIml0ZW0iLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwicHJlZGljdFNlYXJjaCIsInN0ciIsImxpc3QiLCJtb2RlbCIsInBsYWNlIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImZpbGxQcmVkaWN0b3IiLCJzbGljZSIsIiRwcmVkaWN0b3IiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsInVuZGVmaW5lZCIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInZhbHVlIiwiZXJyIiwidGhpcyIsImRhdGEiLCJ2YWwiLCJwcm9jZXNzU2VhcmNoIiwiY3JlYXRlUmVzdWx0c0xpc3QiLCJyYXdfZGF0YSIsInJvd3MiLCJyZXN1bHRzIiwid2hlbiIsInRoZW4iLCJyZXN1bHRzX2FyZWEiLCJzZXRFdmVudEhhbmRsZXJzIiwic3VibWl0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiZm9jdXMiLCJrZXl1cCIsImZvY3Vzb3V0IiwibWF4X3Jlc3VsdHMiLCJtYXBzX2tleSIsIm1haW5fY2Fyb3VzZWwiLCJpbml0Iiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiZGF0YVN0cmluZyIsIkpTT04iLCJwYXJzZSIsInNldFVwIiwic2V0RGF0YSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJNYXRoIiwibWluIiwibWFpbl9pbWFnZXMiLCJhbGxfaW1hZ2VzIiwiaW1hZ2VfdXJscyIsInJlYWR5IiwicmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUtBLFNBQVNBLFNBQVFDLEdBR2IsTUFBT0MsR0FBRUMsTUFDTEMsU0FBVSxPQUNWQyxJQUFLLGlUQUliLFFBQVNDLHVDQ2RULFFBQVNDLGdCQUFlQyxFQUFTQyxHQU03QixRQUFTQyxLQUNMLEdBQUlDLEdBQUFBLHFjQWFKQyxHQUFVQyxPQUFPRixHQUVqQkMsRUFBVUUsS0FBSyxrQkFBa0JDLEdBQUcsUUFBUyxXQUN6Q0gsRUFBVUksY0FHZEosRUFBVUUsS0FBSyxpQkFBaUJDLEdBQUcsUUFBUyxXQUN4Q0gsRUFBVUssY0F6QmxCLEdBQUlMLEdBQVlWLEVBQUVNLEVBa0dsQixPQWpHQUksR0FBVU0sb0JBQXNCLEVBQ2hDTixFQUFVTyxPQUFTVixFQTJCbkJHLEVBQVVRLFVBQVksU0FBU0MsR0FDM0JuQixFQUFFLGtCQUFrQm9CLFFBQVEsS0FDNUJwQixFQUFBQSwyQkFBNkJtQixFQUE3QixNQUF3Q0UsT0FBTyxLQUVmLElBQTVCWCxFQUFVTyxPQUFPSyxPQUNqQlosRUFBVUUsS0FBSyxZQUFZVyxPQWEzQmIsRUFBVUUsS0FBSyxZQUFZWSxRQUluQ2QsRUFBVWUsYUFBZSxTQUFTQyxFQUFRQyxHQUN0Q2pCLEVBQVVPLE9BQVNTLEVBQ25CaEIsRUFBVUUsS0FBSyxNQUFNZ0IsS0FBSyxJQUMxQkYsRUFBT0csUUFBUSxTQUFTMUIsRUFBS2dCLEdBQ04sZ0JBQVJoQixJQUNQTyxFQUFVRSxLQUFLLE1BQU1ELE9BQXJCLHVDQUNnQlEsRUFEaEIsb0NBRWVBLEVBRmYscUdBSW1DaEIsRUFKbkMsd0RBSytCd0IsRUFBVVIsSUFBVSxjQUFnQkEsRUFBTSxJQUx6RSx3REFXUlQsRUFBVVEsVUFBVSxJQUd4QlIsRUFBVUksVUFBWSxXQUNkSixFQUFVTyxPQUFPUCxFQUFV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QUNBNkMsTUFnQ0o1QixLQUFJQyxXQUFXbEIsSUFBSUEsSUFBTUEsSUFDekJpQixJQUFJQyxXQUFXbEIsSUFBSW1CLFVBQVlBLFVBQy9CRixJQUFJQyxXQUFXbEIsSUFBSXlCLE9BQVN1QiIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWF4X3Jlc3VsdHMgPSAyMDtcbmNvbnN0IG1hcHNfa2V5ID0gJ0FJemFTeUQ2X3hKeW1jRk4xZFpKVVpBUWlRODFscHJ6YVpGWG5XTSc7XG5cbmZ1bmN0aW9uIGdldERhdGEoc2VhcmNoX2lucXVpcnkpIHtcbiAgICAvLyBTZWFyY2ggaW5xdWlyeSB3b3VsZCBiZSB1c2VkIHRvIGdldCBzcGVjaWZpYyByZXN1bHRzIGZyb20gQVBJXG4gICAgLy8gRm9yIHRoaXMgY2hhbGxlbmdlLCBvbmx5IHVzaW5nIHNwZWNpZmllZCBxdWVyeSBzdHJpbmcgYmVsb3c6XG4gICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly93d3cuZGVza2Jvb2tlcnMuY29tL25sLW5sL3NhamF4Lmpzb24/cT1BbXN0ZXJkYW0mdHlwZT0tJnBlb3BsZT1hbnkmZmF2b3JpdGU9MCZwaWQ9JnN3PTUyLjI5Mzc1MyUyQzQuNjM0OTQyJm5lPTUyLjQ1NTU2MiUyQzUuMTYyMjg2Jmlkcz0xNzIwMSUyQzE5NjQwJTJDMTM2OTIlMkMxMzY5MSUyQzEyMTM2JTJDMTc5MzglMkMxNTI5MiUyQzE0ODg2JTJDMTQ4ODUlMkMxNDg4NCUyQzE0ODgzJTJDMTU3MzAlMkMxNTM1MyUyQzE1MzUxJTJDMTUzMzAlMkMxNTA4MCUyQzE3MjkwJTJDMTU0NTQlMkMxNTQ1MSUyQzE1Mzc5J1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCkge1xuICAgIC8vJCgndWwucmVzdWx0cy1saXN0JykuY3NzKCd3aWR0aCcsIHdpbmRvdy5pbm5lcldpZHRoIC8gNSAqICQoJy5yZXN1bHQtaXRlbScpLmxlbmd0aCArICdweCcpO1xufVxuXG52YXIgYXBwID0ge1xuICAgIC8vIEluaXRpYWxpemUgdGhlIGFwcFxuICAgIC8vIFRoaXMgbGF5cyBvdXQgdGhlIHN0cnVjdHVyZVxuICAgIG1vZGVsOiB7XG4gICAgICAgIHJhd19kYXRhOiB1bmRlZmluZWQsIC8vQWxsIGRhdGEgZnJvbSBzZXJ2ZXJcbiAgICAgICAgbG9jYXRpb25zOiB1bmRlZmluZWQsIC8vQ3VycmVudCByZXN1bHQgZGF0YVxuICAgICAgICBsb2NhdGlvbl9uYW1lczogdW5kZWZpbmVkIC8vUG9zc2libGUgc2VhcmNoIHJlc3VsdHNcbiAgICB9LFxuICAgIGNvbXBvbmVudHM6IHtcbiAgICAgICAgbWFpbl9jYXJvdXNlbDogdW5kZWZpbmVkLFxuICAgICAgICByZXN1bHRzX2FyZWE6IHVuZGVmaW5lZCxcbiAgICAgICAgbWFwOiB7XG4gICAgICAgICAgICBtYXA6IG51bGwsXG4gICAgICAgICAgICBjZW50ZXI6IHtcbiAgICAgICAgICAgICAgICBsYXQ6IG51bGwsXG4gICAgICAgICAgICAgICAgbG5nOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiBudWxsLFxuICAgICAgICAgICAgc2V0TWFya2VyOiBudWxsXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBVc2Ugc2Vzc2lvbiBzdG9yYWdlIGlmIGF2YWlsYWJsZVxuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbG9jYXRpb25fZGF0YScpKSB7XG4gICAgICAgICAgICBsZXQgZGF0YVN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2xvY2F0aW9uX2RhdGEnKTtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5yYXdfZGF0YSA9IEpTT04ucGFyc2UoZGF0YVN0cmluZyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YSBmcm9tIHNlc3Npb24gc3RvcmF0ZScsIGFwcC5tb2RlbC5yYXdfZGF0YSk7XG4gICAgICAgICAgICBhcHAuc2V0VXAoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJy5sb2FkZXInKS5zaG93KCk7XG4gICAgICAgICAgICBhcHAuc2V0RGF0YSgpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyBHZXQgYW5kIHNldCBkYXRhIGZyb20gdGhlIEFQSVxuICAgIHNldERhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAkLndoZW4oZ2V0RGF0YSgpKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXRyaWV2ZWQgZGF0YScsIGRhdGEpO1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnbG9jYXRpb25fZGF0YScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5yYXdfZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICBhcHAuc2V0VXAoKTtcbiAgICAgICAgICAgICQoJy5sb2FkZXInKS5mYWRlT3V0KCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgLy8gU2V0IHVwIHZpZXdzXG4gICAgc2V0VXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBTZXQgcmVzdWx0IGRhdGEgZnJvbSBhbGwgZGF0YVxuICAgICAgICBhcHAubW9kZWwubG9jYXRpb25zID0gYXBwLm1vZGVsLnJhd19kYXRhLnJvd3M7XG4gICAgICAgIHZhciBsb2NhdGlvbnMgPSBhcHAubW9kZWwubG9jYXRpb25zLnNsaWNlKDAsIE1hdGgubWluKG1heF9yZXN1bHRzLCBhcHAubW9kZWwubG9jYXRpb25zLmxlbmd0aCAtIDEpKTtcblxuICAgICAgICAvLyBUaGlzIHdhcyBpbml0aWFsbHkgc2V0IHVwIHRvIGp1c3QgaGF2ZSBhIGNhcm91c2VsIGZvciBvbmUgbG9jYXRpb25cbiAgICAgICAgLy8gdmFyIG1haW5faW1hZ2VzID0gbG9jYXRpb25zWzBdLmltYWdlX3VybHMuY29uY2F0KGxvY2F0aW9uc1swXS5pbWFnZV91cmxzMik7XG5cbiAgICAgICAgdmFyIG1haW5faW1hZ2VzID0gYXBwLm1vZGVsLmxvY2F0aW9ucy5yZWR1Y2UoZnVuY3Rpb24oYWxsX2ltYWdlcywgbG9jYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbGxfaW1hZ2VzLmNvbmNhdChsb2NhdGlvbi5pbWFnZV91cmxzKTtcbiAgICAgICAgfSwgW10pO1xuXG4gICAgICAgIC8vIFdhaXQgZm9yIHRoZSBkb2N1bWV0IHJlYWR5IGJlZm9yZSBidWlsZGluZyB2aWV3c1xuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbl9uYW1lcyA9IGNyZWF0ZVNlYXJjaExpc3QoYXBwLm1vZGVsLnJhd19kYXRhLnJvd3MpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvY2F0aW9uIE5hbWVzJywgYXBwLm1vZGVsLmxvY2F0aW9uX25hbWVzKTtcblxuICAgICAgICAgICAgYXBwLmNvbXBvbmVudHMubWFpbl9jYXJvdXNlbCA9IGNyZWF0ZUNhcm91c2VsKCdjYXJvdXNlbCcsIG1haW5faW1hZ2VzKTtcbiAgICAgICAgICAgIGFwcC5yZXN1bHRzX2FyZWEgPSBjcmVhdGVSZXN1bHRzQXJlYSgpO1xuICAgICAgICAgICAgYXBwLnJlc3VsdHNfYXJlYS51cGRhdGUobG9jYXRpb25zKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJCgnLnNlYXJjaC1ib3gnKS5zaG93KCk7XG4gICAgICAgICAgICBzZXRFdmVudEhhbmRsZXJzKCk7XG4gICAgICAgICAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7IFxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8vIFN0YXJ0IHByb2Nlc3NcbmFwcC5pbml0KCk7XG4kKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbn0pOyIsImZ1bmN0aW9uIGNyZWF0ZUNhcm91c2VsKGVsZW1lbnQsIGltYWdlX2Fycikge1xuXG4gICAgdmFyICRjYXJvdXNlbCA9ICQoZWxlbWVudCk7XG4gICAgJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPSAwOyAvLyBcbiAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gaW1hZ2VfYXJyO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ29udHJvbHMoKSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sLXdyYXBwZXIgbGVmdFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIGxlZnQtY29udHJvbFwiPlxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWNoZXZyb24tbGVmdFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wtd3JhcHBlciByaWdodFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIHJpZ2h0LWNvbnRyb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1jaGV2cm9uLXJpZ2h0XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgJGNhcm91c2VsLmFwcGVuZCh0ZW1wbGF0ZSk7XG5cbiAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwubmV4dEltYWdlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwucHJldkltYWdlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAkKCcuY2Fyb3VzZWwtaXRlbScpLmZhZGVPdXQoMjAwMCk7XG4gICAgICAgICQoYC5jYXJvdXNlbC1pdGVtW2RhdGEtaWQ9XCIke2luZGV4fVwiXWApLmZhZGVJbigyMDAwKTtcblxuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICAvKlxuICAgICAgICAvLyBVbm5lY2Vzc2FyeSB3aXRoIG5ldyBsb29waW5nIGZlYXR1cmVcbiAgICAgICAgZWxzZSBpZiAoJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICB9IGVsc2UgaWYgKCRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID09PSAkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICB9IFxuICAgICAgICAqL1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLnNob3coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC51cGRhdGVTbGlkZXMgPSBmdW5jdGlvbihzbGlkZXMsIGhlYWRsaW5lcykge1xuICAgICAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gc2xpZGVzO1xuICAgICAgICAkY2Fyb3VzZWwuZmluZCgndWwnKS5odG1sKFwiXCIpO1xuICAgICAgICBzbGlkZXMuZm9yRWFjaChmdW5jdGlvbih1cmwsIGluZGV4KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHsgLy8gVHlwZSBjaGVja1xuICAgICAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCd1bCcpLmFwcGVuZChgPGxpIFxuICAgICAgICAgICAgICAgICAgICBpZD1cImltYWdlLSR7aW5kZXh9XCIgXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCIke2luZGV4fVwiIFxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImNhcm91c2VsLWl0ZW1cIiBcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHt1cmx9JylcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzcz1cImhlYWRsaW5lXCI+JHtoZWFkbGluZXNbaW5kZXhdIHx8IFwiSGVhZGxpbmUgI1wiICsgKGluZGV4KzEpfTwvaDE+XG4gICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoMCk7XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLm5leHRJbWFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlc1skY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCArIDFdKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKCsrJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTG9vcFxuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgwKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC5wcmV2SW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRjYXJvdXNlbC5pbWFnZXNbJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggLSAxXSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgtLSRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIExvb3BcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY3JlYXRlQ29udHJvbHMoKTtcbiAgICAkY2Fyb3VzZWwuYXBwZW5kKCc8dWw+PC91bD4nKTtcbiAgICAkY2Fyb3VzZWwudXBkYXRlU2xpZGVzKGltYWdlX2FyciwgW1wiRmFzdCwgRWFzeSwgRmxleGlibGVcIiwgXCJCb29rIG9uZSBvZiBvdXIgc3BhY2VzXCJdKTtcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkY2Fyb3VzZWwuaXMoXCI6aG92ZXJcIikpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5uZXh0SW1hZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sIDYwMDApO1xuICAgIHJldHVybiAkY2Fyb3VzZWw7XG59IiwiZnVuY3Rpb24gdXBkYXRlUmVzdWx0cyhsb2NhdGlvbnMpIHtcbiAgICAvLyBGaWxsIHJlc3VsdHMgZGl2XG4gICAgY29uc29sZS5sb2coJ1VwZGF0ZSBSZXN1bHRzJywgbG9jYXRpb25zKTtcbiAgICBsb2NhdGlvbnMubWFwKGZ1bmN0aW9uKGxvY2F0aW9uLCBpbmRleCkge1xuICAgICAgICBsZXQgbGF0ID0gbG9jYXRpb24ucG9pbnRzWzBdLmxhdGl0dWRlO1xuICAgICAgICBsZXQgbG5nID0gbG9jYXRpb24ucG9pbnRzWzBdLmxvbmdpdHVkZTtcbiAgICAgICAgbGV0IGxvY2F0aW9uX3VybCA9IGxvY2F0aW9uLnVybDtcbiAgICAgICAgbGV0IHdvcmtwbGFjZSA9IGxvY2F0aW9uLm5hbWU7XG4gICAgICAgIGxldCBsb2NhdGlvbl9uYW1lID0gbG9jYXRpb24ubG9jYXRpb25fbmFtZTtcbiAgICAgICAgbGV0IHJldmlld19zY29yZSA9IGxvY2F0aW9uLnJhdGluZyB8fCBcIi1cIjtcbiAgICAgICAgbGV0IHByaWNlID0gKGxvY2F0aW9uLmRheV9wcmljZSkgPyAnJCcgKyBsb2NhdGlvbi5kYXlfcHJpY2UgKyBcIi9kYXlcIiA6IFwiXCI7XG4gICAgICAgIGxldCBpbWFnZV91cmwgPSBsb2NhdGlvbi5pbWFnZV91cmxzMlswXTsgLy8gVXNlIHNtYWxsZXIgdGh1bWJzXG5cbiAgICAgICAgJCgnLnJlc3VsdHMtbGlzdCcpLmFwcGVuZChgPGxpIFxuICAgICAgICAgICAgaWQ9XCJsb2NhdGlvbi0ke2luZGV4fVwiIFxuICAgICAgICAgICAgY2xhc3M9XCJyZXN1bHQtaXRlbVwiIFxuICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHtpbWFnZV91cmx9Jyk7IGRpc3BsYXk6IG5vbmU7XCI+XG4gICAgICAgICAgICAgICAgPGEgaHJlZj1cIiR7bG9jYXRpb25fdXJsIHx8IFwiI1wifVwiPlxuICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9XCJsb2NhdGlvbi1pbmZvXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHt3b3JrcGxhY2V9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4ke2xvY2F0aW9uX25hbWV9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5TY29yZTogJHtyZXZpZXdfc2NvcmV9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4ke3ByaWNlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgPC9saT5gKTtcbiAgICAgICAgJCgnI2xvY2F0aW9uLScraW5kZXgpLmZhZGVJbigxMDAwICogaW5kZXgpOyAvLyBDcmVhdGVzIGNvb2wgcHJvZ3Jlc3NpdmUgZmFkZSBpblxuICAgICAgICBcbiAgICAgICAgaWYoYXBwLmNvbXBvbmVudHMubWFwLnNldE1hcmtlcikge1xuICAgICAgICAgICAgYXBwLmNvbXBvbmVudHMubWFwLnNldE1hcmtlcihsb2NhdGlvbl9uYW1lLGxhdCxsbmcpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldmVhbFJlc3VsdHNBcmVhKCkge1xuICAgIC8vIFNjcm9sbCBkb3duIHRvIGRpc3BsYXkgcmVzdWx0c1xuICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiAkKFwiLnJlc3VsdHMtc2VjdGlvblwiKS5oZWlnaHQoKVxuICAgICB9LCAxMDAwKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVzdWx0c0FyZWEoKSB7XG5cdHJldHVybiB7XG5cdFx0dXBkYXRlOiB1cGRhdGVSZXN1bHRzLFxuXHRcdHNjcm9sbFRvOiByZXZlYWxSZXN1bHRzQXJlYVxuXHR9XG59IiwidmFyIG1hcDtcbnZhciBtYXJrZXI7XG5cbmZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgbGV0IG15TGF0TG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyg1Mi4zMDU1ODQsIDQuOTQ5ODE5KTtcbiAgICBsZXQgbXlPcHRpb25zID0ge1xuICAgICAgICB6b29tOiA4LFxuICAgICAgICBjZW50ZXI6IG15TGF0TG5nLFxuICAgICAgICBtYXBUeXBlSWQ6IGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQLFxuICAgIH1cblxuICAgIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCBteU9wdGlvbnMpO1xuXG4gICAgLy8gT25sb2FkIGhhbmRsZXIgdG8gZmlyZSBvZmYgdGhlIGFwcC5cbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGREb21MaXN0ZW5lcih3aW5kb3csICdsb2FkJywgaW5pdGlhbGl6ZSk7XG59XG5cbmZ1bmN0aW9uIHNldE1hcmtlcih0aXRsZSxsYXQsbG5nKSB7XG5cdGxldCBteUxhdExuZyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobGF0LCBsbmcpO1xuXHRsZXQgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG5cdCAgICBwb3NpdGlvbjogbXlMYXRMbmcsXG5cdCAgICBtYXA6IG1hcCxcblx0ICAgIHRpdGxlOiB0aXRsZVxuXHR9KTtcblxuXHRyZXR1cm4gbWFya2VyO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVNYXAobGF0LGxuZykge1xuICAgIHZhciBuZXdMYXRMbmcgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxhdCwgbG5nKTtcbiAgICBtYXAuc2V0Q2VudGVyKG5ld0xhdExuZyk7XG59O1xuXG5hcHAuY29tcG9uZW50cy5tYXAubWFwID0gbWFwO1xuYXBwLmNvbXBvbmVudHMubWFwLnNldE1hcmtlciA9IHNldE1hcmtlcjtcbmFwcC5jb21wb25lbnRzLm1hcC51cGRhdGUgPSB1cGRhdGVNYXA7IiwiZnVuY3Rpb24gY3JlYXRlU2VhcmNoTGlzdChsb2NhdGlvbnMpIHtcbiAgICBsZXQgcGxhY2VfaGFzaCA9IHt9O1xuICAgIC8vIENyZWF0ZSBhIGxpc3Qgb2YgcGxhY2VzIHRvIHNlYXJjaFxuICAgIGxldCBsb2NhdGlvbl9uYW1lcyA9IGxvY2F0aW9ucy5yZWR1Y2UoZnVuY3Rpb24oYWxsX25hbWVzLCBsb2NhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGFsbF9uYW1lcy5jb25jYXQoW2xvY2F0aW9uLm5hbWUsIGxvY2F0aW9uLmxvY2F0aW9uX25hbWUsIGxvY2F0aW9uLmxvY2F0aW9uX2NpdHldKTtcbiAgICAgICAgfSwgW10pXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgaWYgKCFwbGFjZV9oYXNoW2l0ZW1dKSB7XG4gICAgICAgICAgICAgICAgcGxhY2VfaGFzaFtpdGVtXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAvLyBTb3J0IGxpc3QgYW5kIHJldHVyblxuICAgIGxvY2F0aW9uX25hbWVzLnNvcnQoKGEsIGIpID0+IGEubG9jYWxlQ29tcGFyZShiKSk7XG4gICAgcmV0dXJuIGxvY2F0aW9uX25hbWVzO1xufVxuXG5mdW5jdGlvbiBwcmVkaWN0U2VhcmNoKHN0cikge1xuICAgIC8vIFByZWRpY3QgYnkgbG9jYXRpb24gbmFtZVxuICAgIC8vIEZpbHRlciBsaXN0IGJ5IGlucHV0IHN0cmluZ1xuICAgIGxldCBsaXN0ID0gYXBwLm1vZGVsLmxvY2F0aW9uX25hbWVzLmZpbHRlcihmdW5jdGlvbihwbGFjZSkge1xuICAgICAgICByZXR1cm4gcGxhY2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzdHIudG9Mb3dlckNhc2UoKSk7XG4gICAgfSk7XG5cbiAgICAvLyBGdWxsIHByZWRpY3RvciB3aXRoIG9ubHkgdG9wIDUgcmVzdWx0c1xuICAgIGZpbGxQcmVkaWN0b3IoJy5wcmVkaWN0aXZlLXJlc3VsdHMnLCBsaXN0LnNsaWNlKDAsIDUpKTtcbn1cblxuZnVuY3Rpb24gZmlsbFByZWRpY3RvcihlbGVtZW50LCBsaXN0KSB7XG4gICAgdmFyICRwcmVkaWN0b3IgPSAkKGVsZW1lbnQpO1xuICAgICRwcmVkaWN0b3IuaHRtbChcIlwiKTtcbiAgICAkcHJlZGljdG9yLmFwcGVuZChgXG4gICAgICAgICAgICA8bGkgZGF0YS1pZD1cIlwiIFxuICAgICAgICAgICAgICAgIGNsYXNzPVwicHJlZGljdGl2ZS1pdGVtXCJcbiAgICAgICAgICAgICAgICBkYXRhLW5hbWU9XCJBbGxcIj5TZWFyY2ggYWxsIGxvY2F0aW9ucy4uPC9saT5gKTtcbiAgICBmb3IgKGxldCBsb2NhdGlvbiBvZiBsaXN0KSB7XG4gICAgICAgICRwcmVkaWN0b3IuYXBwZW5kKGBcbiAgICAgICAgICAgIDxsaSBkYXRhLWlkPVwiXCIgXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJwcmVkaWN0aXZlLWl0ZW1cIlxuICAgICAgICAgICAgICAgIGRhdGEtbmFtZT1cIiR7bG9jYXRpb259XCI+JHtsb2NhdGlvbn08L2xpPmApO1xuICAgIH1cblxuICAgIC8vIFNldCBoYW5kbGVyXG4gICAgJCgnLnByZWRpY3RpdmUtaXRlbScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBsZXQgbmFtZSA9ICQodGhpcykuZGF0YSgnbmFtZScpO1xuICAgICAgICBpZiAobmFtZSA9PT0gXCJBbGxcIikge1xuICAgICAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICAgICAgICAgcHJvY2Vzc1NlYXJjaCgpO1xuICAgICAgICAgICAgcmV2ZWFsUmVzdWx0c0FyZWEoKTtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChuYW1lKTtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlc3VsdHNMaXN0KHN0cikge1xuICAgIGxldCBsb2NhdGlvbnMgPSBhcHAubW9kZWwucmF3X2RhdGEucm93cztcbiAgICBpZiAoIXN0cikgcmV0dXJuIGxvY2F0aW9uczsgLy8gSWYgbm8gc2VhcmNoIGNyaXRlcmlhLCByZXR1cm4gd2hvbGUgbGlzdFxuICAgIGxldCByZXN1bHRzID0gbG9jYXRpb25zLmZpbHRlcihmdW5jdGlvbihsb2NhdGlvbikge1xuICAgICAgICBpZihsb2NhdGlvbi5uYW1lID09PSBzdHIgfHwgXG4gICAgICAgICAgIGxvY2F0aW9uLmxvY2F0aW9uX25hbWUgPT09IHN0ciB8fFxuICAgICAgICAgICBsb2NhdGlvbi5sb2NhdGlvbl9jaXR5ID09PSBzdHIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbn1cblxuZnVuY3Rpb24gcHJvY2Vzc1NlYXJjaChzdHIpIHtcbiAgICAvLyBGaXJzdCBjbGVhciByZXN1bHRzIGFuZCBzaG93IGxvYWRlclxuICAgICQoJy5yZXN1bHRzLWxpc3QnKS5odG1sKFwiXCIpO1xuICAgICQoJy5yZXN1bHRzLXNlY3Rpb24gLmxvYWRlcicpLnNob3coKTtcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoXCJcIik7XG4gICAgJC53aGVuKGdldERhdGEoc3RyKSkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIC8vIFByZXRlbmQgdG8gZ2V0IG5ldyBzZWFyY2ggcmVzdWx0cyB3aXRoIG5ldyBxdWVyeVxuICAgICAgICAvLyBhbmQgdXBkYXRlIG1vZGVsXG4gICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbnMgPSBjcmVhdGVSZXN1bHRzTGlzdChzdHIpO1xuXG4gICAgICAgIC8vIFVwZGF0ZSByZXN1bHRzIGFuZCByZXNldCByZXNwb25zaXZlIGVsZW1lbnRzXG4gICAgICAgIGFwcC5yZXN1bHRzX2FyZWEudXBkYXRlKGFwcC5tb2RlbC5sb2NhdGlvbnMpO1xuICAgICAgICAvL3NldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbiAgICAgICAgLy8gSGlkZSBsb2FkZXIgYWZ0ZXIgbG9hZGluZyBuZXcgcmVzdWx0c1xuICAgICAgICAkKCcucmVzdWx0cy1zZWN0aW9uIC5sb2FkZXInKS5mYWRlT3V0KCk7XG4gICAgfSk7XG59IiwiZnVuY3Rpb24gc2V0RXZlbnRIYW5kbGVycygpIHtcbiAgICAvLyBTZWFyY2ggZm9ybVxuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybScpLnN1Ym1pdChmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCBzZWFyY2hfaW5xdWlyeSA9ICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYoc2VhcmNoX2lucXVpcnkpIHtcbiAgICAgICAgICAgIHByb2Nlc3NTZWFyY2goc2VhcmNoX2lucXVpcnkpO1xuICAgICAgICAgICAgJCgnaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoXCJcIik7XG4gICAgICAgICAgICByZXZlYWxSZXN1bHRzQXJlYSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBTZWFyY2ggZm9ybSBwcmVkaWN0aXZlIHNlYXJjaFxuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLmZvY3VzKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBXaGVuIGZvY3VzIGlzIG9uIHNlYXJjaCBpbnB1dFxuICAgICAgICAvLyBFdmFsdWF0ZSBzdHJpbmcgb24ga2V5dXAgLSBrZXlkb3duIGZpcmVzIGJlZm9yZSB0ZXh0IGlzIGF2YWlsYWJsZVxuICAgICAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5rZXl1cChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBsZXQgc2VhcmNoX2lucXVpcnkgPSAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0tleSBEb3duJyk7XG4gICAgICAgICAgICBwcmVkaWN0U2VhcmNoKHNlYXJjaF9pbnF1aXJ5KTtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLnNob3coKTtcbiAgICAgICAgfSlcbiAgICB9KTtcblxuICAgIC8vIEhpZGUgcHJlZGljdGlvbiBib3ggd2hlbiBmb2N1cyBpc24ndCBvbiBzZWFyY2hcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5mb2N1c291dChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkKCcucHJlZGljdGl2ZS1ib3gnKS5pcyhcIjpob3ZlclwiKSkge1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGaWxsIHNlYXJjaCBiYXIgd2l0aCB3aGF0ZXZlciBhIHVzZXIgc2VsZWN0cyBmcm9tIGxpc3RcbiAgICAkKCcucHJlZGljdGl2ZS1pdGVtJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJy5wcmVkaWN0aXZlLXJlc3VsdHMnKS5odG1sKFwiXCIpO1xuICAgICAgICAkKHRoaXMpLmRhdGEoJ25hbWUnKTtcbiAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgIH0pXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
