"use strict";function getData(e){return $.ajax({dataType:"json",url:"https://www.deskbookers.com/nl-nl/sajax.json?q=Amsterdam&type=-&people=any&favorite=0&pid=&sw=52.293753%2C4.634942&ne=52.455562%2C5.162286&ids=17201%2C19640%2C13692%2C13691%2C12136%2C17938%2C15292%2C14886%2C14885%2C14884%2C14883%2C15730%2C15353%2C15351%2C15330%2C15080%2C17290%2C15454%2C15451%2C15379"})}function setDimensionsForResponsiveElements(){$("ul.results-list").css("width",$(".result-item").width()*$(".result-item").length+"px")}function createCarousel(e,t){function a(){var e='\n            <div class="control-wrapper left">\n                <div class="control left-control">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                </div>\n            </div>\n            <div class="control-wrapper right">\n                <div class="control right-control">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                </div>\n            </div>\n        ';n.append(e),n.find(".right-control").on("click",function(){n.nextImage()}),n.find(".left-control").on("click",function(){n.prevImage()})}var n=$(e);return n.current_image_index=0,n.images=t,n.goToImage=function(e){$(".carousel-item").fadeOut(2e3),$('.carousel-item[data-id="'+e+'"]').fadeIn(2e3),0===n.images.length?n.find(".control").hide():n.find(".control").show()},n.updateSlides=function(e,t){n.images=e,n.find("ul").html(""),e.forEach(function(e,a){"string"==typeof e&&n.find("ul").append('<li \n                    id="image-'+a+'" \n                    data-id="'+a+'" \n                    class="carousel-item" \n                    style="background-image:url(\''+e+'\')">\n                        <h1 class="headline">'+(t[a]||"Headline #"+(a+1))+"</h1>\n                    </li>\n                ")}),n.goToImage(0)},n.nextImage=function(){n.images[n.current_image_index+1]?n.goToImage(++n.current_image_index):(n.goToImage(0),n.current_image_index=0)},n.prevImage=function(){n.images[n.current_image_index-1]?n.goToImage(--n.current_image_index):(n.goToImage(n.images.length-1),n.current_image_index=n.images.length-1)},a(),n.append("<ul></ul>"),n.updateSlides(t,["Fast, Easy, Flexible","Book one of our spaces"]),setInterval(function(){n.is(":hover")||n.nextImage()},6e3),n}function updateResults(e){console.log("Update Results",e),e.map(function(e,t){var a=e.url,n=e.name,o=e.location_name,i=e.rating||"-",r=e.day_price?"€"+e.day_price+"/day":"",s=e.hour_price?"€"+e.hour_price+"/hour":"",l=e.image_urls2[0];$(".results-list").append('<li \n            id="location-'+t+'" \n            class="result-item" \n            style="background-image:url(\''+l+'\'); display: none;">\n                <a href="'+(a||"#")+'">\n                    <ul class="location-info">\n                        <li class="first-line">'+n+"</li>\n                        <li>"+o+"</li>\n                        <li>Score: "+i+"</li>\n                        <li>"+r+"</li>\n                        <li>"+s+"</li>\n                    </ul>\n                </a>\n            </li>"),$("#location-"+t).fadeIn(1e3*t)})}function revealResultsArea(){$("html, body").animate({scrollTop:$(".results-section").height()},1e3)}function createResultsArea(){return{update:updateResults,scrollTo:revealResultsArea}}function createSearchList(e){var t={},a=e.reduce(function(e,t){return e.concat([t.name,t.location_name,t.location_city])},[]).filter(function(e){return!t[e]&&(t[e]=!0,!0)});return a.sort(function(e,t){return e.localeCompare(t)}),a}function predictSearch(e){var t=app.model.location_names.filter(function(t){return t.toLowerCase().includes(e.toLowerCase())});fillPredictor(".predictive-results",t.slice(0,5))}function fillPredictor(e,t){var a=$(e);a.html(""),a.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="All">Search all locations..</li>');var n=!0,o=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;a.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="'+l+'">'+l+"</li>")}}catch(c){o=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw i}}$(".predictive-item").on("click",function(){var e=$(this).data("name");"All"===e?($('#location-search-form input[type="text"]').val(""),processSearch(),revealResultsArea(),$(".predictive-box").hide()):($('#location-search-form input[type="text"]').val(e),$(".predictive-box").hide())})}function createResultsList(e){var t=app.model.raw_data.rows;if(!e)return t;var a=t.filter(function(t){return t.name===e||t.location_name===e||t.location_city===e});return a}function processSearch(e){$(".results-list").html(""),$(".results-section .loader").show(),$('#location-search-form input[type="text"]').val(""),$.when(getData(e)).then(function(t){app.model.raw_data=t,app.model.locations=createResultsList(e),app.components.results_area.update(locations),app.model.locations,setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()}).fail(function(t){console.error("Could not connect to API.","Using session storage..",t),app.model.locations=createResultsList(e),app.components.results_area.update(app.model.locations),setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()})}function setEventHandlers(){$("#location-search-form").submit(function(e){var t=$('input[type="text"]').val();e.preventDefault(),t&&(processSearch(t),$('input[type="text"]').val(""),revealResultsArea())}),$('#location-search-form input[type="text"]').focus(function(){$('#location-search-form input[type="text"]').keyup(function(e){var t=$('#location-search-form input[type="text"]').val();predictSearch(t),$(".predictive-box").show()})}),$('#location-search-form input[type="text"]').focusout(function(){$(".predictive-box").is(":hover")||$(".predictive-box").hide()}),$(".predictive-item").on("click",function(){$(".predictive-results").html(""),$(this).data("name"),$(".predictive-box").hide()})}var max_results=20,app={model:{raw_data:void 0,locations:void 0,location_names:void 0},components:{main_carousel:void 0,results_area:void 0},init:function(){if(sessionStorage.getItem("location_data")){var e=sessionStorage.getItem("location_data");app.model.raw_data=JSON.parse(e),console.log("Using data from session storage..",app.model.raw_data),app.setUp()}else $(".loader").show(),app.setData()},setData:function(){$.when(getData()).then(function(e){console.log("Retrieved data",e),sessionStorage.setItem("location_data",JSON.stringify(e)),app.model.raw_data=e,app.setUp(),$(".loader").fadeOut()})},setUp:function(){app.model.locations=app.model.raw_data.rows;var e=app.model.locations.slice(0,Math.min(max_results,app.model.locations.length-1)),t=app.model.locations.reduce(function(e,t){return e.concat(t.image_urls)},[]);$(document).ready(function(){app.model.location_names=createSearchList(app.model.raw_data.rows),app.components.main_carousel=createCarousel("carousel",t),app.components.results_area=createResultsArea(),app.components.results_area.update(e),$(".search-box").show(),setEventHandlers(),setDimensionsForResponsiveElements()})}};app.init(),$(window).resize(function(){setDimensionsForResponsiveElements()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJjcmVhdGVDYXJvdXNlbC5qcyIsImNyZWF0ZVJlc3VsdHNBcmVhLmpzIiwic2VhcmNoX2Z1bmN0aW9ucy5qcyIsInNldEV2ZW50SGFuZGxlcnMuanMiXSwibmFtZXMiOlsiZ2V0RGF0YSIsInNlYXJjaF9pbnF1aXJ5IiwiJCIsImFqYXgiLCJkYXRhVHlwZSIsInVybCIsInNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMiLCJjc3MiLCJ3aWR0aCIsImxlbmd0aCIsImNyZWF0ZUNhcm91c2VsIiwiZWxlbWVudCIsImltYWdlX2FyciIsImNyZWF0ZUNvbnRyb2xzIiwidGVtcGxhdGUiLCIkY2Fyb3VzZWwiLCJhcHBlbmQiLCJmaW5kIiwib24iLCJuZXh0SW1hZ2UiLCJwcmV2SW1hZ2UiLCJjdXJyZW50X2ltYWdlX2luZGV4IiwiaW1hZ2VzIiwiZ29Ub0ltYWdlIiwiaW5kZXgiLCJmYWRlT3V0IiwiZmFkZUluIiwiaGlkZSIsInNob3ciLCJ1cGRhdGVTbGlkZXMiLCJzbGlkZXMiLCJoZWFkbGluZXMiLCJodG1sIiwiZm9yRWFjaCIsInNldEludGVydmFsIiwiaXMiLCJ1cGRhdGVSZXN1bHRzIiwibG9jYXRpb25zIiwiY29uc29sZSIsImxvZyIsIm1hcCIsImxvY2F0aW9uIiwibG9jYXRpb25fdXJsIiwid29ya3BsYWNlIiwibmFtZSIsImxvY2F0aW9uX25hbWUiLCJyZXZpZXdfc2NvcmUiLCJyYXRpbmciLCJkYXlfcHJpY2UiLCJob3VyX3ByaWNlIiwiaW1hZ2VfdXJsIiwiaW1hZ2VfdXJsczIiLCJyZXZlYWxSZXN1bHRzQXJlYSIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJoZWlnaHQiLCJjcmVhdGVSZXN1bHRzQXJlYSIsInVwZGF0ZSIsInNjcm9sbFRvIiwiY3JlYXRlU2VhcmNoTGlzdCIsInBsYWNlX2hhc2giLCJsb2NhdGlvbl9uYW1lcyIsInJlZHVjZSIsImFsbF9uYW1lcyIsImNvbmNhdCIsImxvY2F0aW9uX2NpdHkiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsInByZWRpY3RTZWFyY2giLCJzdHIiLCJsaXN0IiwiYXBwIiwibW9kZWwiLCJwbGFjZSIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJmaWxsUHJlZGljdG9yIiwic2xpY2UiLCIkcHJlZGljdG9yIiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJ1bmRlZmluZWQiLCJfc3RlcCIsIl9pdGVyYXRvciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJ2YWx1ZSIsImVyciIsInRoaXMiLCJkYXRhIiwidmFsIiwicHJvY2Vzc1NlYXJjaCIsImNyZWF0ZVJlc3VsdHNMaXN0IiwicmF3X2RhdGEiLCJyb3dzIiwicmVzdWx0cyIsIndoZW4iLCJ0aGVuIiwiY29tcG9uZW50cyIsInJlc3VsdHNfYXJlYSIsImZhaWwiLCJlcnJvciIsInNldEV2ZW50SGFuZGxlcnMiLCJzdWJtaXQiLCJlIiwicHJldmVudERlZmF1bHQiLCJmb2N1cyIsImtleXVwIiwiZm9jdXNvdXQiLCJtYXhfcmVzdWx0cyIsIm1haW5fY2Fyb3VzZWwiLCJpbml0Iiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiZGF0YVN0cmluZyIsIkpTT04iLCJwYXJzZSIsInNldFVwIiwic2V0RGF0YSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJNYXRoIiwibWluIiwibWFpbl9pbWFnZXMiLCJhbGxfaW1hZ2VzIiwiaW1hZ2VfdXJscyIsImRvY3VtZW50IiwicmVhZHkiLCJ3aW5kb3ciLCJyZXNpemUiXSwibWFwcGluZ3MiOiJBQUFBLFlBSUEsU0FBU0EsU0FBUUMsR0FHYixNQUFPQyxHQUFFQyxNQUNMQyxTQUFVLE9BQ1ZDLElBQUssaVRBSWIsUUFBU0Msc0NBSUxKLEVBQUUsbUJBQW1CSyxJQUFJLFFBQVNMLEVBQUUsZ0JBQWdCTSxRQUFVTixFQUFFLGdCQUFnQk8sT0FBUyxNQ2pC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QWlCRixpQkFBaUJnQixJQUFJQyxNQUFNd0IsU0FBU0MsTUFDL0QxQixJQUFJOEIsV0FBV1ksY0FBZ0IzRyxlQUFlLFdBQVl3SCxHQUMxRHZELElBQUk4QixXQUFXQyxhQUFlbEQsb0JBQzlCbUIsSUFBSThCLFdBQVdDLGFBQWFqRCxPQUFPcEIsR0FDbkNuQyxFQUFFLGVBQWUwQixPQUNqQmlGLG1CQUNBdkcsd0NBTVpxRSxLQUFJMkMsT0FDSnBILEVBQUVxSSxRQUFRQyxPQUFPLFdBQ2JsSSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWF4X3Jlc3VsdHMgPSAyMDtcblxuZnVuY3Rpb24gZ2V0RGF0YShzZWFyY2hfaW5xdWlyeSkge1xuICAgIC8vIFNlYXJjaCBpbnF1aXJ5IHdvdWxkIGJlIHVzZWQgdG8gZ2V0IHNwZWNpZmljIHJlc3VsdHMgZnJvbSBBUElcbiAgICAvLyBGb3IgdGhpcyBjaGFsbGVuZ2UsIG9ubHkgdXNpbmcgc3BlY2lmaWVkIHF1ZXJ5IHN0cmluZyBiZWxvdzpcbiAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICB1cmw6ICdodHRwczovL3d3dy5kZXNrYm9va2Vycy5jb20vbmwtbmwvc2FqYXguanNvbj9xPUFtc3RlcmRhbSZ0eXBlPS0mcGVvcGxlPWFueSZmYXZvcml0ZT0wJnBpZD0mc3c9NTIuMjkzNzUzJTJDNC42MzQ5NDImbmU9NTIuNDU1NTYyJTJDNS4xNjIyODYmaWRzPTE3MjAxJTJDMTk2NDAlMkMxMzY5MiUyQzEzNjkxJTJDMTIxMzYlMkMxNzkzOCUyQzE1MjkyJTJDMTQ4ODYlMkMxNDg4NSUyQzE0ODg0JTJDMTQ4ODMlMkMxNTczMCUyQzE1MzUzJTJDMTUzNTElMkMxNTMzMCUyQzE1MDgwJTJDMTcyOTAlMkMxNTQ1NCUyQzE1NDUxJTJDMTUzNzknXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKSB7XG4gICAgLy8gU2V0IHdpZHRoIG9mIHJlc3VsdHMgbGlzdCBieSBmaWd1cmluZyBvdXQgMS81IG9mIHdpbmRvdyB3aWR0aCBcbiAgICAvLyB0aGVuIG11bHRpcGx5aW5nIHRoYXQgYnkgdGhlIG51bWJlciBvZiBpdGVtc1xuICAgIC8vIEdpdmVzXG4gICAgJCgndWwucmVzdWx0cy1saXN0JykuY3NzKCd3aWR0aCcsICQoJy5yZXN1bHQtaXRlbScpLndpZHRoKCkgKiAkKCcucmVzdWx0LWl0ZW0nKS5sZW5ndGggKyAncHgnKTtcbn1cblxudmFyIGFwcCA9IHtcbiAgICAvLyBJbml0aWFsaXplIHRoZSBhcHBcbiAgICAvLyBUaGlzIGxheXMgb3V0IHRoZSBzdHJ1Y3R1cmVcbiAgICBtb2RlbDoge1xuICAgICAgICByYXdfZGF0YTogdW5kZWZpbmVkLCAvL0FsbCBkYXRhIGZyb20gc2VydmVyXG4gICAgICAgIGxvY2F0aW9uczogdW5kZWZpbmVkLCAvL0N1cnJlbnQgcmVzdWx0IGRhdGFcbiAgICAgICAgbG9jYXRpb25fbmFtZXM6IHVuZGVmaW5lZCAvL1Bvc3NpYmxlIHNlYXJjaCByZXN1bHRzXG4gICAgfSxcbiAgICBjb21wb25lbnRzOiB7XG4gICAgICAgIG1haW5fY2Fyb3VzZWw6IHVuZGVmaW5lZCwgLy8gXG4gICAgICAgIHJlc3VsdHNfYXJlYTogdW5kZWZpbmVkXG4gICAgfSxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gVXNlIHNlc3Npb24gc3RvcmFnZSBpZiBhdmFpbGFibGVcbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2xvY2F0aW9uX2RhdGEnKSkge1xuICAgICAgICAgICAgbGV0IGRhdGFTdHJpbmcgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsb2NhdGlvbl9kYXRhJyk7XG4gICAgICAgICAgICBhcHAubW9kZWwucmF3X2RhdGEgPSBKU09OLnBhcnNlKGRhdGFTdHJpbmcpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIGRhdGEgZnJvbSBzZXNzaW9uIHN0b3JhZ2UuLicsIGFwcC5tb2RlbC5yYXdfZGF0YSk7XG4gICAgICAgICAgICBhcHAuc2V0VXAoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJy5sb2FkZXInKS5zaG93KCk7XG4gICAgICAgICAgICBhcHAuc2V0RGF0YSgpO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIEdldCBhbmQgc2V0IGRhdGEgZnJvbSB0aGUgQVBJXG4gICAgc2V0RGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICQud2hlbihnZXREYXRhKCkpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JldHJpZXZlZCBkYXRhJywgZGF0YSk7XG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdsb2NhdGlvbl9kYXRhJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgYXBwLm1vZGVsLnJhd19kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIGFwcC5zZXRVcCgpO1xuICAgICAgICAgICAgJCgnLmxvYWRlcicpLmZhZGVPdXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICAvLyBTZXQgdXAgdmlld3NcbiAgICBzZXRVcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFNldCByZXN1bHQgZGF0YSBmcm9tIGFsbCBkYXRhXG4gICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbnMgPSBhcHAubW9kZWwucmF3X2RhdGEucm93cztcbiAgICAgICAgdmFyIGxvY2F0aW9ucyA9IGFwcC5tb2RlbC5sb2NhdGlvbnMuc2xpY2UoMCwgTWF0aC5taW4obWF4X3Jlc3VsdHMsIGFwcC5tb2RlbC5sb2NhdGlvbnMubGVuZ3RoIC0gMSkpO1xuXG4gICAgICAgIC8vIFRoaXMgd2FzIGluaXRpYWxseSBzZXQgdXAgdG8ganVzdCBoYXZlIGEgY2Fyb3VzZWwgZm9yIG9uZSBsb2NhdGlvblxuICAgICAgICAvLyB2YXIgbWFpbl9pbWFnZXMgPSBsb2NhdGlvbnNbMF0uaW1hZ2VfdXJscy5jb25jYXQobG9jYXRpb25zWzBdLmltYWdlX3VybHMyKTtcblxuICAgICAgICB2YXIgbWFpbl9pbWFnZXMgPSBhcHAubW9kZWwubG9jYXRpb25zLnJlZHVjZShmdW5jdGlvbihhbGxfaW1hZ2VzLCBsb2NhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGFsbF9pbWFnZXMuY29uY2F0KGxvY2F0aW9uLmltYWdlX3VybHMpO1xuICAgICAgICB9LCBbXSk7XG5cbiAgICAgICAgLy8gV2FpdCBmb3IgdGhlIGRvY3VtZXQgcmVhZHkgYmVmb3JlIGJ1aWxkaW5nIHZpZXdzXG4gICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9uX25hbWVzID0gY3JlYXRlU2VhcmNoTGlzdChhcHAubW9kZWwucmF3X2RhdGEucm93cyk7XG4gICAgICAgICAgICBhcHAuY29tcG9uZW50cy5tYWluX2Nhcm91c2VsID0gY3JlYXRlQ2Fyb3VzZWwoJ2Nhcm91c2VsJywgbWFpbl9pbWFnZXMpO1xuICAgICAgICAgICAgYXBwLmNvbXBvbmVudHMucmVzdWx0c19hcmVhID0gY3JlYXRlUmVzdWx0c0FyZWEoKTtcbiAgICAgICAgICAgIGFwcC5jb21wb25lbnRzLnJlc3VsdHNfYXJlYS51cGRhdGUobG9jYXRpb25zKTtcbiAgICAgICAgICAgICQoJy5zZWFyY2gtYm94Jykuc2hvdygpO1xuICAgICAgICAgICAgc2V0RXZlbnRIYW5kbGVycygpO1xuICAgICAgICAgICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8vIFN0YXJ0IHByb2Nlc3NcbmFwcC5pbml0KCk7XG4kKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbn0pXG4iLCJmdW5jdGlvbiBjcmVhdGVDYXJvdXNlbChlbGVtZW50LCBpbWFnZV9hcnIpIHtcblxuICAgIHZhciAkY2Fyb3VzZWwgPSAkKGVsZW1lbnQpO1xuICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gMDsgLy8gXG4gICAgJGNhcm91c2VsLmltYWdlcyA9IGltYWdlX2FycjtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbnRyb2xzKCkge1xuICAgICAgICB2YXIgdGVtcGxhdGUgPSBgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbC13cmFwcGVyIGxlZnRcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbCBsZWZ0LWNvbnRyb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1jaGV2cm9uLWxlZnRcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sLXdyYXBwZXIgcmlnaHRcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbCByaWdodC1jb250cm9sXCI+XG4gICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtY2hldnJvbi1yaWdodFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuXG4gICAgICAgICRjYXJvdXNlbC5hcHBlbmQodGVtcGxhdGUpO1xuXG4gICAgICAgICRjYXJvdXNlbC5maW5kKCcucmlnaHQtY29udHJvbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGNhcm91c2VsLm5leHRJbWFnZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLmxlZnQtY29udHJvbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGNhcm91c2VsLnByZXZJbWFnZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgJCgnLmNhcm91c2VsLWl0ZW0nKS5mYWRlT3V0KDIwMDApO1xuICAgICAgICAkKGAuY2Fyb3VzZWwtaXRlbVtkYXRhLWlkPVwiJHtpbmRleH1cIl1gKS5mYWRlSW4oMjAwMCk7XG5cbiAgICAgICAgaWYgKCRjYXJvdXNlbC5pbWFnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLmNvbnRyb2wnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLypcbiAgICAgICAgLy8gVW5uZWNlc3Nhcnkgd2l0aCBuZXcgbG9vcGluZyBmZWF0dXJlXG4gICAgICAgIGVsc2UgaWYgKCRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLmxlZnQtY29udHJvbCcpLmhpZGUoKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcucmlnaHQtY29udHJvbCcpLnNob3coKTtcbiAgICAgICAgfSBlbHNlIGlmICgkY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCA9PT0gJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLmxlZnQtY29udHJvbCcpLnNob3coKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcucmlnaHQtY29udHJvbCcpLmhpZGUoKTtcbiAgICAgICAgfSBcbiAgICAgICAgKi9cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLmNvbnRyb2wnKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkY2Fyb3VzZWwudXBkYXRlU2xpZGVzID0gZnVuY3Rpb24oc2xpZGVzLCBoZWFkbGluZXMpIHtcbiAgICAgICAgJGNhcm91c2VsLmltYWdlcyA9IHNsaWRlcztcbiAgICAgICAgJGNhcm91c2VsLmZpbmQoJ3VsJykuaHRtbChcIlwiKTtcbiAgICAgICAgc2xpZGVzLmZvckVhY2goZnVuY3Rpb24odXJsLCBpbmRleCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7IC8vIFR5cGUgY2hlY2tcbiAgICAgICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgndWwnKS5hcHBlbmQoYDxsaSBcbiAgICAgICAgICAgICAgICAgICAgaWQ9XCJpbWFnZS0ke2luZGV4fVwiIFxuICAgICAgICAgICAgICAgICAgICBkYXRhLWlkPVwiJHtpbmRleH1cIiBcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJjYXJvdXNlbC1pdGVtXCIgXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTp1cmwoJyR7dXJsfScpXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3M9XCJoZWFkbGluZVwiPiR7aGVhZGxpbmVzW2luZGV4XSB8fCBcIkhlYWRsaW5lICNcIiArIChpbmRleCsxKX08L2gxPlxuICAgICAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICAgIGApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKDApO1xuICAgIH1cblxuICAgICRjYXJvdXNlbC5uZXh0SW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRjYXJvdXNlbC5pbWFnZXNbJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggKyAxXSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgrKyRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIExvb3BcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoMCk7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkY2Fyb3VzZWwucHJldkltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkY2Fyb3VzZWwuaW1hZ2VzWyRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4IC0gMV0pIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoLS0kY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBMb29wXG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKCRjYXJvdXNlbC5pbWFnZXMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCA9ICRjYXJvdXNlbC5pbWFnZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNyZWF0ZUNvbnRyb2xzKCk7XG4gICAgJGNhcm91c2VsLmFwcGVuZCgnPHVsPjwvdWw+Jyk7XG4gICAgJGNhcm91c2VsLnVwZGF0ZVNsaWRlcyhpbWFnZV9hcnIsIFtcIkZhc3QsIEVhc3ksIEZsZXhpYmxlXCIsIFwiQm9vayBvbmUgb2Ygb3VyIHNwYWNlc1wiXSk7XG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghJGNhcm91c2VsLmlzKFwiOmhvdmVyXCIpKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwubmV4dEltYWdlKCk7XG4gICAgICAgIH1cbiAgICB9LCA2MDAwKTtcbiAgICByZXR1cm4gJGNhcm91c2VsO1xufSIsImZ1bmN0aW9uIHVwZGF0ZVJlc3VsdHMobG9jYXRpb25zKSB7XG4gICAgLy8gRmlsbCByZXN1bHRzIGRpdlxuICAgIGNvbnNvbGUubG9nKCdVcGRhdGUgUmVzdWx0cycsIGxvY2F0aW9ucyk7XG4gICAgbG9jYXRpb25zLm1hcChmdW5jdGlvbihsb2NhdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgbGV0IGxvY2F0aW9uX3VybCA9IGxvY2F0aW9uLnVybDtcbiAgICAgICAgbGV0IHdvcmtwbGFjZSA9IGxvY2F0aW9uLm5hbWU7XG4gICAgICAgIGxldCBsb2NhdGlvbl9uYW1lID0gbG9jYXRpb24ubG9jYXRpb25fbmFtZTtcbiAgICAgICAgbGV0IHJldmlld19zY29yZSA9IGxvY2F0aW9uLnJhdGluZyB8fCBcIi1cIjtcbiAgICAgICAgbGV0IGRheV9wcmljZSA9IChsb2NhdGlvbi5kYXlfcHJpY2UpID8gJ+KCrCcgKyBsb2NhdGlvbi5kYXlfcHJpY2UgKyBcIi9kYXlcIiA6IFwiXCI7XG4gICAgICAgIGxldCBob3VyX3ByaWNlID0gKGxvY2F0aW9uLmhvdXJfcHJpY2UpID8gJ+KCrCcgKyBsb2NhdGlvbi5ob3VyX3ByaWNlICsgXCIvaG91clwiIDogXCJcIjtcbiAgICAgICAgbGV0IGltYWdlX3VybCA9IGxvY2F0aW9uLmltYWdlX3VybHMyWzBdOyAvLyBVc2Ugc21hbGxlciB0aHVtYnNcblxuICAgICAgICAkKCcucmVzdWx0cy1saXN0JykuYXBwZW5kKGA8bGkgXG4gICAgICAgICAgICBpZD1cImxvY2F0aW9uLSR7aW5kZXh9XCIgXG4gICAgICAgICAgICBjbGFzcz1cInJlc3VsdC1pdGVtXCIgXG4gICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6dXJsKCcke2ltYWdlX3VybH0nKTsgZGlzcGxheTogbm9uZTtcIj5cbiAgICAgICAgICAgICAgICA8YSBocmVmPVwiJHtsb2NhdGlvbl91cmwgfHwgXCIjXCJ9XCI+XG4gICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz1cImxvY2F0aW9uLWluZm9cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz1cImZpcnN0LWxpbmVcIj4ke3dvcmtwbGFjZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPiR7bG9jYXRpb25fbmFtZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPlNjb3JlOiAke3Jldmlld19zY29yZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPiR7ZGF5X3ByaWNlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHtob3VyX3ByaWNlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgPC9saT5gKTtcbiAgICAgICAgJCgnI2xvY2F0aW9uLScraW5kZXgpLmZhZGVJbigxMDAwICogaW5kZXgpOyAvLyBDcmVhdGVzIGNvb2wgcHJvZ3Jlc3NpdmUgZmFkZSBpblxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiByZXZlYWxSZXN1bHRzQXJlYSgpIHtcbiAgICAvLyBTY3JvbGwgZG93biB0byBkaXNwbGF5IHJlc3VsdHNcbiAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogJChcIi5yZXN1bHRzLXNlY3Rpb25cIikuaGVpZ2h0KClcbiAgICAgfSwgMTAwMCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlc3VsdHNBcmVhKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHVwZGF0ZTogdXBkYXRlUmVzdWx0cyxcbiAgICAgICAgc2Nyb2xsVG86IHJldmVhbFJlc3VsdHNBcmVhXG4gICAgfVxufSIsImZ1bmN0aW9uIGNyZWF0ZVNlYXJjaExpc3QobG9jYXRpb25zKSB7XG4gICAgbGV0IHBsYWNlX2hhc2ggPSB7fTtcbiAgICAvLyBDcmVhdGUgYSBsaXN0IG9mIHBsYWNlcyB0byBzZWFyY2hcbiAgICBsZXQgbG9jYXRpb25fbmFtZXMgPSBsb2NhdGlvbnMucmVkdWNlKGZ1bmN0aW9uKGFsbF9uYW1lcywgbG9jYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbGxfbmFtZXMuY29uY2F0KFtsb2NhdGlvbi5uYW1lLCBsb2NhdGlvbi5sb2NhdGlvbl9uYW1lLCBsb2NhdGlvbi5sb2NhdGlvbl9jaXR5XSk7XG4gICAgICAgIH0sIFtdKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIGlmICghcGxhY2VfaGFzaFtpdGVtXSkge1xuICAgICAgICAgICAgICAgIHBsYWNlX2hhc2hbaXRlbV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgLy8gU29ydCBsaXN0IGFuZCByZXR1cm5cbiAgICBsb2NhdGlvbl9uYW1lcy5zb3J0KChhLCBiKSA9PiBhLmxvY2FsZUNvbXBhcmUoYikpO1xuICAgIHJldHVybiBsb2NhdGlvbl9uYW1lcztcbn1cblxuZnVuY3Rpb24gcHJlZGljdFNlYXJjaChzdHIpIHtcbiAgICAvLyBQcmVkaWN0IGJ5IGxvY2F0aW9uIG5hbWVcbiAgICAvLyBGaWx0ZXIgbGlzdCBieSBpbnB1dCBzdHJpbmdcbiAgICBsZXQgbGlzdCA9IGFwcC5tb2RlbC5sb2NhdGlvbl9uYW1lcy5maWx0ZXIoZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgICAgcmV0dXJuIHBsYWNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc3RyLnRvTG93ZXJDYXNlKCkpO1xuICAgIH0pO1xuXG4gICAgLy8gRnVsbCBwcmVkaWN0b3Igd2l0aCBvbmx5IHRvcCA1IHJlc3VsdHNcbiAgICBmaWxsUHJlZGljdG9yKCcucHJlZGljdGl2ZS1yZXN1bHRzJywgbGlzdC5zbGljZSgwLCA1KSk7XG59XG5cbmZ1bmN0aW9uIGZpbGxQcmVkaWN0b3IoZWxlbWVudCwgbGlzdCkge1xuICAgIHZhciAkcHJlZGljdG9yID0gJChlbGVtZW50KTtcbiAgICAkcHJlZGljdG9yLmh0bWwoXCJcIik7XG4gICAgJHByZWRpY3Rvci5hcHBlbmQoYFxuICAgICAgICAgICAgPGxpIGRhdGEtaWQ9XCJcIiBcbiAgICAgICAgICAgICAgICBjbGFzcz1cInByZWRpY3RpdmUtaXRlbVwiXG4gICAgICAgICAgICAgICAgZGF0YS1uYW1lPVwiQWxsXCI+U2VhcmNoIGFsbCBsb2NhdGlvbnMuLjwvbGk+YCk7XG4gICAgZm9yIChsZXQgbG9jYXRpb24gb2YgbGlzdCkge1xuICAgICAgICAkcHJlZGljdG9yLmFwcGVuZChgXG4gICAgICAgICAgICA8bGkgZGF0YS1pZD1cIlwiIFxuICAgICAgICAgICAgICAgIGNsYXNzPVwicHJlZGljdGl2ZS1pdGVtXCJcbiAgICAgICAgICAgICAgICBkYXRhLW5hbWU9XCIke2xvY2F0aW9ufVwiPiR7bG9jYXRpb259PC9saT5gKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgaGFuZGxlclxuICAgICQoJy5wcmVkaWN0aXZlLWl0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbGV0IG5hbWUgPSAkKHRoaXMpLmRhdGEoJ25hbWUnKTtcbiAgICAgICAgaWYgKG5hbWUgPT09IFwiQWxsXCIpIHtcbiAgICAgICAgICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChcIlwiKTtcbiAgICAgICAgICAgIHByb2Nlc3NTZWFyY2goKTtcbiAgICAgICAgICAgIHJldmVhbFJlc3VsdHNBcmVhKCk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwobmFtZSk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9KVxufVxuXG5mdW5jdGlvbiBjcmVhdGVSZXN1bHRzTGlzdChzdHIpIHtcbiAgICBsZXQgbG9jYXRpb25zID0gYXBwLm1vZGVsLnJhd19kYXRhLnJvd3M7XG4gICAgaWYgKCFzdHIpIHJldHVybiBsb2NhdGlvbnM7IC8vIElmIG5vIHNlYXJjaCBjcml0ZXJpYSwgcmV0dXJuIHdob2xlIGxpc3RcbiAgICBsZXQgcmVzdWx0cyA9IGxvY2F0aW9ucy5maWx0ZXIoZnVuY3Rpb24obG9jYXRpb24pIHtcbiAgICAgICAgaWYobG9jYXRpb24ubmFtZSA9PT0gc3RyIHx8IFxuICAgICAgICAgICBsb2NhdGlvbi5sb2NhdGlvbl9uYW1lID09PSBzdHIgfHxcbiAgICAgICAgICAgbG9jYXRpb24ubG9jYXRpb25fY2l0eSA9PT0gc3RyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NTZWFyY2goc3RyKSB7XG4gICAgLy8gRmlyc3QgY2xlYXIgcmVzdWx0cyBhbmQgc2hvdyBsb2FkZXJcbiAgICAkKCcucmVzdWx0cy1saXN0JykuaHRtbChcIlwiKTtcbiAgICAkKCcucmVzdWx0cy1zZWN0aW9uIC5sb2FkZXInKS5zaG93KCk7XG4gICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgIFxuICAgICQud2hlbihnZXREYXRhKHN0cikpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBQcmV0ZW5kIHRvIGdldCBuZXcgc2VhcmNoIHJlc3VsdHMgd2l0aCBuZXcgcXVlcnlcbiAgICAgICAgLy8gYW5kIHVwZGF0ZSBtb2RlbFxuICAgICAgICBhcHAubW9kZWwucmF3X2RhdGEgPSBkYXRhO1xuICAgICAgICBhcHAubW9kZWwubG9jYXRpb25zID0gY3JlYXRlUmVzdWx0c0xpc3Qoc3RyKTtcblxuICAgICAgICAvLyBVcGRhdGUgcmVzdWx0cyBhbmQgcmVzZXQgcmVzcG9uc2l2ZSBlbGVtZW50c1xuICAgICAgICBhcHAuY29tcG9uZW50cy5yZXN1bHRzX2FyZWEudXBkYXRlKGxvY2F0aW9ucyk7KGFwcC5tb2RlbC5sb2NhdGlvbnMpO1xuICAgICAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7XG4gICAgICAgIC8vIEhpZGUgbG9hZGVyIGFmdGVyIGxvYWRpbmcgbmV3IHJlc3VsdHNcbiAgICAgICAgJCgnLnJlc3VsdHMtc2VjdGlvbiAubG9hZGVyJykuZmFkZU91dCgpO1xuICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBjb25uZWN0IHRvIEFQSS5cIixcIlVzaW5nIHNlc3Npb24gc3RvcmFnZS4uXCIsIGVycm9yKTtcbiAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9ucyA9IGNyZWF0ZVJlc3VsdHNMaXN0KHN0cik7XG4gICAgICAgIC8vIFVwZGF0ZSByZXN1bHRzIGFuZCByZXNldCByZXNwb25zaXZlIGVsZW1lbnRzXG4gICAgICAgIGFwcC5jb21wb25lbnRzLnJlc3VsdHNfYXJlYS51cGRhdGUoYXBwLm1vZGVsLmxvY2F0aW9ucyk7XG4gICAgICAgIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbiAgICAgICAgLy8gSGlkZSBsb2FkZXIgYWZ0ZXIgbG9hZGluZyBuZXcgcmVzdWx0c1xuICAgICAgICAkKCcucmVzdWx0cy1zZWN0aW9uIC5sb2FkZXInKS5mYWRlT3V0KCk7XG4gICAgfSk7XG5cbn0iLCJmdW5jdGlvbiBzZXRFdmVudEhhbmRsZXJzKCkge1xuICAgIC8vIFNlYXJjaCBmb3JtXG4gICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtJykuc3VibWl0KGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgbGV0IHNlYXJjaF9pbnF1aXJ5ID0gJCgnaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZihzZWFyY2hfaW5xdWlyeSkge1xuICAgICAgICAgICAgcHJvY2Vzc1NlYXJjaChzZWFyY2hfaW5xdWlyeSk7XG4gICAgICAgICAgICAkKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChcIlwiKTtcbiAgICAgICAgICAgIHJldmVhbFJlc3VsdHNBcmVhKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNlYXJjaCBmb3JtIHByZWRpY3RpdmUgc2VhcmNoXG4gICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykuZm9jdXMoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFdoZW4gZm9jdXMgaXMgb24gc2VhcmNoIGlucHV0XG4gICAgICAgIC8vIEV2YWx1YXRlIHN0cmluZyBvbiBrZXl1cCAtIGtleWRvd24gZmlyZXMgYmVmb3JlIHRleHQgaXMgYXZhaWxhYmxlXG4gICAgICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLmtleXVwKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGxldCBzZWFyY2hfaW5xdWlyeSA9ICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbCgpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnS2V5IERvd24nKTtcbiAgICAgICAgICAgIHByZWRpY3RTZWFyY2goc2VhcmNoX2lucXVpcnkpO1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94Jykuc2hvdygpO1xuICAgICAgICB9KVxuICAgIH0pO1xuXG4gICAgLy8gSGlkZSBwcmVkaWN0aW9uIGJveCB3aGVuIGZvY3VzIGlzbid0IG9uIHNlYXJjaFxuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLmZvY3Vzb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoISQoJy5wcmVkaWN0aXZlLWJveCcpLmlzKFwiOmhvdmVyXCIpKSB7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEZpbGwgc2VhcmNoIGJhciB3aXRoIHdoYXRldmVyIGEgdXNlciBzZWxlY3RzIGZyb20gbGlzdFxuICAgICQoJy5wcmVkaWN0aXZlLWl0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnLnByZWRpY3RpdmUtcmVzdWx0cycpLmh0bWwoXCJcIik7XG4gICAgICAgICQodGhpcykuZGF0YSgnbmFtZScpO1xuICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgfSlcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
