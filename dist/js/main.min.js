"use strict";function getData(e){return $.ajax({dataType:"json",url:"https://www.deskbookers.com/nl-nl/sajax.json?q=Amsterdam&type=-&people=any&favorite=0&pid=&sw=52.293753%2C4.634942&ne=52.455562%2C5.162286&ids=17201%2C19640%2C13692%2C13691%2C12136%2C17938%2C15292%2C14886%2C14885%2C14884%2C14883%2C15730%2C15353%2C15351%2C15330%2C15080%2C17290%2C15454%2C15451%2C15379"})}function createCarousel(e,t){function n(){var e='\n            <div class="control-wrapper left">\n                <div class="control left-control">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                </div>\n            </div>\n            <div class="control-wrapper right">\n                <div class="control right-control">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                </div>\n            </div>\n        ';a.append(e),a.find(".right-control").on("click",function(){a.nextImage()}),a.find(".left-control").on("click",function(){a.prevImage()})}var a=$(e);return a.current_image_index=0,a.images=t,a.goToImage=function(e){$(".carousel-item").fadeOut(2e3),$('.carousel-item[data-id="'+e+'"]').fadeIn(2e3),0===a.images.length?a.find(".control").hide():a.find(".control").show()},a.updateSlides=function(e,t){a.images=e,a.find("ul").html(""),e.forEach(function(e,n){"string"==typeof e&&a.find("ul").append('<li \n                    id="image-'+n+'" \n                    data-id="'+n+'" \n                    class="carousel-item" \n                    style="background-image:url(\''+e+'\')">\n                        <h1 class="headline">'+(t[n]||"Headline #"+(n+1))+"</h1>\n                    </li>\n                ")}),a.goToImage(0)},a.nextImage=function(){a.images[a.current_image_index+1]?a.goToImage(++a.current_image_index):(a.goToImage(0),a.current_image_index=0)},a.prevImage=function(){a.images[a.current_image_index-1]?a.goToImage(--a.current_image_index):(a.goToImage(a.images.length-1),a.current_image_index=a.images.length-1)},n(),a.append("<ul></ul>"),a.updateSlides(t,["Fast, Easy, Flexible","Book one of our spaces"]),setInterval(function(){a.is(":hover")||a.nextImage()},6e3),a}function createSearchList(e){var t={},n=e.reduce(function(e,t){return e.concat([t.name,t.location_name,t.location_city])},[]).filter(function(e){return!t[e]&&(t[e]=!0,!0)});return n.sort(function(e,t){return e.localeCompare(t)}),n}function predictSearch(e){var t=app.model.location_names.filter(function(t){return t.toLowerCase().includes(e.toLowerCase())});fillPredictor(".predictive-results",t.slice(0,5))}function fillPredictor(e,t){var n=$(e);n.html(""),n.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="All">Search all locations..</li>');var a=!0,o=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){var l=r.value;n.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="'+l+'">'+l+"</li>")}}catch(c){o=!0,i=c}finally{try{!a&&s["return"]&&s["return"]()}finally{if(o)throw i}}$(".predictive-item").on("click",function(){var e=$(this).data("name");"All"===e?($('#location-search-form input[type="text"]').val(""),processSearch(),revealResultsArea(),$(".predictive-box").hide()):($('#location-search-form input[type="text"]').val(e),$(".predictive-box").hide())})}function createResultsList(e){var t=app.model.raw_data.rows;if(!e)return t;var n=t.filter(function(t){return t.name===e||t.location_name===e||t.location_city===e});return n}function processSearch(e){$(".results-list").html(""),$(".results-section .loader").show(),$('#location-search-form input[type="text"]').val(""),$.when(getData(e)).then(function(t){app.model.locations=createResultsList(e),updateResults(app.model.locations),setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()})}function updateResults(e){console.log("Update Results",e),e.map(function(e,t){var n=e.url,a=e.name,o=e.location_name,i=e.rating||"-",r=e.day_price?"$"+e.day_price+"/day":"",s=e.image_urls2[0];$(".results-list").append('<li \n            id="location-'+t+'" \n            class="result-item" \n            style="background-image:url(\''+s+'\'); display: none;">\n                <a href="'+(n||"#")+'">\n                    <ul class="location-info">\n                        <li>'+a+"</li>\n                        <li>"+o+"</li>\n                        <li>Score: "+i+"</li>\n                        <li>"+r+"</li>\n                    </ul>\n                </a>\n            </li>"),$("#location-"+t).fadeIn(1e3*t)})}function revealResultsArea(){$("html, body").animate({scrollTop:$(".results-section").height()},1e3)}function setEventHandlers(){$("#location-search-form").submit(function(e){var t=$('input[type="text"]').val();e.preventDefault(),t&&(processSearch(t),$('input[type="text"]').val(""),revealResultsArea())}),$('#location-search-form input[type="text"]').focus(function(){$('#location-search-form input[type="text"]').keyup(function(e){var t=$('#location-search-form input[type="text"]').val();predictSearch(t),$(".predictive-box").show()})}),$('#location-search-form input[type="text"]').focusout(function(){$(".predictive-box").is(":hover")||$(".predictive-box").hide()}),$(".predictive-item").on("click",function(){$(".predictive-results").html(""),$(this).data("name"),$(".predictive-box").hide()})}function setDimensionsForResponsiveElements(){$("ul.results-list").css("width",window.innerWidth/5*$(".result-item").length+"px")}var max_results=20,app={model:{raw_data:void 0,locations:void 0,location_names:void 0},components:{main_carousel:void 0},init:function(){if(sessionStorage.getItem("location_data")){var e=sessionStorage.getItem("location_data");app.model.raw_data=JSON.parse(e),console.log("Data from session storate",app.model.raw_data),app.setUp()}else $(".loader").show(),app.setData()},setData:function(){$.when(getData()).then(function(e){console.log("Retrieved data",e),sessionStorage.setItem("location_data",JSON.stringify(e)),app.model.raw_data=e,app.setUp(),$(".loader").fadeOut()})},setUp:function(){app.model.locations=app.model.raw_data.rows;var e=app.model.locations.slice(0,Math.min(max_results,app.model.locations.length-1)),t=app.model.locations.reduce(function(e,t){return e.concat(t.image_urls)},[]);$(document).ready(function(){app.model.location_names=createSearchList(app.model.raw_data.rows),console.log("Location Names",app.model.location_names),app.components.main_carousel=createCarousel("carousel",t),updateResults(e),$(".search-box").show(),setEventHandlers(),setDimensionsForResponsiveElements()})}};app.init(),$(window).resize(function(){setDimensionsForResponsiveElements()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJnZXREYXRhIiwic2VhcmNoX2lucXVpcnkiLCIkIiwiYWpheCIsImRhdGFUeXBlIiwidXJsIiwiY3JlYXRlQ2Fyb3VzZWwiLCJlbGVtZW50IiwiaW1hZ2VfYXJyIiwiY3JlYXRlQ29udHJvbHMiLCJ0ZW1wbGF0ZSIsIiRjYXJvdXNlbCIsImFwcGVuZCIsImZpbmQiLCJvbiIsIm5leHRJbWFnZSIsInByZXZJbWFnZSIsImN1cnJlbnRfaW1hZ2VfaW5kZXgiLCJpbWFnZXMiLCJnb1RvSW1hZ2UiLCJpbmRleCIsImZhZGVPdXQiLCJmYWRlSW4iLCJsZW5ndGgiLCJoaWRlIiwic2hvdyIsInVwZGF0ZVNsaWRlcyIsInNsaWRlcyIsImhlYWRsaW5lcyIsImh0bWwiLCJmb3JFYWNoIiwic2V0SW50ZXJ2YWwiLCJpcyIsImNyZWF0ZVNlYXJjaExpc3QiLCJsb2NhdGlvbnMiLCJwbGFjZV9oYXNoIiwibG9jYXRpb25fbmFtZXMiLCJyZWR1Y2UiLCJhbGxfbmFtZXMiLCJsb2NhdGlvbiIsImNvbmNhdCIsIm5hbWUiLCJsb2NhdGlvbl9uYW1lIiwibG9jYXRpb25fY2l0eSIsImZpbHRlciIsIml0ZW0iLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwicHJlZGljdFNlYXJjaCIsInN0ciIsImxpc3QiLCJhcHAiLCJtb2RlbCIsInBsYWNlIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImZpbGxQcmVkaWN0b3IiLCJzbGljZSIsIiRwcmVkaWN0b3IiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsInVuZGVmaW5lZCIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInZhbHVlIiwiZXJyIiwidGhpcyIsImRhdGEiLCJ2YWwiLCJwcm9jZXNzU2VhcmNoIiwicmV2ZWFsUmVzdWx0c0FyZWEiLCJjcmVhdGVSZXN1bHRzTGlzdCIsInJhd19kYXRhIiwicm93cyIsInJlc3VsdHMiLCJ3aGVuIiwidGhlbiIsInVwZGF0ZVJlc3VsdHMiLCJzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzIiwiY29uc29sZSIsImxvZyIsIm1hcCIsImxvY2F0aW9uX3VybCIsIndvcmtwbGFjZSIsInJldmlld19zY29yZSIsInJhdGluZyIsInByaWNlIiwiZGF5X3ByaWNlIiwiaW1hZ2VfdXJsIiwiaW1hZ2VfdXJsczIiLCJhbmltYXRlIiwic2Nyb2xsVG9wIiwiaGVpZ2h0Iiwic2V0RXZlbnRIYW5kbGVycyIsInN1Ym1pdCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImZvY3VzIiwia2V5dXAiLCJmb2N1c291dCIsImNzcyIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJtYXhfcmVzdWx0cyIsImNvbXBvbmVudHMiLCJtYWluX2Nhcm91c2VsIiwiaW5pdCIsInNlc3Npb25TdG9yYWdlIiwiZ2V0SXRlbSIsImRhdGFTdHJpbmciLCJKU09OIiwicGFyc2UiLCJzZXRVcCIsInNldERhdGEiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiTWF0aCIsIm1pbiIsIm1haW5faW1hZ2VzIiwiYWxsX2ltYWdlcyIsImltYWdlX3VybHMiLCJkb2N1bWVudCIsInJlYWR5IiwicmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLFNBQVFDLEdBR2IsTUFBT0MsR0FBRUMsTUFDTEMsU0FBVSxPQUNWQyxJQUFLLGlUQUliLFFBQVNDLGdCQUFlQyxFQUFTQyxHQU03QixRQUFTQyxLQUNMLEdBQUlDLEdBQUFBLHFjQWFKQyxHQUFVQyxPQUFPRixHQUVqQkMsRUFBVUUsS0FBSyxrQkFBa0JDLEdBQUcsUUFBUyxXQUN6Q0gsRUFBVUksY0FHZEosRUFBVUUsS0FBSyxpQkFBaUJDLEdBQUcsUUFBUyxXQUN4Q0gsRUFBVUssY0F6QmxCLEdBQUlMLEdBQVlULEVBQUVLLEVBa0dsQixPQWpHQUksR0FBVU0sb0JBQXNCLEVBQ2hDTixFQUFVTyxPQUFT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QUFJLGlCQUFrQmIsR0FDOUJ3QyxlQUFlTyxRQUFRLGdCQUFpQkosS0FBS0ssVUFBVWhELElBQ3ZEckIsSUFBSUMsTUFBTXlCLFNBQVdMLEVBQ3JCckIsSUFBSWtFLFFBQ0pySCxFQUFFLFdBQVdtQixhQUlyQmtHLE1BQU8sV0FFSGxFLElBQUlDLE1BQU1wQixVQUFZbUIsSUFBSUMsTUFBTXlCLFNBQVNDLElBQ3pDLElBQUk5QyxHQUFZbUIsSUFBSUMsTUFBTXBCLFVBQVV5QixNQUFNLEVBQUdnRSxLQUFLQyxJQUFJZCxZQUFhekQsSUFBSUMsTUFBTXBCLFVBQVVYLE9BQVMsSUFLNUZzRyxFQUFjeEUsSUFBSUMsTUFBTXBCLFVBQVVHLE9BQU8sU0FBU3lGLEVBQVl2RixHQUM5RCxNQUFPdUYsR0FBV3RGLE9BQU9ELEVBQVN3RixnQkFJdEM3SCxHQUFFOEgsVUFBVUMsTUFBTSxXQUNkNUUsSUFBSUMsTUFBTWxCLGVBQWlCSCxpQkFBaUJvQixJQUFJQyxNQUFNeUIsU0FBU0MsTUFDL0RNLFFBQVFDLElBQUksaUJBQWtCbEMsSUFBSUMsTUFBTWxCLGdCQUN4Q2lCLElBQUkwRCxXQUFXQyxjQUFnQjFHLGVBQWUsV0FBWXVILEdBQzFEekMsY0FBY2xELEdBQ2RoQyxFQUFFLGVBQWV1QixPQUNqQjJFLG1CQUNBZix3Q0FNWmhDLEtBQUk0RCxPQUNKL0csRUFBRTBHLFFBQVFzQixPQUFPLFdBQ2I3QyIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWF4X3Jlc3VsdHMgPSAyMDtcblxuZnVuY3Rpb24gZ2V0RGF0YShzZWFyY2hfaW5xdWlyeSkge1xuICAgIC8vIFNlYXJjaCBpbnF1aXJ5IHdvdWxkIGJlIHVzZWQgdG8gZ2V0IHNwZWNpZmljIHJlc3VsdHMgZnJvbSBBUElcbiAgICAvLyBGb3IgdGhpcyBjaGFsbGVuZ2UsIG9ubHkgdXNpbmcgc3BlY2lmaWVkIHF1ZXJ5IHN0cmluZyBiZWxvdzpcbiAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICB1cmw6ICdodHRwczovL3d3dy5kZXNrYm9va2Vycy5jb20vbmwtbmwvc2FqYXguanNvbj9xPUFtc3RlcmRhbSZ0eXBlPS0mcGVvcGxlPWFueSZmYXZvcml0ZT0wJnBpZD0mc3c9NTIuMjkzNzUzJTJDNC42MzQ5NDImbmU9NTIuNDU1NTYyJTJDNS4xNjIyODYmaWRzPTE3MjAxJTJDMTk2NDAlMkMxMzY5MiUyQzEzNjkxJTJDMTIxMzYlMkMxNzkzOCUyQzE1MjkyJTJDMTQ4ODYlMkMxNDg4NSUyQzE0ODg0JTJDMTQ4ODMlMkMxNTczMCUyQzE1MzUzJTJDMTUzNTElMkMxNTMzMCUyQzE1MDgwJTJDMTcyOTAlMkMxNTQ1NCUyQzE1NDUxJTJDMTUzNzknXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNhcm91c2VsKGVsZW1lbnQsIGltYWdlX2Fycikge1xuXG4gICAgdmFyICRjYXJvdXNlbCA9ICQoZWxlbWVudCk7XG4gICAgJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPSAwOyAvLyBcbiAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gaW1hZ2VfYXJyO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ29udHJvbHMoKSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sLXdyYXBwZXIgbGVmdFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIGxlZnQtY29udHJvbFwiPlxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWNoZXZyb24tbGVmdFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wtd3JhcHBlciByaWdodFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIHJpZ2h0LWNvbnRyb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1jaGV2cm9uLXJpZ2h0XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgJGNhcm91c2VsLmFwcGVuZCh0ZW1wbGF0ZSk7XG5cbiAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwubmV4dEltYWdlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwucHJldkltYWdlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAkKCcuY2Fyb3VzZWwtaXRlbScpLmZhZGVPdXQoMjAwMCk7XG4gICAgICAgICQoYC5jYXJvdXNlbC1pdGVtW2RhdGEtaWQ9XCIke2luZGV4fVwiXWApLmZhZGVJbigyMDAwKTtcblxuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICAvKlxuICAgICAgICAvLyBVbm5lY2Vzc2FyeSB3aXRoIG5ldyBsb29waW5nIGZlYXR1cmVcbiAgICAgICAgZWxzZSBpZiAoJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICB9IGVsc2UgaWYgKCRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID09PSAkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICB9IFxuICAgICAgICAqL1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLnNob3coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC51cGRhdGVTbGlkZXMgPSBmdW5jdGlvbihzbGlkZXMsIGhlYWRsaW5lcykge1xuICAgICAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gc2xpZGVzO1xuICAgICAgICAkY2Fyb3VzZWwuZmluZCgndWwnKS5odG1sKFwiXCIpO1xuICAgICAgICBzbGlkZXMuZm9yRWFjaChmdW5jdGlvbih1cmwsIGluZGV4KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHsgLy8gVHlwZSBjaGVja1xuICAgICAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCd1bCcpLmFwcGVuZChgPGxpIFxuICAgICAgICAgICAgICAgICAgICBpZD1cImltYWdlLSR7aW5kZXh9XCIgXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCIke2luZGV4fVwiIFxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImNhcm91c2VsLWl0ZW1cIiBcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHt1cmx9JylcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzcz1cImhlYWRsaW5lXCI+JHtoZWFkbGluZXNbaW5kZXhdIHx8IFwiSGVhZGxpbmUgI1wiICsgKGluZGV4KzEpfTwvaDE+XG4gICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoMCk7XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLm5leHRJbWFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlc1skY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCArIDFdKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKCsrJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTG9vcFxuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgwKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC5wcmV2SW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRjYXJvdXNlbC5pbWFnZXNbJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggLSAxXSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgtLSRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIExvb3BcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY3JlYXRlQ29udHJvbHMoKTtcbiAgICAkY2Fyb3VzZWwuYXBwZW5kKCc8dWw+PC91bD4nKTtcbiAgICAkY2Fyb3VzZWwudXBkYXRlU2xpZGVzKGltYWdlX2FyciwgW1wiRmFzdCwgRWFzeSwgRmxleGlibGVcIiwgXCJCb29rIG9uZSBvZiBvdXIgc3BhY2VzXCJdKTtcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkY2Fyb3VzZWwuaXMoXCI6aG92ZXJcIikpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5uZXh0SW1hZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sIDYwMDApO1xuICAgIHJldHVybiAkY2Fyb3VzZWw7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNlYXJjaExpc3QobG9jYXRpb25zKSB7XG4gICAgbGV0IHBsYWNlX2hhc2ggPSB7fTtcbiAgICAvLyBDcmVhdGUgYSBsaXN0IG9mIHBsYWNlcyB0byBzZWFyY2hcbiAgICBsZXQgbG9jYXRpb25fbmFtZXMgPSBsb2NhdGlvbnMucmVkdWNlKGZ1bmN0aW9uKGFsbF9uYW1lcywgbG9jYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbGxfbmFtZXMuY29uY2F0KFtsb2NhdGlvbi5uYW1lLCBsb2NhdGlvbi5sb2NhdGlvbl9uYW1lLCBsb2NhdGlvbi5sb2NhdGlvbl9jaXR5XSk7XG4gICAgICAgIH0sIFtdKVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIGlmICghcGxhY2VfaGFzaFtpdGVtXSkge1xuICAgICAgICAgICAgICAgIHBsYWNlX2hhc2hbaXRlbV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgLy8gU29ydCBsaXN0IGFuZCByZXR1cm5cbiAgICBsb2NhdGlvbl9uYW1lcy5zb3J0KChhLCBiKSA9PiBhLmxvY2FsZUNvbXBhcmUoYikpO1xuICAgIHJldHVybiBsb2NhdGlvbl9uYW1lcztcbn1cblxuZnVuY3Rpb24gcHJlZGljdFNlYXJjaChzdHIpIHtcbiAgICAvLyBQcmVkaWN0IGJ5IGxvY2F0aW9uIG5hbWVcbiAgICAvLyBGaWx0ZXIgbGlzdCBieSBpbnB1dCBzdHJpbmdcbiAgICBsZXQgbGlzdCA9IGFwcC5tb2RlbC5sb2NhdGlvbl9uYW1lcy5maWx0ZXIoZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgICAgcmV0dXJuIHBsYWNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc3RyLnRvTG93ZXJDYXNlKCkpO1xuICAgIH0pO1xuXG4gICAgLy8gRnVsbCBwcmVkaWN0b3Igd2l0aCBvbmx5IHRvcCA1IHJlc3VsdHNcbiAgICBmaWxsUHJlZGljdG9yKCcucHJlZGljdGl2ZS1yZXN1bHRzJywgbGlzdC5zbGljZSgwLCA1KSk7XG59XG5cbmZ1bmN0aW9uIGZpbGxQcmVkaWN0b3IoZWxlbWVudCwgbGlzdCkge1xuICAgIHZhciAkcHJlZGljdG9yID0gJChlbGVtZW50KTtcbiAgICAkcHJlZGljdG9yLmh0bWwoXCJcIik7XG4gICAgJHByZWRpY3Rvci5hcHBlbmQoYFxuICAgICAgICAgICAgPGxpIGRhdGEtaWQ9XCJcIiBcbiAgICAgICAgICAgICAgICBjbGFzcz1cInByZWRpY3RpdmUtaXRlbVwiXG4gICAgICAgICAgICAgICAgZGF0YS1uYW1lPVwiQWxsXCI+U2VhcmNoIGFsbCBsb2NhdGlvbnMuLjwvbGk+YCk7XG4gICAgZm9yIChsZXQgbG9jYXRpb24gb2YgbGlzdCkge1xuICAgICAgICAkcHJlZGljdG9yLmFwcGVuZChgXG4gICAgICAgICAgICA8bGkgZGF0YS1pZD1cIlwiIFxuICAgICAgICAgICAgICAgIGNsYXNzPVwicHJlZGljdGl2ZS1pdGVtXCJcbiAgICAgICAgICAgICAgICBkYXRhLW5hbWU9XCIke2xvY2F0aW9ufVwiPiR7bG9jYXRpb259PC9saT5gKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgaGFuZGxlclxuICAgICQoJy5wcmVkaWN0aXZlLWl0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbGV0IG5hbWUgPSAkKHRoaXMpLmRhdGEoJ25hbWUnKTtcbiAgICAgICAgaWYgKG5hbWUgPT09IFwiQWxsXCIpIHtcbiAgICAgICAgICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChcIlwiKTtcbiAgICAgICAgICAgIHByb2Nlc3NTZWFyY2goKTtcbiAgICAgICAgICAgIHJldmVhbFJlc3VsdHNBcmVhKCk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwobmFtZSk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9KVxufVxuXG5mdW5jdGlvbiBjcmVhdGVSZXN1bHRzTGlzdChzdHIpIHtcbiAgICBsZXQgbG9jYXRpb25zID0gYXBwLm1vZGVsLnJhd19kYXRhLnJvd3M7XG4gICAgaWYgKCFzdHIpIHJldHVybiBsb2NhdGlvbnM7IC8vIElmIG5vIHNlYXJjaCBjcml0ZXJpYSwgcmV0dXJuIHdob2xlIGxpc3RcbiAgICBsZXQgcmVzdWx0cyA9IGxvY2F0aW9ucy5maWx0ZXIoZnVuY3Rpb24obG9jYXRpb24pIHtcbiAgICAgICAgaWYobG9jYXRpb24ubmFtZSA9PT0gc3RyIHx8IFxuICAgICAgICAgICBsb2NhdGlvbi5sb2NhdGlvbl9uYW1lID09PSBzdHIgfHxcbiAgICAgICAgICAgbG9jYXRpb24ubG9jYXRpb25fY2l0eSA9PT0gc3RyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NTZWFyY2goc3RyKSB7XG4gICAgLy8gRmlyc3QgY2xlYXIgcmVzdWx0cyBhbmQgc2hvdyBsb2FkZXJcbiAgICAkKCcucmVzdWx0cy1saXN0JykuaHRtbChcIlwiKTtcbiAgICAkKCcucmVzdWx0cy1zZWN0aW9uIC5sb2FkZXInKS5zaG93KCk7XG4gICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICQud2hlbihnZXREYXRhKHN0cikpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBQcmV0ZW5kIHRvIGdldCBuZXcgc2VhcmNoIHJlc3VsdHMgd2l0aCBuZXcgcXVlcnlcbiAgICAgICAgLy8gYW5kIHVwZGF0ZSBtb2RlbFxuICAgICAgICBhcHAubW9kZWwubG9jYXRpb25zID0gY3JlYXRlUmVzdWx0c0xpc3Qoc3RyKTtcblxuICAgICAgICAvLyBVcGRhdGUgcmVzdWx0cyBhbmQgcmVzZXQgcmVzcG9uc2l2ZSBlbGVtZW50c1xuICAgICAgICB1cGRhdGVSZXN1bHRzKGFwcC5tb2RlbC5sb2NhdGlvbnMpO1xuICAgICAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7XG4gICAgICAgIC8vIEhpZGUgbG9hZGVyIGFmdGVyIGxvYWRpbmcgbmV3IHJlc3VsdHNcbiAgICAgICAgJCgnLnJlc3VsdHMtc2VjdGlvbiAubG9hZGVyJykuZmFkZU91dCgpO1xuICAgIH0pO1xuXG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVJlc3VsdHMobG9jYXRpb25zKSB7XG4gICAgLy8gRmlsbCByZXN1bHRzIGRpdlxuICAgIGNvbnNvbGUubG9nKCdVcGRhdGUgUmVzdWx0cycsIGxvY2F0aW9ucyk7XG4gICAgbG9jYXRpb25zLm1hcChmdW5jdGlvbihsb2NhdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgbGV0IGxvY2F0aW9uX3VybCA9IGxvY2F0aW9uLnVybDtcbiAgICAgICAgbGV0IHdvcmtwbGFjZSA9IGxvY2F0aW9uLm5hbWU7XG4gICAgICAgIGxldCBsb2NhdGlvbl9uYW1lID0gbG9jYXRpb24ubG9jYXRpb25fbmFtZTtcbiAgICAgICAgbGV0IHJldmlld19zY29yZSA9IGxvY2F0aW9uLnJhdGluZyB8fCBcIi1cIjtcbiAgICAgICAgbGV0IHByaWNlID0gKGxvY2F0aW9uLmRheV9wcmljZSkgPyAnJCcgKyBsb2NhdGlvbi5kYXlfcHJpY2UgKyBcIi9kYXlcIiA6IFwiXCI7XG4gICAgICAgIGxldCBpbWFnZV91cmwgPSBsb2NhdGlvbi5pbWFnZV91cmxzMlswXTsgLy8gVXNlIHNtYWxsZXIgdGh1bWJzXG5cbiAgICAgICAgJCgnLnJlc3VsdHMtbGlzdCcpLmFwcGVuZChgPGxpIFxuICAgICAgICAgICAgaWQ9XCJsb2NhdGlvbi0ke2luZGV4fVwiIFxuICAgICAgICAgICAgY2xhc3M9XCJyZXN1bHQtaXRlbVwiIFxuICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHtpbWFnZV91cmx9Jyk7IGRpc3BsYXk6IG5vbmU7XCI+XG4gICAgICAgICAgICAgICAgPGEgaHJlZj1cIiR7bG9jYXRpb25fdXJsIHx8IFwiI1wifVwiPlxuICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9XCJsb2NhdGlvbi1pbmZvXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHt3b3JrcGxhY2V9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4ke2xvY2F0aW9uX25hbWV9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5TY29yZTogJHtyZXZpZXdfc2NvcmV9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4ke3ByaWNlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgPC9saT5gKTtcbiAgICAgICAgJCgnI2xvY2F0aW9uLScraW5kZXgpLmZhZGVJbigxMDAwICogaW5kZXgpOyAvLyBDcmVhdGVzIGNvb2wgcHJvZ3Jlc3NpdmUgZmFkZSBpblxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiByZXZlYWxSZXN1bHRzQXJlYSgpIHtcbiAgICAvLyBTY3JvbGwgZG93biB0byBkaXNwbGF5IHJlc3VsdHNcbiAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogJChcIi5yZXN1bHRzLXNlY3Rpb25cIikuaGVpZ2h0KClcbiAgICAgfSwgMTAwMCk7XG59XG5cbmZ1bmN0aW9uIHNldEV2ZW50SGFuZGxlcnMoKSB7XG4gICAgLy8gU2VhcmNoIGZvcm1cbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgc2VhcmNoX2lucXVpcnkgPSAkKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbCgpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmKHNlYXJjaF9pbnF1aXJ5KSB7XG4gICAgICAgICAgICBwcm9jZXNzU2VhcmNoKHNlYXJjaF9pbnF1aXJ5KTtcbiAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICAgICAgICAgcmV2ZWFsUmVzdWx0c0FyZWEoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2VhcmNoIGZvcm0gcHJlZGljdGl2ZSBzZWFyY2hcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5mb2N1cyhmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gV2hlbiBmb2N1cyBpcyBvbiBzZWFyY2ggaW5wdXRcbiAgICAgICAgLy8gRXZhbHVhdGUgc3RyaW5nIG9uIGtleXVwIC0ga2V5ZG93biBmaXJlcyBiZWZvcmUgdGV4dCBpcyBhdmFpbGFibGVcbiAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykua2V5dXAoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgbGV0IHNlYXJjaF9pbnF1aXJ5ID0gJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdLZXkgRG93bicpO1xuICAgICAgICAgICAgcHJlZGljdFNlYXJjaChzZWFyY2hfaW5xdWlyeSk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5zaG93KCk7XG4gICAgICAgIH0pXG4gICAgfSk7XG5cbiAgICAvLyBIaWRlIHByZWRpY3Rpb24gYm94IHdoZW4gZm9jdXMgaXNuJ3Qgb24gc2VhcmNoXG4gICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykuZm9jdXNvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghJCgnLnByZWRpY3RpdmUtYm94JykuaXMoXCI6aG92ZXJcIikpIHtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRmlsbCBzZWFyY2ggYmFyIHdpdGggd2hhdGV2ZXIgYSB1c2VyIHNlbGVjdHMgZnJvbSBsaXN0XG4gICAgJCgnLnByZWRpY3RpdmUtaXRlbScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkKCcucHJlZGljdGl2ZS1yZXN1bHRzJykuaHRtbChcIlwiKTtcbiAgICAgICAgJCh0aGlzKS5kYXRhKCduYW1lJyk7XG4gICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCkge1xuICAgICQoJ3VsLnJlc3VsdHMtbGlzdCcpLmNzcygnd2lkdGgnLCB3aW5kb3cuaW5uZXJXaWR0aCAvIDUgKiAkKCcucmVzdWx0LWl0ZW0nKS5sZW5ndGggKyAncHgnKTtcbn1cblxudmFyIGFwcCA9IHtcbiAgICAvLyBJbml0aWFsaXplIHRoZSBhcHBcbiAgICAvLyBUaGlzIGxheXMgb3V0IHRoZSBzdHJ1Y3R1cmVcbiAgICBtb2RlbDoge1xuICAgICAgICByYXdfZGF0YTogdW5kZWZpbmVkLCAvL0FsbCBkYXRhIGZyb20gc2VydmVyXG4gICAgICAgIGxvY2F0aW9uczogdW5kZWZpbmVkLCAvL0N1cnJlbnQgcmVzdWx0IGRhdGFcbiAgICAgICAgbG9jYXRpb25fbmFtZXM6IHVuZGVmaW5lZCAvL1Bvc3NpYmxlIHNlYXJjaCByZXN1bHRzXG4gICAgfSxcbiAgICBjb21wb25lbnRzOiB7XG4gICAgICAgIG1haW5fY2Fyb3VzZWw6IHVuZGVmaW5lZCAvLyBcbiAgICB9LFxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBVc2Ugc2Vzc2lvbiBzdG9yYWdlIGlmIGF2YWlsYWJsZVxuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbG9jYXRpb25fZGF0YScpKSB7XG4gICAgICAgICAgICBsZXQgZGF0YVN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2xvY2F0aW9uX2RhdGEnKTtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5yYXdfZGF0YSA9IEpTT04ucGFyc2UoZGF0YVN0cmluZyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRGF0YSBmcm9tIHNlc3Npb24gc3RvcmF0ZScsIGFwcC5tb2RlbC5yYXdfZGF0YSk7XG4gICAgICAgICAgICBhcHAuc2V0VXAoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoJy5sb2FkZXInKS5zaG93KCk7XG4gICAgICAgICAgICBhcHAuc2V0RGF0YSgpO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIEdldCBhbmQgc2V0IGRhdGEgZnJvbSB0aGUgQVBJXG4gICAgc2V0RGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICQud2hlbihnZXREYXRhKCkpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JldHJpZXZlZCBkYXRhJywgZGF0YSk7XG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdsb2NhdGlvbl9kYXRhJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgYXBwLm1vZGVsLnJhd19kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIGFwcC5zZXRVcCgpO1xuICAgICAgICAgICAgJCgnLmxvYWRlcicpLmZhZGVPdXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICAvLyBTZXQgdXAgdmlld3NcbiAgICBzZXRVcDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFNldCByZXN1bHQgZGF0YSBmcm9tIGFsbCBkYXRhXG4gICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbnMgPSBhcHAubW9kZWwucmF3X2RhdGEucm93cztcbiAgICAgICAgdmFyIGxvY2F0aW9ucyA9IGFwcC5tb2RlbC5sb2NhdGlvbnMuc2xpY2UoMCwgTWF0aC5taW4obWF4X3Jlc3VsdHMsIGFwcC5tb2RlbC5sb2NhdGlvbnMubGVuZ3RoIC0gMSkpO1xuXG4gICAgICAgIC8vIFRoaXMgd2FzIGluaXRpYWxseSBzZXQgdXAgdG8ganVzdCBoYXZlIGEgY2Fyb3VzZWwgZm9yIG9uZSBsb2NhdGlvblxuICAgICAgICAvLyB2YXIgbWFpbl9pbWFnZXMgPSBsb2NhdGlvbnNbMF0uaW1hZ2VfdXJscy5jb25jYXQobG9jYXRpb25zWzBdLmltYWdlX3VybHMyKTtcblxuICAgICAgICB2YXIgbWFpbl9pbWFnZXMgPSBhcHAubW9kZWwubG9jYXRpb25zLnJlZHVjZShmdW5jdGlvbihhbGxfaW1hZ2VzLCBsb2NhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGFsbF9pbWFnZXMuY29uY2F0KGxvY2F0aW9uLmltYWdlX3VybHMpO1xuICAgICAgICB9LCBbXSk7XG5cbiAgICAgICAgLy8gV2FpdCBmb3IgdGhlIGRvY3VtZXQgcmVhZHkgYmVmb3JlIGJ1aWxkaW5nIHZpZXdzXG4gICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9uX25hbWVzID0gY3JlYXRlU2VhcmNoTGlzdChhcHAubW9kZWwucmF3X2RhdGEucm93cyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTG9jYXRpb24gTmFtZXMnLCBhcHAubW9kZWwubG9jYXRpb25fbmFtZXMpO1xuICAgICAgICAgICAgYXBwLmNvbXBvbmVudHMubWFpbl9jYXJvdXNlbCA9IGNyZWF0ZUNhcm91c2VsKCdjYXJvdXNlbCcsIG1haW5faW1hZ2VzKTtcbiAgICAgICAgICAgIHVwZGF0ZVJlc3VsdHMobG9jYXRpb25zKTtcbiAgICAgICAgICAgICQoJy5zZWFyY2gtYm94Jykuc2hvdygpO1xuICAgICAgICAgICAgc2V0RXZlbnRIYW5kbGVycygpO1xuICAgICAgICAgICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8vIFN0YXJ0IHByb2Nlc3NcbmFwcC5pbml0KCk7XG4kKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbn0pXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
