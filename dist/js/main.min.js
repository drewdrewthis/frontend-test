"use strict";function getData(e){return $.ajax({dataType:"json",url:"https://www.deskbookers.com/nl-nl/sajax.json?q=Amsterdam&type=-&people=any&favorite=0&pid=&sw=52.293753%2C4.634942&ne=52.455562%2C5.162286&ids=17201%2C19640%2C13692%2C13691%2C12136%2C17938%2C15292%2C14886%2C14885%2C14884%2C14883%2C15730%2C15353%2C15351%2C15330%2C15080%2C17290%2C15454%2C15451%2C15379"})}function setDimensionsForResponsiveElements(){$("ul.results-list").css("width",window.innerWidth/5*$(".result-item").length+"px")}function createCarousel(e,t){function n(){var e='\n            <div class="control-wrapper left">\n                <div class="control left-control">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                </div>\n            </div>\n            <div class="control-wrapper right">\n                <div class="control right-control">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                </div>\n            </div>\n        ';a.append(e),a.find(".right-control").on("click",function(){a.nextImage()}),a.find(".left-control").on("click",function(){a.prevImage()})}var a=$(e);return a.current_image_index=0,a.images=t,a.goToImage=function(e){$(".carousel-item").fadeOut(2e3),$('.carousel-item[data-id="'+e+'"]').fadeIn(2e3),0===a.images.length?a.find(".control").hide():a.find(".control").show()},a.updateSlides=function(e,t){a.images=e,a.find("ul").html(""),e.forEach(function(e,n){"string"==typeof e&&a.find("ul").append('<li \n                    id="image-'+n+'" \n                    data-id="'+n+'" \n                    class="carousel-item" \n                    style="background-image:url(\''+e+'\')">\n                        <h1 class="headline">'+(t[n]||"Headline #"+(n+1))+"</h1>\n                    </li>\n                ")}),a.goToImage(0)},a.nextImage=function(){a.images[a.current_image_index+1]?a.goToImage(++a.current_image_index):(a.goToImage(0),a.current_image_index=0)},a.prevImage=function(){a.images[a.current_image_index-1]?a.goToImage(--a.current_image_index):(a.goToImage(a.images.length-1),a.current_image_index=a.images.length-1)},n(),a.append("<ul></ul>"),a.updateSlides(t,["Fast, Easy, Flexible","Book one of our spaces"]),setInterval(function(){a.is(":hover")||a.nextImage()},6e3),a}function updateResults(e){console.log("Update Results",e),e.map(function(e,t){var n=e.url,a=e.name,o=e.location_name,i=e.rating||"-",r=e.day_price?"$"+e.day_price+"/day":"",s=e.image_urls2[0];$(".results-list").append('<li \n            id="location-'+t+'" \n            class="result-item" \n            style="background-image:url(\''+s+'\'); display: none;">\n                <a href="'+(n||"#")+'">\n                    <ul class="location-info">\n                        <li>'+a+"</li>\n                        <li>"+o+"</li>\n                        <li>Score: "+i+"</li>\n                        <li>"+r+"</li>\n                    </ul>\n                </a>\n            </li>"),$("#location-"+t).fadeIn(1e3*t)})}function revealResultsArea(){$("html, body").animate({scrollTop:$(".results-section").height()},1e3)}function createSearchList(e){var t={},n=e.reduce(function(e,t){return e.concat([t.name,t.location_name,t.location_city])},[]).filter(function(e){return!t[e]&&(t[e]=!0,!0)});return n.sort(function(e,t){return e.localeCompare(t)}),n}function predictSearch(e){var t=app.model.location_names.filter(function(t){return t.toLowerCase().includes(e.toLowerCase())});fillPredictor(".predictive-results",t.slice(0,5))}function fillPredictor(e,t){var n=$(e);n.html(""),n.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="All">Search all locations..</li>');var a=!0,o=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){var l=r.value;n.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="'+l+'">'+l+"</li>")}}catch(c){o=!0,i=c}finally{try{!a&&s["return"]&&s["return"]()}finally{if(o)throw i}}$(".predictive-item").on("click",function(){var e=$(this).data("name");"All"===e?($('#location-search-form input[type="text"]').val(""),processSearch(),revealResultsArea(),$(".predictive-box").hide()):($('#location-search-form input[type="text"]').val(e),$(".predictive-box").hide())})}function createResultsList(e){var t=app.model.raw_data.rows;if(!e)return t;var n=t.filter(function(t){return t.name===e||t.location_name===e||t.location_city===e});return n}function processSearch(e){$(".results-list").html(""),$(".results-section .loader").show(),$('#location-search-form input[type="text"]').val(""),$.when(getData(e)).then(function(t){app.model.locations=createResultsList(e),updateResults(app.model.locations),setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()})}function setEventHandlers(){$("#location-search-form").submit(function(e){var t=$('input[type="text"]').val();e.preventDefault(),t&&(processSearch(t),$('input[type="text"]').val(""),revealResultsArea())}),$('#location-search-form input[type="text"]').focus(function(){$('#location-search-form input[type="text"]').keyup(function(e){var t=$('#location-search-form input[type="text"]').val();predictSearch(t),$(".predictive-box").show()})}),$('#location-search-form input[type="text"]').focusout(function(){$(".predictive-box").is(":hover")||$(".predictive-box").hide()}),$(".predictive-item").on("click",function(){$(".predictive-results").html(""),$(this).data("name"),$(".predictive-box").hide()})}var max_results=20,app={model:{raw_data:void 0,locations:void 0,location_names:void 0},components:{main_carousel:void 0},init:function(){if(sessionStorage.getItem("location_data")){var e=sessionStorage.getItem("location_data");app.model.raw_data=JSON.parse(e),console.log("Data from session storate",app.model.raw_data),app.setUp()}else $(".loader").show(),app.setData()},setData:function(){$.when(getData()).then(function(e){console.log("Retrieved data",e),sessionStorage.setItem("location_data",JSON.stringify(e)),app.model.raw_data=e,app.setUp(),$(".loader").fadeOut()})},setUp:function(){app.model.locations=app.model.raw_data.rows;var e=app.model.locations.slice(0,Math.min(max_results,app.model.locations.length-1)),t=app.model.locations.reduce(function(e,t){return e.concat(t.image_urls)},[]);$(document).ready(function(){app.model.location_names=createSearchList(app.model.raw_data.rows),console.log("Location Names",app.model.location_names),app.components.main_carousel=createCarousel("carousel",t),updateResults(e),$(".search-box").show(),setEventHandlers(),setDimensionsForResponsiveElements()})}};app.init(),$(window).resize(function(){setDimensionsForResponsiveElements()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJjcmVhdGVDYXJvdXNlbC5qcyIsInJlc3VsdHNfZnVuY3Rpb25zLmpzIiwic2VhcmNoX2Z1bmN0aW9ucy5qcyIsInNldEV2ZW50SGFuZGxlcnMuanMiXSwibmFtZXMiOlsiZ2V0RGF0YSIsInNlYXJjaF9pbnF1aXJ5IiwiJCIsImFqYXgiLCJkYXRhVHlwZSIsInVybCIsInNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMiLCJjc3MiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwibGVuZ3RoIiwiY3JlYXRlQ2Fyb3VzZWwiLCJlbGVtZW50IiwiaW1hZ2VfYXJyIiwiY3JlYXRlQ29udHJvbHMiLCJ0ZW1wbGF0ZSIsIiRjYXJvdXNlbCIsImFwcGVuZCIsImZpbmQiLCJvbiIsIm5leHRJbWFnZSIsInByZXZJbWFnZSIsImN1cnJlbnRfaW1hZ2VfaW5kZXgiLCJpbWFnZXMiLCJnb1RvSW1hZ2UiLCJpbmRleCIsImZhZGVPdXQiLCJmYWRlSW4iLCJoaWRlIiwic2hvdyIsInVwZGF0ZVNsaWRlcyIsInNsaWRlcyIsImhlYWRsaW5lcyIsImh0bWwiLCJmb3JFYWNoIiwic2V0SW50ZXJ2YWwiLCJpcyIsInVwZGF0ZVJlc3VsdHMiLCJsb2NhdGlvbnMiLCJjb25zb2xlIiwibG9nIiwibWFwIiwibG9jYXRpb24iLCJsb2NhdGlvbl91cmwiLCJ3b3JrcGxhY2UiLCJuYW1lIiwibG9jYXRpb25fbmFtZSIsInJldmlld19zY29yZSIsInJhdGluZyIsInByaWNlIiwiZGF5X3ByaWNlIiwiaW1hZ2VfdXJsIiwiaW1hZ2VfdXJsczIiLCJyZXZlYWxSZXN1bHRzQXJlYSIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJoZWlnaHQiLCJjcmVhdGVTZWFyY2hMaXN0IiwicGxhY2VfaGFzaCIsImxvY2F0aW9uX25hbWVzIiwicmVkdWNlIiwiYWxsX25hbWVzIiwiY29uY2F0IiwibG9jYXRpb25fY2l0eSIsImZpbHRlciIsIml0ZW0iLCJzb3J0IiwiYSIsImIiLCJsb2NhbGVDb21wYXJlIiwicHJlZGljdFNlYXJjaCIsInN0ciIsImxpc3QiLCJhcHAiLCJtb2RlbCIsInBsYWNlIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImZpbGxQcmVkaWN0b3IiLCJzbGljZSIsIiRwcmVkaWN0b3IiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsInVuZGVmaW5lZCIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInZhbHVlIiwiZXJyIiwidGhpcyIsImRhdGEiLCJ2YWwiLCJwcm9jZXNzU2VhcmNoIiwiY3JlYXRlUmVzdWx0c0xpc3QiLCJyYXdfZGF0YSIsInJvd3MiLCJyZXN1bHRzIiwid2hlbiIsInRoZW4iLCJzZXRFdmVudEhhbmRsZXJzIiwic3VibWl0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiZm9jdXMiLCJrZXl1cCIsImZvY3Vzb3V0IiwibWF4X3Jlc3VsdHMiLCJjb21wb25lbnRzIiwibWFpbl9jYXJvdXNlbCIsImluaXQiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJkYXRhU3RyaW5nIiwiSlNPTiIsInBhcnNlIiwic2V0VXAiLCJzZXREYXRhIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsIk1hdGgiLCJtaW4iLCJtYWluX2ltYWdlcyIsImFsbF9pbWFnZXMiLCJpbWFnZV91cmxzIiwiZG9jdW1lbnQiLCJyZWFkeSIsInJlc2l6ZSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFJQSxTQUFTQSxTQUFRQyxHQUdiLE1BQU9DLEdBQUVDLE1BQ0xDLFNBQVUsT0FDVkMsSUFBSyxpVEFJYixRQUFTQyxzQ0FDTEosRUFBRSxtQkFBbUJLLElBQUksUUFBU0MsT0FBT0MsV0FBYSxFQUFJUCxFQUFFLGdCQUFnQlEsT0FBUyxNQ2R6RixRQUFTQyxnQkFBZUMsRUFBU0MsR0FNN0IsUUFBU0MsS0FDTCxHQUFJQyxHQUFBQSxxY0FhSkMsR0FBVUMsT0FBT0YsR0FF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VzJCLE9BQ2I0QyxJQUFJK0MsV0FLWkEsUUFBUyxXQUNMdEgsRUFBRW1HLEtBQUtyRyxXQUFXc0csS0FBSyxTQUFTUixHQUM1QnZELFFBQVFDLElBQUksaUJBQWtCc0QsR0FDOUJvQixlQUFlTyxRQUFRLGdCQUFpQkosS0FBS0ssVUFBVTVCLElBQ3ZEckIsSUFBSUMsTUFBTXdCLFNBQVdKLEVBQ3JCckIsSUFBSThDLFFBQ0pySCxFQUFFLFdBQVd3QixhQUlyQjZGLE1BQU8sV0FFSDlDLElBQUlDLE1BQU1wQyxVQUFZbUMsSUFBSUMsTUFBTXdCLFNBQVNDLElBQ3pDLElBQUk3RCxHQUFZbUMsSUFBSUMsTUFBTXBDLFVBQVV5QyxNQUFNLEVBQUc0QyxLQUFLQyxJQUFJZCxZQUFhckMsSUFBSUMsTUFBTXBDLFVBQVU1QixPQUFTLElBSzVGbUgsRUFBY3BELElBQUlDLE1BQU1wQyxVQUFVc0IsT0FBTyxTQUFTa0UsRUFBWXBGLEdBQzlELE1BQU9vRixHQUFXaEUsT0FBT3BCLEVBQVNxRixnQkFJdEM3SCxHQUFFOEgsVUFBVUMsTUFBTSxXQUNkeEQsSUFBSUMsTUFBTWYsZUFBaUJGLGlCQUFpQmdCLElBQUlDLE1BQU13QixTQUFTQyxNQUMvRDVELFFBQVFDLElBQUksaUJBQWtCaUMsSUFBSUMsTUFBTWYsZ0JBQ3hDYyxJQUFJc0MsV0FBV0MsY0FBZ0JyRyxlQUFlLFdBQVlrSCxHQUMxRHhGLGNBQWNDLEdBQ2RwQyxFQUFFLGVBQWUyQixPQUNqQjBFLG1CQUNBakcsd0NBTVptRSxLQUFJd0MsT0FDSi9HLEVBQUVNLFFBQVEwSCxPQUFPLFdBQ2I1SCIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWF4X3Jlc3VsdHMgPSAyMDtcblxuZnVuY3Rpb24gZ2V0RGF0YShzZWFyY2hfaW5xdWlyeSkge1xuICAgIC8vIFNlYXJjaCBpbnF1aXJ5IHdvdWxkIGJlIHVzZWQgdG8gZ2V0IHNwZWNpZmljIHJlc3VsdHMgZnJvbSBBUElcbiAgICAvLyBGb3IgdGhpcyBjaGFsbGVuZ2UsIG9ubHkgdXNpbmcgc3BlY2lmaWVkIHF1ZXJ5IHN0cmluZyBiZWxvdzpcbiAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICB1cmw6ICdodHRwczovL3d3dy5kZXNrYm9va2Vycy5jb20vbmwtbmwvc2FqYXguanNvbj9xPUFtc3RlcmRhbSZ0eXBlPS0mcGVvcGxlPWFueSZmYXZvcml0ZT0wJnBpZD0mc3c9NTIuMjkzNzUzJTJDNC42MzQ5NDImbmU9NTIuNDU1NTYyJTJDNS4xNjIyODYmaWRzPTE3MjAxJTJDMTk2NDAlMkMxMzY5MiUyQzEzNjkxJTJDMTIxMzYlMkMxNzkzOCUyQzE1MjkyJTJDMTQ4ODYlMkMxNDg4NSUyQzE0ODg0JTJDMTQ4ODMlMkMxNTczMCUyQzE1MzUzJTJDMTUzNTElMkMxNTMzMCUyQzE1MDgwJTJDMTcyOTAlMkMxNTQ1NCUyQzE1NDUxJTJDMTUzNzknXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKSB7XG4gICAgJCgndWwucmVzdWx0cy1saXN0JykuY3NzKCd3aWR0aCcsIHdpbmRvdy5pbm5lcldpZHRoIC8gNSAqICQoJy5yZXN1bHQtaXRlbScpLmxlbmd0aCArICdweCcpO1xufVxuXG52YXIgYXBwID0ge1xuICAgIC8vIEluaXRpYWxpemUgdGhlIGFwcFxuICAgIC8vIFRoaXMgbGF5cyBvdXQgdGhlIHN0cnVjdHVyZVxuICAgIG1vZGVsOiB7XG4gICAgICAgIHJhd19kYXRhOiB1bmRlZmluZWQsIC8vQWxsIGRhdGEgZnJvbSBzZXJ2ZXJcbiAgICAgICAgbG9jYXRpb25zOiB1bmRlZmluZWQsIC8vQ3VycmVudCByZXN1bHQgZGF0YVxuICAgICAgICBsb2NhdGlvbl9uYW1lczogdW5kZWZpbmVkIC8vUG9zc2libGUgc2VhcmNoIHJlc3VsdHNcbiAgICB9LFxuICAgIGNvbXBvbmVudHM6IHtcbiAgICAgICAgbWFpbl9jYXJvdXNlbDogdW5kZWZpbmVkIC8vIFxuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFVzZSBzZXNzaW9uIHN0b3JhZ2UgaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsb2NhdGlvbl9kYXRhJykpIHtcbiAgICAgICAgICAgIGxldCBkYXRhU3RyaW5nID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbG9jYXRpb25fZGF0YScpO1xuICAgICAgICAgICAgYXBwLm1vZGVsLnJhd19kYXRhID0gSlNPTi5wYXJzZShkYXRhU3RyaW5nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEYXRhIGZyb20gc2Vzc2lvbiBzdG9yYXRlJywgYXBwLm1vZGVsLnJhd19kYXRhKTtcbiAgICAgICAgICAgIGFwcC5zZXRVcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLmxvYWRlcicpLnNob3coKTtcbiAgICAgICAgICAgIGFwcC5zZXREYXRhKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8gR2V0IGFuZCBzZXQgZGF0YSBmcm9tIHRoZSBBUElcbiAgICBzZXREYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJC53aGVuKGdldERhdGEoKSkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmV0cmlldmVkIGRhdGEnLCBkYXRhKTtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2xvY2F0aW9uX2RhdGEnLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICBhcHAubW9kZWwucmF3X2RhdGEgPSBkYXRhO1xuICAgICAgICAgICAgYXBwLnNldFVwKCk7XG4gICAgICAgICAgICAkKCcubG9hZGVyJykuZmFkZU91dCgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIC8vIFNldCB1cCB2aWV3c1xuICAgIHNldFVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gU2V0IHJlc3VsdCBkYXRhIGZyb20gYWxsIGRhdGFcbiAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9ucyA9IGFwcC5tb2RlbC5yYXdfZGF0YS5yb3dzO1xuICAgICAgICB2YXIgbG9jYXRpb25zID0gYXBwLm1vZGVsLmxvY2F0aW9ucy5zbGljZSgwLCBNYXRoLm1pbihtYXhfcmVzdWx0cywgYXBwLm1vZGVsLmxvY2F0aW9ucy5sZW5ndGggLSAxKSk7XG5cbiAgICAgICAgLy8gVGhpcyB3YXMgaW5pdGlhbGx5IHNldCB1cCB0byBqdXN0IGhhdmUgYSBjYXJvdXNlbCBmb3Igb25lIGxvY2F0aW9uXG4gICAgICAgIC8vIHZhciBtYWluX2ltYWdlcyA9IGxvY2F0aW9uc1swXS5pbWFnZV91cmxzLmNvbmNhdChsb2NhdGlvbnNbMF0uaW1hZ2VfdXJsczIpO1xuXG4gICAgICAgIHZhciBtYWluX2ltYWdlcyA9IGFwcC5tb2RlbC5sb2NhdGlvbnMucmVkdWNlKGZ1bmN0aW9uKGFsbF9pbWFnZXMsIGxvY2F0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxsX2ltYWdlcy5jb25jYXQobG9jYXRpb24uaW1hZ2VfdXJscyk7XG4gICAgICAgIH0sIFtdKTtcblxuICAgICAgICAvLyBXYWl0IGZvciB0aGUgZG9jdW1ldCByZWFkeSBiZWZvcmUgYnVpbGRpbmcgdmlld3NcbiAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBhcHAubW9kZWwubG9jYXRpb25fbmFtZXMgPSBjcmVhdGVTZWFyY2hMaXN0KGFwcC5tb2RlbC5yYXdfZGF0YS5yb3dzKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2NhdGlvbiBOYW1lcycsIGFwcC5tb2RlbC5sb2NhdGlvbl9uYW1lcyk7XG4gICAgICAgICAgICBhcHAuY29tcG9uZW50cy5tYWluX2Nhcm91c2VsID0gY3JlYXRlQ2Fyb3VzZWwoJ2Nhcm91c2VsJywgbWFpbl9pbWFnZXMpO1xuICAgICAgICAgICAgdXBkYXRlUmVzdWx0cyhsb2NhdGlvbnMpO1xuICAgICAgICAgICAgJCgnLnNlYXJjaC1ib3gnKS5zaG93KCk7XG4gICAgICAgICAgICBzZXRFdmVudEhhbmRsZXJzKCk7XG4gICAgICAgICAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLy8gU3RhcnQgcHJvY2Vzc1xuYXBwLmluaXQoKTtcbiQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG4gICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xufSlcbiIsImZ1bmN0aW9uIGNyZWF0ZUNhcm91c2VsKGVsZW1lbnQsIGltYWdlX2Fycikge1xuXG4gICAgdmFyICRjYXJvdXNlbCA9ICQoZWxlbWVudCk7XG4gICAgJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPSAwOyAvLyBcbiAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gaW1hZ2VfYXJyO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ29udHJvbHMoKSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sLXdyYXBwZXIgbGVmdFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIGxlZnQtY29udHJvbFwiPlxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWNoZXZyb24tbGVmdFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wtd3JhcHBlciByaWdodFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIHJpZ2h0LWNvbnRyb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1jaGV2cm9uLXJpZ2h0XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgJGNhcm91c2VsLmFwcGVuZCh0ZW1wbGF0ZSk7XG5cbiAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwubmV4dEltYWdlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwucHJldkltYWdlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAkKCcuY2Fyb3VzZWwtaXRlbScpLmZhZGVPdXQoMjAwMCk7XG4gICAgICAgICQoYC5jYXJvdXNlbC1pdGVtW2RhdGEtaWQ9XCIke2luZGV4fVwiXWApLmZhZGVJbigyMDAwKTtcblxuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICAvKlxuICAgICAgICAvLyBVbm5lY2Vzc2FyeSB3aXRoIG5ldyBsb29waW5nIGZlYXR1cmVcbiAgICAgICAgZWxzZSBpZiAoJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICB9IGVsc2UgaWYgKCRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID09PSAkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICB9IFxuICAgICAgICAqL1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLnNob3coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC51cGRhdGVTbGlkZXMgPSBmdW5jdGlvbihzbGlkZXMsIGhlYWRsaW5lcykge1xuICAgICAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gc2xpZGVzO1xuICAgICAgICAkY2Fyb3VzZWwuZmluZCgndWwnKS5odG1sKFwiXCIpO1xuICAgICAgICBzbGlkZXMuZm9yRWFjaChmdW5jdGlvbih1cmwsIGluZGV4KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHsgLy8gVHlwZSBjaGVja1xuICAgICAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCd1bCcpLmFwcGVuZChgPGxpIFxuICAgICAgICAgICAgICAgICAgICBpZD1cImltYWdlLSR7aW5kZXh9XCIgXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCIke2luZGV4fVwiIFxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImNhcm91c2VsLWl0ZW1cIiBcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHt1cmx9JylcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzcz1cImhlYWRsaW5lXCI+JHtoZWFkbGluZXNbaW5kZXhdIHx8IFwiSGVhZGxpbmUgI1wiICsgKGluZGV4KzEpfTwvaDE+XG4gICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoMCk7XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLm5leHRJbWFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlc1skY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCArIDFdKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKCsrJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTG9vcFxuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgwKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC5wcmV2SW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRjYXJvdXNlbC5pbWFnZXNbJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggLSAxXSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgtLSRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIExvb3BcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY3JlYXRlQ29udHJvbHMoKTtcbiAgICAkY2Fyb3VzZWwuYXBwZW5kKCc8dWw+PC91bD4nKTtcbiAgICAkY2Fyb3VzZWwudXBkYXRlU2xpZGVzKGltYWdlX2FyciwgW1wiRmFzdCwgRWFzeSwgRmxleGlibGVcIiwgXCJCb29rIG9uZSBvZiBvdXIgc3BhY2VzXCJdKTtcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkY2Fyb3VzZWwuaXMoXCI6aG92ZXJcIikpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5uZXh0SW1hZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sIDYwMDApO1xuICAgIHJldHVybiAkY2Fyb3VzZWw7XG59IiwiZnVuY3Rpb24gdXBkYXRlUmVzdWx0cyhsb2NhdGlvbnMpIHtcbiAgICAvLyBGaWxsIHJlc3VsdHMgZGl2XG4gICAgY29uc29sZS5sb2coJ1VwZGF0ZSBSZXN1bHRzJywgbG9jYXRpb25zKTtcbiAgICBsb2NhdGlvbnMubWFwKGZ1bmN0aW9uKGxvY2F0aW9uLCBpbmRleCkge1xuICAgICAgICBsZXQgbG9jYXRpb25fdXJsID0gbG9jYXRpb24udXJsO1xuICAgICAgICBsZXQgd29ya3BsYWNlID0gbG9jYXRpb24ubmFtZTtcbiAgICAgICAgbGV0IGxvY2F0aW9uX25hbWUgPSBsb2NhdGlvbi5sb2NhdGlvbl9uYW1lO1xuICAgICAgICBsZXQgcmV2aWV3X3Njb3JlID0gbG9jYXRpb24ucmF0aW5nIHx8IFwiLVwiO1xuICAgICAgICBsZXQgcHJpY2UgPSAobG9jYXRpb24uZGF5X3ByaWNlKSA/ICckJyArIGxvY2F0aW9uLmRheV9wcmljZSArIFwiL2RheVwiIDogXCJcIjtcbiAgICAgICAgbGV0IGltYWdlX3VybCA9IGxvY2F0aW9uLmltYWdlX3VybHMyWzBdOyAvLyBVc2Ugc21hbGxlciB0aHVtYnNcblxuICAgICAgICAkKCcucmVzdWx0cy1saXN0JykuYXBwZW5kKGA8bGkgXG4gICAgICAgICAgICBpZD1cImxvY2F0aW9uLSR7aW5kZXh9XCIgXG4gICAgICAgICAgICBjbGFzcz1cInJlc3VsdC1pdGVtXCIgXG4gICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6dXJsKCcke2ltYWdlX3VybH0nKTsgZGlzcGxheTogbm9uZTtcIj5cbiAgICAgICAgICAgICAgICA8YSBocmVmPVwiJHtsb2NhdGlvbl91cmwgfHwgXCIjXCJ9XCI+XG4gICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz1cImxvY2F0aW9uLWluZm9cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4ke3dvcmtwbGFjZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPiR7bG9jYXRpb25fbmFtZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPlNjb3JlOiAke3Jldmlld19zY29yZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPiR7cHJpY2V9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICA8L2xpPmApO1xuICAgICAgICAkKCcjbG9jYXRpb24tJytpbmRleCkuZmFkZUluKDEwMDAgKiBpbmRleCk7IC8vIENyZWF0ZXMgY29vbCBwcm9ncmVzc2l2ZSBmYWRlIGluXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldmVhbFJlc3VsdHNBcmVhKCkge1xuICAgIC8vIFNjcm9sbCBkb3duIHRvIGRpc3BsYXkgcmVzdWx0c1xuICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiAkKFwiLnJlc3VsdHMtc2VjdGlvblwiKS5oZWlnaHQoKVxuICAgICB9LCAxMDAwKTtcbn0iLCJmdW5jdGlvbiBjcmVhdGVTZWFyY2hMaXN0KGxvY2F0aW9ucykge1xuICAgIGxldCBwbGFjZV9oYXNoID0ge307XG4gICAgLy8gQ3JlYXRlIGEgbGlzdCBvZiBwbGFjZXMgdG8gc2VhcmNoXG4gICAgbGV0IGxvY2F0aW9uX25hbWVzID0gbG9jYXRpb25zLnJlZHVjZShmdW5jdGlvbihhbGxfbmFtZXMsIGxvY2F0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxsX25hbWVzLmNvbmNhdChbbG9jYXRpb24ubmFtZSwgbG9jYXRpb24ubG9jYXRpb25fbmFtZSwgbG9jYXRpb24ubG9jYXRpb25fY2l0eV0pO1xuICAgICAgICB9LCBbXSlcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICBpZiAoIXBsYWNlX2hhc2hbaXRlbV0pIHtcbiAgICAgICAgICAgICAgICBwbGFjZV9oYXNoW2l0ZW1dID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIC8vIFNvcnQgbGlzdCBhbmQgcmV0dXJuXG4gICAgbG9jYXRpb25fbmFtZXMuc29ydCgoYSwgYikgPT4gYS5sb2NhbGVDb21wYXJlKGIpKTtcbiAgICByZXR1cm4gbG9jYXRpb25fbmFtZXM7XG59XG5cbmZ1bmN0aW9uIHByZWRpY3RTZWFyY2goc3RyKSB7XG4gICAgLy8gUHJlZGljdCBieSBsb2NhdGlvbiBuYW1lXG4gICAgLy8gRmlsdGVyIGxpc3QgYnkgaW5wdXQgc3RyaW5nXG4gICAgbGV0IGxpc3QgPSBhcHAubW9kZWwubG9jYXRpb25fbmFtZXMuZmlsdGVyKGZ1bmN0aW9uKHBsYWNlKSB7XG4gICAgICAgIHJldHVybiBwbGFjZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHN0ci50b0xvd2VyQ2FzZSgpKTtcbiAgICB9KTtcblxuICAgIC8vIEZ1bGwgcHJlZGljdG9yIHdpdGggb25seSB0b3AgNSByZXN1bHRzXG4gICAgZmlsbFByZWRpY3RvcignLnByZWRpY3RpdmUtcmVzdWx0cycsIGxpc3Quc2xpY2UoMCwgNSkpO1xufVxuXG5mdW5jdGlvbiBmaWxsUHJlZGljdG9yKGVsZW1lbnQsIGxpc3QpIHtcbiAgICB2YXIgJHByZWRpY3RvciA9ICQoZWxlbWVudCk7XG4gICAgJHByZWRpY3Rvci5odG1sKFwiXCIpO1xuICAgICRwcmVkaWN0b3IuYXBwZW5kKGBcbiAgICAgICAgICAgIDxsaSBkYXRhLWlkPVwiXCIgXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJwcmVkaWN0aXZlLWl0ZW1cIlxuICAgICAgICAgICAgICAgIGRhdGEtbmFtZT1cIkFsbFwiPlNlYXJjaCBhbGwgbG9jYXRpb25zLi48L2xpPmApO1xuICAgIGZvciAobGV0IGxvY2F0aW9uIG9mIGxpc3QpIHtcbiAgICAgICAgJHByZWRpY3Rvci5hcHBlbmQoYFxuICAgICAgICAgICAgPGxpIGRhdGEtaWQ9XCJcIiBcbiAgICAgICAgICAgICAgICBjbGFzcz1cInByZWRpY3RpdmUtaXRlbVwiXG4gICAgICAgICAgICAgICAgZGF0YS1uYW1lPVwiJHtsb2NhdGlvbn1cIj4ke2xvY2F0aW9ufTwvbGk+YCk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGhhbmRsZXJcbiAgICAkKCcucHJlZGljdGl2ZS1pdGVtJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGxldCBuYW1lID0gJCh0aGlzKS5kYXRhKCduYW1lJyk7XG4gICAgICAgIGlmIChuYW1lID09PSBcIkFsbFwiKSB7XG4gICAgICAgICAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoXCJcIik7XG4gICAgICAgICAgICBwcm9jZXNzU2VhcmNoKCk7XG4gICAgICAgICAgICByZXZlYWxSZXN1bHRzQXJlYSgpO1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKG5hbWUpO1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVzdWx0c0xpc3Qoc3RyKSB7XG4gICAgbGV0IGxvY2F0aW9ucyA9IGFwcC5tb2RlbC5yYXdfZGF0YS5yb3dzO1xuICAgIGlmICghc3RyKSByZXR1cm4gbG9jYXRpb25zOyAvLyBJZiBubyBzZWFyY2ggY3JpdGVyaWEsIHJldHVybiB3aG9sZSBsaXN0XG4gICAgbGV0IHJlc3VsdHMgPSBsb2NhdGlvbnMuZmlsdGVyKGZ1bmN0aW9uKGxvY2F0aW9uKSB7XG4gICAgICAgIGlmKGxvY2F0aW9uLm5hbWUgPT09IHN0ciB8fCBcbiAgICAgICAgICAgbG9jYXRpb24ubG9jYXRpb25fbmFtZSA9PT0gc3RyIHx8XG4gICAgICAgICAgIGxvY2F0aW9uLmxvY2F0aW9uX2NpdHkgPT09IHN0cikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHRzO1xufVxuXG5mdW5jdGlvbiBwcm9jZXNzU2VhcmNoKHN0cikge1xuICAgIC8vIEZpcnN0IGNsZWFyIHJlc3VsdHMgYW5kIHNob3cgbG9hZGVyXG4gICAgJCgnLnJlc3VsdHMtbGlzdCcpLmh0bWwoXCJcIik7XG4gICAgJCgnLnJlc3VsdHMtc2VjdGlvbiAubG9hZGVyJykuc2hvdygpO1xuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChcIlwiKTtcbiAgICAkLndoZW4oZ2V0RGF0YShzdHIpKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gUHJldGVuZCB0byBnZXQgbmV3IHNlYXJjaCByZXN1bHRzIHdpdGggbmV3IHF1ZXJ5XG4gICAgICAgIC8vIGFuZCB1cGRhdGUgbW9kZWxcbiAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9ucyA9IGNyZWF0ZVJlc3VsdHNMaXN0KHN0cik7XG5cbiAgICAgICAgLy8gVXBkYXRlIHJlc3VsdHMgYW5kIHJlc2V0IHJlc3BvbnNpdmUgZWxlbWVudHNcbiAgICAgICAgdXBkYXRlUmVzdWx0cyhhcHAubW9kZWwubG9jYXRpb25zKTtcbiAgICAgICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xuICAgICAgICAvLyBIaWRlIGxvYWRlciBhZnRlciBsb2FkaW5nIG5ldyByZXN1bHRzXG4gICAgICAgICQoJy5yZXN1bHRzLXNlY3Rpb24gLmxvYWRlcicpLmZhZGVPdXQoKTtcbiAgICB9KTtcblxufSIsImZ1bmN0aW9uIHNldEV2ZW50SGFuZGxlcnMoKSB7XG4gICAgLy8gU2VhcmNoIGZvcm1cbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgc2VhcmNoX2lucXVpcnkgPSAkKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbCgpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmKHNlYXJjaF9pbnF1aXJ5KSB7XG4gICAgICAgICAgICBwcm9jZXNzU2VhcmNoKHNlYXJjaF9pbnF1aXJ5KTtcbiAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICAgICAgICAgcmV2ZWFsUmVzdWx0c0FyZWEoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2VhcmNoIGZvcm0gcHJlZGljdGl2ZSBzZWFyY2hcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5mb2N1cyhmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gV2hlbiBmb2N1cyBpcyBvbiBzZWFyY2ggaW5wdXRcbiAgICAgICAgLy8gRXZhbHVhdGUgc3RyaW5nIG9uIGtleXVwIC0ga2V5ZG93biBmaXJlcyBiZWZvcmUgdGV4dCBpcyBhdmFpbGFibGVcbiAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykua2V5dXAoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgbGV0IHNlYXJjaF9pbnF1aXJ5ID0gJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdLZXkgRG93bicpO1xuICAgICAgICAgICAgcHJlZGljdFNlYXJjaChzZWFyY2hfaW5xdWlyeSk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5zaG93KCk7XG4gICAgICAgIH0pXG4gICAgfSk7XG5cbiAgICAvLyBIaWRlIHByZWRpY3Rpb24gYm94IHdoZW4gZm9jdXMgaXNuJ3Qgb24gc2VhcmNoXG4gICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykuZm9jdXNvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghJCgnLnByZWRpY3RpdmUtYm94JykuaXMoXCI6aG92ZXJcIikpIHtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRmlsbCBzZWFyY2ggYmFyIHdpdGggd2hhdGV2ZXIgYSB1c2VyIHNlbGVjdHMgZnJvbSBsaXN0XG4gICAgJCgnLnByZWRpY3RpdmUtaXRlbScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkKCcucHJlZGljdGl2ZS1yZXN1bHRzJykuaHRtbChcIlwiKTtcbiAgICAgICAgJCh0aGlzKS5kYXRhKCduYW1lJyk7XG4gICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICB9KVxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
