"use strict";function getData(e){return $.ajax({dataType:"json",url:"https://www.deskbookers.com/nl-nl/sajax.json?q=Amsterdam&type=-&people=any&favorite=0&pid=&sw=52.293753%2C4.634942&ne=52.455562%2C5.162286&ids=17201%2C19640%2C13692%2C13691%2C12136%2C17938%2C15292%2C14886%2C14885%2C14884%2C14883%2C15730%2C15353%2C15351%2C15330%2C15080%2C17290%2C15454%2C15451%2C15379"})}function setDimensionsForResponsiveElements(){$("ul.results-list").css("width",window.innerWidth/5*$(".result-item").length+"px")}function createCarousel(e,t){function a(){var e='\n            <div class="control-wrapper left">\n                <div class="control left-control">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                </div>\n            </div>\n            <div class="control-wrapper right">\n                <div class="control right-control">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                </div>\n            </div>\n        ';n.append(e),n.find(".right-control").on("click",function(){n.nextImage()}),n.find(".left-control").on("click",function(){n.prevImage()})}var n=$(e);return n.current_image_index=0,n.images=t,n.goToImage=function(e){$(".carousel-item").fadeOut(2e3),$('.carousel-item[data-id="'+e+'"]').fadeIn(2e3),0===n.images.length?n.find(".control").hide():n.find(".control").show()},n.updateSlides=function(e,t){n.images=e,n.find("ul").html(""),e.forEach(function(e,a){"string"==typeof e&&n.find("ul").append('<li \n                    id="image-'+a+'" \n                    data-id="'+a+'" \n                    class="carousel-item" \n                    style="background-image:url(\''+e+'\')">\n                        <h1 class="headline">'+(t[a]||"Headline #"+(a+1))+"</h1>\n                    </li>\n                ")}),n.goToImage(0)},n.nextImage=function(){n.images[n.current_image_index+1]?n.goToImage(++n.current_image_index):(n.goToImage(0),n.current_image_index=0)},n.prevImage=function(){n.images[n.current_image_index-1]?n.goToImage(--n.current_image_index):(n.goToImage(n.images.length-1),n.current_image_index=n.images.length-1)},a(),n.append("<ul></ul>"),n.updateSlides(t,["Fast, Easy, Flexible","Book one of our spaces"]),setInterval(function(){n.is(":hover")||n.nextImage()},6e3),n}function updateResults(e){console.log("Update Results",e),e.map(function(e,t){var a=e.url,n=e.name,o=e.location_name,i=e.rating||"-",r=e.day_price?"$"+e.day_price+"/day":"",s=e.image_urls2[0];$(".results-list").append('<li \n            id="location-'+t+'" \n            class="result-item" \n            style="background-image:url(\''+s+'\'); display: none;">\n                <a href="'+(a||"#")+'">\n                    <ul class="location-info">\n                        <li>'+n+"</li>\n                        <li>"+o+"</li>\n                        <li>Score: "+i+"</li>\n                        <li>"+r+"</li>\n                    </ul>\n                </a>\n            </li>"),$("#location-"+t).fadeIn(1e3*t)})}function revealResultsArea(){$("html, body").animate({scrollTop:$(".results-section").height()},1e3)}function createResultsArea(){return{update:updateResults,scrollTo:revealResultsArea}}function createSearchList(e){var t={},a=e.reduce(function(e,t){return e.concat([t.name,t.location_name,t.location_city])},[]).filter(function(e){return!t[e]&&(t[e]=!0,!0)});return a.sort(function(e,t){return e.localeCompare(t)}),a}function predictSearch(e){var t=app.model.location_names.filter(function(t){return t.toLowerCase().includes(e.toLowerCase())});fillPredictor(".predictive-results",t.slice(0,5))}function fillPredictor(e,t){var a=$(e);a.html(""),a.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="All">Search all locations..</li>');var n=!0,o=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;a.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="'+l+'">'+l+"</li>")}}catch(c){o=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw i}}$(".predictive-item").on("click",function(){var e=$(this).data("name");"All"===e?($('#location-search-form input[type="text"]').val(""),processSearch(),revealResultsArea(),$(".predictive-box").hide()):($('#location-search-form input[type="text"]').val(e),$(".predictive-box").hide())})}function createResultsList(e){var t=app.model.raw_data.rows;if(!e)return t;var a=t.filter(function(t){return t.name===e||t.location_name===e||t.location_city===e});return a}function processSearch(e){$(".results-list").html(""),$(".results-section .loader").show(),$('#location-search-form input[type="text"]').val(""),$.when(getData(e)).then(function(t){app.model.raw_data=t,app.model.locations=createResultsList(e),app.components.results_area.update(locations),app.model.locations,setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()}).fail(function(t){console.error("Could not connect to API.","Using session storage..",t),app.model.locations=createResultsList(e),app.components.results_area.update(app.model.locations),setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()})}function setEventHandlers(){$("#location-search-form").submit(function(e){var t=$('input[type="text"]').val();e.preventDefault(),t&&(processSearch(t),$('input[type="text"]').val(""),revealResultsArea())}),$('#location-search-form input[type="text"]').focus(function(){$('#location-search-form input[type="text"]').keyup(function(e){var t=$('#location-search-form input[type="text"]').val();predictSearch(t),$(".predictive-box").show()})}),$('#location-search-form input[type="text"]').focusout(function(){$(".predictive-box").is(":hover")||$(".predictive-box").hide()}),$(".predictive-item").on("click",function(){$(".predictive-results").html(""),$(this).data("name"),$(".predictive-box").hide()})}var max_results=20,app={model:{raw_data:void 0,locations:void 0,location_names:void 0},components:{main_carousel:void 0,results_area:void 0},init:function(){if(sessionStorage.getItem("location_data")){var e=sessionStorage.getItem("location_data");app.model.raw_data=JSON.parse(e),console.log("Using data from session storage..",app.model.raw_data),app.setUp()}else $(".loader").show(),app.setData()},setData:function(){$.when(getData()).then(function(e){console.log("Retrieved data",e),sessionStorage.setItem("location_data",JSON.stringify(e)),app.model.raw_data=e,app.setUp(),$(".loader").fadeOut()})},setUp:function(){app.model.locations=app.model.raw_data.rows;var e=app.model.locations.slice(0,Math.min(max_results,app.model.locations.length-1)),t=app.model.locations.reduce(function(e,t){return e.concat(t.image_urls)},[]);$(document).ready(function(){app.model.location_names=createSearchList(app.model.raw_data.rows),app.components.main_carousel=createCarousel("carousel",t),app.components.results_area=createResultsArea(),app.components.results_area.update(e),$(".search-box").show(),setEventHandlers(),setDimensionsForResponsiveElements()})}};app.init(),$(window).resize(function(){setDimensionsForResponsiveElements()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJjcmVhdGVDYXJvdXNlbC5qcyIsImNyZWF0ZVJlc3VsdHNBcmVhLmpzIiwic2VhcmNoX2Z1bmN0aW9ucy5qcyIsInNldEV2ZW50SGFuZGxlcnMuanMiXSwibmFtZXMiOlsiZ2V0RGF0YSIsInNlYXJjaF9pbnF1aXJ5IiwiJCIsImFqYXgiLCJkYXRhVHlwZSIsInVybCIsInNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMiLCJjc3MiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwibGVuZ3RoIiwiY3JlYXRlQ2Fyb3VzZWwiLCJlbGVtZW50IiwiaW1hZ2VfYXJyIiwiY3JlYXRlQ29udHJvbHMiLCJ0ZW1wbGF0ZSIsIiRjYXJvdXNlbCIsImFwcGVuZCIsImZpbmQiLCJvbiIsIm5leHRJbWFnZSIsInByZXZJbWFnZSIsImN1cnJlbnRfaW1hZ2VfaW5kZXgiLCJpbWFnZXMiLCJnb1RvSW1hZ2UiLCJpbmRleCIsImZhZGVPdXQiLCJmYWRlSW4iLCJoaWRlIiwic2hvdyIsInVwZGF0ZVNsaWRlcyIsInNsaWRlcyIsImhlYWRsaW5lcyIsImh0bWwiLCJmb3JFYWNoIiwic2V0SW50ZXJ2YWwiLCJpcyIsInVwZGF0ZVJlc3VsdHMiLCJsb2NhdGlvbnMiLCJjb25zb2xlIiwibG9nIiwibWFwIiwibG9jYXRpb24iLCJsb2NhdGlvbl91cmwiLCJ3b3JrcGxhY2UiLCJuYW1lIiwibG9jYXRpb25fbmFtZSIsInJldmlld19zY29yZSIsInJhdGluZyIsInByaWNlIiwiZGF5X3ByaWNlIiwiaW1hZ2VfdXJsIiwiaW1hZ2VfdXJsczIiLCJyZXZlYWxSZXN1bHRzQXJlYSIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJoZWlnaHQiLCJjcmVhdGVSZXN1bHRzQXJlYSIsInVwZGF0ZSIsInNjcm9sbFRvIiwiY3JlYXRlU2VhcmNoTGlzdCIsInBsYWNlX2hhc2giLCJsb2NhdGlvbl9uYW1lcyIsInJlZHVjZSIsImFsbF9uYW1lcyIsImNvbmNhdCIsImxvY2F0aW9uX2NpdHkiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsInByZWRpY3RTZWFyY2giLCJzdHIiLCJsaXN0IiwiYXBwIiwibW9kZWwiLCJwbGFjZSIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJmaWxsUHJlZGljdG9yIiwic2xpY2UiLCIkcHJlZGljdG9yIiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJ1bmRlZmluZWQiLCJfc3RlcCIsIl9pdGVyYXRvciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJ2YWx1ZSIsImVyciIsInRoaXMiLCJkYXRhIiwidmFsIiwicHJvY2Vzc1NlYXJjaCIsImNyZWF0ZVJlc3VsdHNMaXN0IiwicmF3X2RhdGEiLCJyb3dzIiwicmVzdWx0cyIsIndoZW4iLCJ0aGVuIiwiY29tcG9uZW50cyIsInJlc3VsdHNfYXJlYSIsImZhaWwiLCJlcnJvciIsInNldEV2ZW50SGFuZGxlcnMiLCJzdWJtaXQiLCJlIiwicHJldmVudERlZmF1bHQiLCJmb2N1cyIsImtleXVwIiwiZm9jdXNvdXQiLCJtYXhfcmVzdWx0cyIsIm1haW5fY2Fyb3VzZWwiLCJpbml0Iiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiZGF0YVN0cmluZyIsIkpTT04iLCJwYXJzZSIsInNldFVwIiwic2V0RGF0YSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJNYXRoIiwibWluIiwibWFpbl9pbWFnZXMiLCJhbGxfaW1hZ2VzIiwiaW1hZ2VfdXJscyIsImRvY3VtZW50IiwicmVhZHkiLCJyZXNpemUiXSwibWFwcGluZ3MiOiJBQUFBLFlBSUEsU0FBU0EsU0FBUUMsR0FHYixNQUFPQyxHQUFFQyxNQUNMQyxTQUFVLE9BQ1ZDLElBQUssaVRBSWIsUUFBU0Msc0NBQ0xKLEVBQUUsbUJBQW1CSyxJQUFJLFFBQVNDLE9BQU9DLFdBQWEsRUFBSVAsRUFBRSxnQkFBZ0JRLE9BQVMsTUNkekYs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QWUsV0FBWXdILEdBQzFEdkQsSUFBSThCLFdBQVdDLGFBQWVsRCxvQkFDOUJtQixJQUFJOEIsV0FBV0MsYUFBYWpELE9BQU9wQixHQUNuQ3BDLEVBQUUsZUFBZTJCLE9BQ2pCaUYsbUJBQ0F4Ryx3Q0FNWnNFLEtBQUkyQyxPQUNKckgsRUFBRU0sUUFBUWdJLE9BQU8sV0FDYmxJIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBtYXhfcmVzdWx0cyA9IDIwO1xuXG5mdW5jdGlvbiBnZXREYXRhKHNlYXJjaF9pbnF1aXJ5KSB7XG4gICAgLy8gU2VhcmNoIGlucXVpcnkgd291bGQgYmUgdXNlZCB0byBnZXQgc3BlY2lmaWMgcmVzdWx0cyBmcm9tIEFQSVxuICAgIC8vIEZvciB0aGlzIGNoYWxsZW5nZSwgb25seSB1c2luZyBzcGVjaWZpZWQgcXVlcnkgc3RyaW5nIGJlbG93OlxuICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICAgIHVybDogJ2h0dHBzOi8vd3d3LmRlc2tib29rZXJzLmNvbS9ubC1ubC9zYWpheC5qc29uP3E9QW1zdGVyZGFtJnR5cGU9LSZwZW9wbGU9YW55JmZhdm9yaXRlPTAmcGlkPSZzdz01Mi4yOTM3NTMlMkM0LjYzNDk0MiZuZT01Mi40NTU1NjIlMkM1LjE2MjI4NiZpZHM9MTcyMDElMkMxOTY0MCUyQzEzNjkyJTJDMTM2OTElMkMxMjEzNiUyQzE3OTM4JTJDMTUyOTIlMkMxNDg4NiUyQzE0ODg1JTJDMTQ4ODQlMkMxNDg4MyUyQzE1NzMwJTJDMTUzNTMlMkMxNTM1MSUyQzE1MzMwJTJDMTUwODAlMkMxNzI5MCUyQzE1NDU0JTJDMTU0NTElMkMxNTM3OSdcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpIHtcbiAgICAkKCd1bC5yZXN1bHRzLWxpc3QnKS5jc3MoJ3dpZHRoJywgd2luZG93LmlubmVyV2lkdGggLyA1ICogJCgnLnJlc3VsdC1pdGVtJykubGVuZ3RoICsgJ3B4Jyk7XG59XG5cbnZhciBhcHAgPSB7XG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgYXBwXG4gICAgLy8gVGhpcyBsYXlzIG91dCB0aGUgc3RydWN0dXJlXG4gICAgbW9kZWw6IHtcbiAgICAgICAgcmF3X2RhdGE6IHVuZGVmaW5lZCwgLy9BbGwgZGF0YSBmcm9tIHNlcnZlclxuICAgICAgICBsb2NhdGlvbnM6IHVuZGVmaW5lZCwgLy9DdXJyZW50IHJlc3VsdCBkYXRhXG4gICAgICAgIGxvY2F0aW9uX25hbWVzOiB1bmRlZmluZWQgLy9Qb3NzaWJsZSBzZWFyY2ggcmVzdWx0c1xuICAgIH0sXG4gICAgY29tcG9uZW50czoge1xuICAgICAgICBtYWluX2Nhcm91c2VsOiB1bmRlZmluZWQsIC8vIFxuICAgICAgICByZXN1bHRzX2FyZWE6IHVuZGVmaW5lZFxuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFVzZSBzZXNzaW9uIHN0b3JhZ2UgaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsb2NhdGlvbl9kYXRhJykpIHtcbiAgICAgICAgICAgIGxldCBkYXRhU3RyaW5nID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbG9jYXRpb25fZGF0YScpO1xuICAgICAgICAgICAgYXBwLm1vZGVsLnJhd19kYXRhID0gSlNPTi5wYXJzZShkYXRhU3RyaW5nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdVc2luZyBkYXRhIGZyb20gc2Vzc2lvbiBzdG9yYWdlLi4nLCBhcHAubW9kZWwucmF3X2RhdGEpO1xuICAgICAgICAgICAgYXBwLnNldFVwKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKCcubG9hZGVyJykuc2hvdygpO1xuICAgICAgICAgICAgYXBwLnNldERhdGEoKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyBHZXQgYW5kIHNldCBkYXRhIGZyb20gdGhlIEFQSVxuICAgIHNldERhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAkLndoZW4oZ2V0RGF0YSgpKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXRyaWV2ZWQgZGF0YScsIGRhdGEpO1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnbG9jYXRpb25fZGF0YScsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5yYXdfZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICBhcHAuc2V0VXAoKTtcbiAgICAgICAgICAgICQoJy5sb2FkZXInKS5mYWRlT3V0KCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgLy8gU2V0IHVwIHZpZXdzXG4gICAgc2V0VXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBTZXQgcmVzdWx0IGRhdGEgZnJvbSBhbGwgZGF0YVxuICAgICAgICBhcHAubW9kZWwubG9jYXRpb25zID0gYXBwLm1vZGVsLnJhd19kYXRhLnJvd3M7XG4gICAgICAgIHZhciBsb2NhdGlvbnMgPSBhcHAubW9kZWwubG9jYXRpb25zLnNsaWNlKDAsIE1hdGgubWluKG1heF9yZXN1bHRzLCBhcHAubW9kZWwubG9jYXRpb25zLmxlbmd0aCAtIDEpKTtcblxuICAgICAgICAvLyBUaGlzIHdhcyBpbml0aWFsbHkgc2V0IHVwIHRvIGp1c3QgaGF2ZSBhIGNhcm91c2VsIGZvciBvbmUgbG9jYXRpb25cbiAgICAgICAgLy8gdmFyIG1haW5faW1hZ2VzID0gbG9jYXRpb25zWzBdLmltYWdlX3VybHMuY29uY2F0KGxvY2F0aW9uc1swXS5pbWFnZV91cmxzMik7XG5cbiAgICAgICAgdmFyIG1haW5faW1hZ2VzID0gYXBwLm1vZGVsLmxvY2F0aW9ucy5yZWR1Y2UoZnVuY3Rpb24oYWxsX2ltYWdlcywgbG9jYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbGxfaW1hZ2VzLmNvbmNhdChsb2NhdGlvbi5pbWFnZV91cmxzKTtcbiAgICAgICAgfSwgW10pO1xuXG4gICAgICAgIC8vIFdhaXQgZm9yIHRoZSBkb2N1bWV0IHJlYWR5IGJlZm9yZSBidWlsZGluZyB2aWV3c1xuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbl9uYW1lcyA9IGNyZWF0ZVNlYXJjaExpc3QoYXBwLm1vZGVsLnJhd19kYXRhLnJvd3MpO1xuICAgICAgICAgICAgYXBwLmNvbXBvbmVudHMubWFpbl9jYXJvdXNlbCA9IGNyZWF0ZUNhcm91c2VsKCdjYXJvdXNlbCcsIG1haW5faW1hZ2VzKTtcbiAgICAgICAgICAgIGFwcC5jb21wb25lbnRzLnJlc3VsdHNfYXJlYSA9IGNyZWF0ZVJlc3VsdHNBcmVhKCk7XG4gICAgICAgICAgICBhcHAuY29tcG9uZW50cy5yZXN1bHRzX2FyZWEudXBkYXRlKGxvY2F0aW9ucyk7XG4gICAgICAgICAgICAkKCcuc2VhcmNoLWJveCcpLnNob3coKTtcbiAgICAgICAgICAgIHNldEV2ZW50SGFuZGxlcnMoKTtcbiAgICAgICAgICAgIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vLyBTdGFydCBwcm9jZXNzXG5hcHAuaW5pdCgpO1xuJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcbiAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7XG59KVxuIiwiZnVuY3Rpb24gY3JlYXRlQ2Fyb3VzZWwoZWxlbWVudCwgaW1hZ2VfYXJyKSB7XG5cbiAgICB2YXIgJGNhcm91c2VsID0gJChlbGVtZW50KTtcbiAgICAkY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCA9IDA7IC8vIFxuICAgICRjYXJvdXNlbC5pbWFnZXMgPSBpbWFnZV9hcnI7XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVDb250cm9scygpIHtcbiAgICAgICAgdmFyIHRlbXBsYXRlID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wtd3JhcHBlciBsZWZ0XCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wgbGVmdC1jb250cm9sXCI+XG4gICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtY2hldnJvbi1sZWZ0XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29udHJvbC13cmFwcGVyIHJpZ2h0XCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wgcmlnaHQtY29udHJvbFwiPlxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWNoZXZyb24tcmlnaHRcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcblxuICAgICAgICAkY2Fyb3VzZWwuYXBwZW5kKHRlbXBsYXRlKTtcblxuICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLnJpZ2h0LWNvbnRyb2wnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5uZXh0SW1hZ2UoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5sZWZ0LWNvbnRyb2wnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5wcmV2SW1hZ2UoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLmdvVG9JbWFnZSA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICQoJy5jYXJvdXNlbC1pdGVtJykuZmFkZU91dCgyMDAwKTtcbiAgICAgICAgJChgLmNhcm91c2VsLWl0ZW1bZGF0YS1pZD1cIiR7aW5kZXh9XCJdYCkuZmFkZUluKDIwMDApO1xuXG4gICAgICAgIGlmICgkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5jb250cm9sJykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8qXG4gICAgICAgIC8vIFVubmVjZXNzYXJ5IHdpdGggbmV3IGxvb3BpbmcgZmVhdHVyZVxuICAgICAgICBlbHNlIGlmICgkY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5sZWZ0LWNvbnRyb2wnKS5oaWRlKCk7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLnJpZ2h0LWNvbnRyb2wnKS5zaG93KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPT09ICRjYXJvdXNlbC5pbWFnZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5sZWZ0LWNvbnRyb2wnKS5zaG93KCk7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZmluZCgnLnJpZ2h0LWNvbnRyb2wnKS5oaWRlKCk7XG4gICAgICAgIH0gXG4gICAgICAgICovXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5jb250cm9sJykuc2hvdygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLnVwZGF0ZVNsaWRlcyA9IGZ1bmN0aW9uKHNsaWRlcywgaGVhZGxpbmVzKSB7XG4gICAgICAgICRjYXJvdXNlbC5pbWFnZXMgPSBzbGlkZXM7XG4gICAgICAgICRjYXJvdXNlbC5maW5kKCd1bCcpLmh0bWwoXCJcIik7XG4gICAgICAgIHNsaWRlcy5mb3JFYWNoKGZ1bmN0aW9uKHVybCwgaW5kZXgpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykgeyAvLyBUeXBlIGNoZWNrXG4gICAgICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJ3VsJykuYXBwZW5kKGA8bGkgXG4gICAgICAgICAgICAgICAgICAgIGlkPVwiaW1hZ2UtJHtpbmRleH1cIiBcbiAgICAgICAgICAgICAgICAgICAgZGF0YS1pZD1cIiR7aW5kZXh9XCIgXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiY2Fyb3VzZWwtaXRlbVwiIFxuICAgICAgICAgICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6dXJsKCcke3VybH0nKVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGgxIGNsYXNzPVwiaGVhZGxpbmVcIj4ke2hlYWRsaW5lc1tpbmRleF0gfHwgXCJIZWFkbGluZSAjXCIgKyAoaW5kZXgrMSl9PC9oMT5cbiAgICAgICAgICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICAgICAgICBgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgwKTtcbiAgICB9XG5cbiAgICAkY2Fyb3VzZWwubmV4dEltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkY2Fyb3VzZWwuaW1hZ2VzWyRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ICsgMV0pIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoKyskY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBMb29wXG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKDApO1xuICAgICAgICAgICAgJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPSAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLnByZXZJbWFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlc1skY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCAtIDFdKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKC0tJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTG9vcFxuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPSAkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCAtIDE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVDb250cm9scygpO1xuICAgICRjYXJvdXNlbC5hcHBlbmQoJzx1bD48L3VsPicpO1xuICAgICRjYXJvdXNlbC51cGRhdGVTbGlkZXMoaW1hZ2VfYXJyLCBbXCJGYXN0LCBFYXN5LCBGbGV4aWJsZVwiLCBcIkJvb2sgb25lIG9mIG91ciBzcGFjZXNcIl0pO1xuICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoISRjYXJvdXNlbC5pcyhcIjpob3ZlclwiKSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLm5leHRJbWFnZSgpO1xuICAgICAgICB9XG4gICAgfSwgNjAwMCk7XG4gICAgcmV0dXJuICRjYXJvdXNlbDtcbn0iLCJmdW5jdGlvbiB1cGRhdGVSZXN1bHRzKGxvY2F0aW9ucykge1xuICAgIC8vIEZpbGwgcmVzdWx0cyBkaXZcbiAgICBjb25zb2xlLmxvZygnVXBkYXRlIFJlc3VsdHMnLCBsb2NhdGlvbnMpO1xuICAgIGxvY2F0aW9ucy5tYXAoZnVuY3Rpb24obG9jYXRpb24sIGluZGV4KSB7XG4gICAgICAgIGxldCBsb2NhdGlvbl91cmwgPSBsb2NhdGlvbi51cmw7XG4gICAgICAgIGxldCB3b3JrcGxhY2UgPSBsb2NhdGlvbi5uYW1lO1xuICAgICAgICBsZXQgbG9jYXRpb25fbmFtZSA9IGxvY2F0aW9uLmxvY2F0aW9uX25hbWU7XG4gICAgICAgIGxldCByZXZpZXdfc2NvcmUgPSBsb2NhdGlvbi5yYXRpbmcgfHwgXCItXCI7XG4gICAgICAgIGxldCBwcmljZSA9IChsb2NhdGlvbi5kYXlfcHJpY2UpID8gJyQnICsgbG9jYXRpb24uZGF5X3ByaWNlICsgXCIvZGF5XCIgOiBcIlwiO1xuICAgICAgICBsZXQgaW1hZ2VfdXJsID0gbG9jYXRpb24uaW1hZ2VfdXJsczJbMF07IC8vIFVzZSBzbWFsbGVyIHRodW1ic1xuXG4gICAgICAgICQoJy5yZXN1bHRzLWxpc3QnKS5hcHBlbmQoYDxsaSBcbiAgICAgICAgICAgIGlkPVwibG9jYXRpb24tJHtpbmRleH1cIiBcbiAgICAgICAgICAgIGNsYXNzPVwicmVzdWx0LWl0ZW1cIiBcbiAgICAgICAgICAgIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTp1cmwoJyR7aW1hZ2VfdXJsfScpOyBkaXNwbGF5OiBub25lO1wiPlxuICAgICAgICAgICAgICAgIDxhIGhyZWY9XCIke2xvY2F0aW9uX3VybCB8fCBcIiNcIn1cIj5cbiAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPVwibG9jYXRpb24taW5mb1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpPiR7d29ya3BsYWNlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHtsb2NhdGlvbl9uYW1lfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+U2NvcmU6ICR7cmV2aWV3X3Njb3JlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHtwcmljZX08L2xpPlxuICAgICAgICAgICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDwvbGk+YCk7XG4gICAgICAgICQoJyNsb2NhdGlvbi0nK2luZGV4KS5mYWRlSW4oMTAwMCAqIGluZGV4KTsgLy8gQ3JlYXRlcyBjb29sIHByb2dyZXNzaXZlIGZhZGUgaW5cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gcmV2ZWFsUmVzdWx0c0FyZWEoKSB7XG4gICAgLy8gU2Nyb2xsIGRvd24gdG8gZGlzcGxheSByZXN1bHRzXG4gICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICBzY3JvbGxUb3A6ICQoXCIucmVzdWx0cy1zZWN0aW9uXCIpLmhlaWdodCgpXG4gICAgIH0sIDEwMDApO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVSZXN1bHRzQXJlYSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB1cGRhdGU6IHVwZGF0ZVJlc3VsdHMsXG4gICAgICAgIHNjcm9sbFRvOiByZXZlYWxSZXN1bHRzQXJlYVxuICAgIH1cbn0iLCJmdW5jdGlvbiBjcmVhdGVTZWFyY2hMaXN0KGxvY2F0aW9ucykge1xuICAgIGxldCBwbGFjZV9oYXNoID0ge307XG4gICAgLy8gQ3JlYXRlIGEgbGlzdCBvZiBwbGFjZXMgdG8gc2VhcmNoXG4gICAgbGV0IGxvY2F0aW9uX25hbWVzID0gbG9jYXRpb25zLnJlZHVjZShmdW5jdGlvbihhbGxfbmFtZXMsIGxvY2F0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxsX25hbWVzLmNvbmNhdChbbG9jYXRpb24ubmFtZSwgbG9jYXRpb24ubG9jYXRpb25fbmFtZSwgbG9jYXRpb24ubG9jYXRpb25fY2l0eV0pO1xuICAgICAgICB9LCBbXSlcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICBpZiAoIXBsYWNlX2hhc2hbaXRlbV0pIHtcbiAgICAgICAgICAgICAgICBwbGFjZV9oYXNoW2l0ZW1dID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIC8vIFNvcnQgbGlzdCBhbmQgcmV0dXJuXG4gICAgbG9jYXRpb25fbmFtZXMuc29ydCgoYSwgYikgPT4gYS5sb2NhbGVDb21wYXJlKGIpKTtcbiAgICByZXR1cm4gbG9jYXRpb25fbmFtZXM7XG59XG5cbmZ1bmN0aW9uIHByZWRpY3RTZWFyY2goc3RyKSB7XG4gICAgLy8gUHJlZGljdCBieSBsb2NhdGlvbiBuYW1lXG4gICAgLy8gRmlsdGVyIGxpc3QgYnkgaW5wdXQgc3RyaW5nXG4gICAgbGV0IGxpc3QgPSBhcHAubW9kZWwubG9jYXRpb25fbmFtZXMuZmlsdGVyKGZ1bmN0aW9uKHBsYWNlKSB7XG4gICAgICAgIHJldHVybiBwbGFjZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHN0ci50b0xvd2VyQ2FzZSgpKTtcbiAgICB9KTtcblxuICAgIC8vIEZ1bGwgcHJlZGljdG9yIHdpdGggb25seSB0b3AgNSByZXN1bHRzXG4gICAgZmlsbFByZWRpY3RvcignLnByZWRpY3RpdmUtcmVzdWx0cycsIGxpc3Quc2xpY2UoMCwgNSkpO1xufVxuXG5mdW5jdGlvbiBmaWxsUHJlZGljdG9yKGVsZW1lbnQsIGxpc3QpIHtcbiAgICB2YXIgJHByZWRpY3RvciA9ICQoZWxlbWVudCk7XG4gICAgJHByZWRpY3Rvci5odG1sKFwiXCIpO1xuICAgICRwcmVkaWN0b3IuYXBwZW5kKGBcbiAgICAgICAgICAgIDxsaSBkYXRhLWlkPVwiXCIgXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJwcmVkaWN0aXZlLWl0ZW1cIlxuICAgICAgICAgICAgICAgIGRhdGEtbmFtZT1cIkFsbFwiPlNlYXJjaCBhbGwgbG9jYXRpb25zLi48L2xpPmApO1xuICAgIGZvciAobGV0IGxvY2F0aW9uIG9mIGxpc3QpIHtcbiAgICAgICAgJHByZWRpY3Rvci5hcHBlbmQoYFxuICAgICAgICAgICAgPGxpIGRhdGEtaWQ9XCJcIiBcbiAgICAgICAgICAgICAgICBjbGFzcz1cInByZWRpY3RpdmUtaXRlbVwiXG4gICAgICAgICAgICAgICAgZGF0YS1uYW1lPVwiJHtsb2NhdGlvbn1cIj4ke2xvY2F0aW9ufTwvbGk+YCk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGhhbmRsZXJcbiAgICAkKCcucHJlZGljdGl2ZS1pdGVtJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGxldCBuYW1lID0gJCh0aGlzKS5kYXRhKCduYW1lJyk7XG4gICAgICAgIGlmIChuYW1lID09PSBcIkFsbFwiKSB7XG4gICAgICAgICAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoXCJcIik7XG4gICAgICAgICAgICBwcm9jZXNzU2VhcmNoKCk7XG4gICAgICAgICAgICByZXZlYWxSZXN1bHRzQXJlYSgpO1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKG5hbWUpO1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVzdWx0c0xpc3Qoc3RyKSB7XG4gICAgbGV0IGxvY2F0aW9ucyA9IGFwcC5tb2RlbC5yYXdfZGF0YS5yb3dzO1xuICAgIGlmICghc3RyKSByZXR1cm4gbG9jYXRpb25zOyAvLyBJZiBubyBzZWFyY2ggY3JpdGVyaWEsIHJldHVybiB3aG9sZSBsaXN0XG4gICAgbGV0IHJlc3VsdHMgPSBsb2NhdGlvbnMuZmlsdGVyKGZ1bmN0aW9uKGxvY2F0aW9uKSB7XG4gICAgICAgIGlmKGxvY2F0aW9uLm5hbWUgPT09IHN0ciB8fCBcbiAgICAgICAgICAgbG9jYXRpb24ubG9jYXRpb25fbmFtZSA9PT0gc3RyIHx8XG4gICAgICAgICAgIGxvY2F0aW9uLmxvY2F0aW9uX2NpdHkgPT09IHN0cikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHRzO1xufVxuXG5mdW5jdGlvbiBwcm9jZXNzU2VhcmNoKHN0cikge1xuICAgIC8vIEZpcnN0IGNsZWFyIHJlc3VsdHMgYW5kIHNob3cgbG9hZGVyXG4gICAgJCgnLnJlc3VsdHMtbGlzdCcpLmh0bWwoXCJcIik7XG4gICAgJCgnLnJlc3VsdHMtc2VjdGlvbiAubG9hZGVyJykuc2hvdygpO1xuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChcIlwiKTtcbiAgICBcbiAgICAkLndoZW4oZ2V0RGF0YShzdHIpKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gUHJldGVuZCB0byBnZXQgbmV3IHNlYXJjaCByZXN1bHRzIHdpdGggbmV3IHF1ZXJ5XG4gICAgICAgIC8vIGFuZCB1cGRhdGUgbW9kZWxcbiAgICAgICAgYXBwLm1vZGVsLnJhd19kYXRhID0gZGF0YTtcbiAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9ucyA9IGNyZWF0ZVJlc3VsdHNMaXN0KHN0cik7XG5cbiAgICAgICAgLy8gVXBkYXRlIHJlc3VsdHMgYW5kIHJlc2V0IHJlc3BvbnNpdmUgZWxlbWVudHNcbiAgICAgICAgYXBwLmNvbXBvbmVudHMucmVzdWx0c19hcmVhLnVwZGF0ZShsb2NhdGlvbnMpOyhhcHAubW9kZWwubG9jYXRpb25zKTtcbiAgICAgICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xuICAgICAgICAvLyBIaWRlIGxvYWRlciBhZnRlciBsb2FkaW5nIG5ldyByZXN1bHRzXG4gICAgICAgICQoJy5yZXN1bHRzLXNlY3Rpb24gLmxvYWRlcicpLmZhZGVPdXQoKTtcbiAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgY29ubmVjdCB0byBBUEkuXCIsXCJVc2luZyBzZXNzaW9uIHN0b3JhZ2UuLlwiLCBlcnJvcik7XG4gICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbnMgPSBjcmVhdGVSZXN1bHRzTGlzdChzdHIpO1xuICAgICAgICAvLyBVcGRhdGUgcmVzdWx0cyBhbmQgcmVzZXQgcmVzcG9uc2l2ZSBlbGVtZW50c1xuICAgICAgICBhcHAuY29tcG9uZW50cy5yZXN1bHRzX2FyZWEudXBkYXRlKGFwcC5tb2RlbC5sb2NhdGlvbnMpO1xuICAgICAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7XG4gICAgICAgIC8vIEhpZGUgbG9hZGVyIGFmdGVyIGxvYWRpbmcgbmV3IHJlc3VsdHNcbiAgICAgICAgJCgnLnJlc3VsdHMtc2VjdGlvbiAubG9hZGVyJykuZmFkZU91dCgpO1xuICAgIH0pO1xuXG59IiwiZnVuY3Rpb24gc2V0RXZlbnRIYW5kbGVycygpIHtcbiAgICAvLyBTZWFyY2ggZm9ybVxuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybScpLnN1Ym1pdChmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCBzZWFyY2hfaW5xdWlyeSA9ICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYoc2VhcmNoX2lucXVpcnkpIHtcbiAgICAgICAgICAgIHByb2Nlc3NTZWFyY2goc2VhcmNoX2lucXVpcnkpO1xuICAgICAgICAgICAgJCgnaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoXCJcIik7XG4gICAgICAgICAgICByZXZlYWxSZXN1bHRzQXJlYSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBTZWFyY2ggZm9ybSBwcmVkaWN0aXZlIHNlYXJjaFxuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLmZvY3VzKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBXaGVuIGZvY3VzIGlzIG9uIHNlYXJjaCBpbnB1dFxuICAgICAgICAvLyBFdmFsdWF0ZSBzdHJpbmcgb24ga2V5dXAgLSBrZXlkb3duIGZpcmVzIGJlZm9yZSB0ZXh0IGlzIGF2YWlsYWJsZVxuICAgICAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5rZXl1cChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBsZXQgc2VhcmNoX2lucXVpcnkgPSAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0tleSBEb3duJyk7XG4gICAgICAgICAgICBwcmVkaWN0U2VhcmNoKHNlYXJjaF9pbnF1aXJ5KTtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLnNob3coKTtcbiAgICAgICAgfSlcbiAgICB9KTtcblxuICAgIC8vIEhpZGUgcHJlZGljdGlvbiBib3ggd2hlbiBmb2N1cyBpc24ndCBvbiBzZWFyY2hcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5mb2N1c291dChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkKCcucHJlZGljdGl2ZS1ib3gnKS5pcyhcIjpob3ZlclwiKSkge1xuICAgICAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBGaWxsIHNlYXJjaCBiYXIgd2l0aCB3aGF0ZXZlciBhIHVzZXIgc2VsZWN0cyBmcm9tIGxpc3RcbiAgICAkKCcucHJlZGljdGl2ZS1pdGVtJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJy5wcmVkaWN0aXZlLXJlc3VsdHMnKS5odG1sKFwiXCIpO1xuICAgICAgICAkKHRoaXMpLmRhdGEoJ25hbWUnKTtcbiAgICAgICAgJCgnLnByZWRpY3RpdmUtYm94JykuaGlkZSgpO1xuICAgIH0pXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
