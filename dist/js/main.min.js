"use strict";function getData(e){return $.ajax({dataType:"json",url:"https://www.deskbookers.com/nl-nl/sajax.json?q=Amsterdam&type=-&people=any&favorite=0&pid=&sw=52.293753%2C4.634942&ne=52.455562%2C5.162286&ids=17201%2C19640%2C13692%2C13691%2C12136%2C17938%2C15292%2C14886%2C14885%2C14884%2C14883%2C15730%2C15353%2C15351%2C15330%2C15080%2C17290%2C15454%2C15451%2C15379"})}function setDimensionsForResponsiveElements(){$("ul.results-list").css("width",$(".result-item").width()*$(".result-item").length+"px")}function createCarousel(e,t){function a(){var e='\n            <div class="control-wrapper left">\n                <div class="control left-control">\n                    <i class="fa fa-chevron-left" aria-hidden="true"></i>\n                </div>\n            </div>\n            <div class="control-wrapper right">\n                <div class="control right-control">\n                    <i class="fa fa-chevron-right" aria-hidden="true"></i>\n                </div>\n            </div>\n        ';n.append(e),n.find(".right-control").on("click",function(){n.nextImage()}),n.find(".left-control").on("click",function(){n.prevImage()})}var n=$(e);return n.current_image_index=0,n.images=t,n.goToImage=function(e){$(".carousel-item").fadeOut(2e3),$('.carousel-item[data-id="'+e+'"]').fadeIn(2e3),0===n.images.length?n.find(".control").hide():n.find(".control").show()},n.updateSlides=function(e,t){n.images=e,n.find("ul").html(""),e.forEach(function(e,a){"string"==typeof e&&n.find("ul").append('<li \n                    id="image-'+a+'" \n                    data-id="'+a+'" \n                    class="carousel-item" \n                    style="background-image:url(\''+e+'\')">\n                        <h1 class="headline">'+(t[a]||"Headline #"+(a+1))+"</h1>\n                    </li>\n                ")}),n.goToImage(0)},n.nextImage=function(){n.images[n.current_image_index+1]?n.goToImage(++n.current_image_index):(n.goToImage(0),n.current_image_index=0)},n.prevImage=function(){n.images[n.current_image_index-1]?n.goToImage(--n.current_image_index):(n.goToImage(n.images.length-1),n.current_image_index=n.images.length-1)},a(),n.append("<ul></ul>"),n.updateSlides(t,["Fast, Easy, Flexible","Book one of our spaces"]),setInterval(function(){n.is(":hover")||n.nextImage()},6e3),n}function updateResults(e){console.log("Update Results",e),e.map(function(e,t){var a=e.url,n=e.name,o=e.location_name,i=e.rating||"-",r=e.day_price?"€"+e.day_price+"/day":"",s=e.hour_price?"€"+e.hour_price+"/hour":"",l=e.image_urls2[0];$(".results-list").append('<li \n            id="location-'+t+'" \n            class="result-item" \n            style="background-image:url(\''+l+'\'); display: none;">\n                <a href="'+(a||"#")+'">\n                    <ul class="location-info">\n                        <li class="first-line">'+n+"</li>\n                        <li>"+o+"</li>\n                        <li>Score: "+i+"</li>\n                        <li>"+r+"</li>\n                        <li>"+s+"</li>\n                    </ul>\n                </a>\n            </li>"),$("#location-"+t).fadeIn(1e3*t)})}function revealResultsArea(){$("html, body").animate({scrollTop:$(".results-section").height()},1e3)}function createResultsArea(){return{update:updateResults,scrollTo:revealResultsArea}}function createSearchList(e){var t={},a=e.reduce(function(e,t){return e.concat([t.name,t.location_name,t.location_city])},[]).filter(function(e){return!t[e]&&(t[e]=!0,!0)});return a.sort(function(e,t){return e.localeCompare(t)}),a}function predictSearch(e){var t=app.model.location_names.filter(function(t){return t.toLowerCase().includes(e.toLowerCase())});fillPredictor(".predictive-results",t)}function fillPredictor(e,t){var a=$(e);a.html(""),a.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="All">Search all locations..</li>');var n=!0,o=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;a.append('\n            <li data-id="" \n                class="predictive-item"\n                data-name="'+l+'">'+l+"</li>")}}catch(c){o=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw i}}$(".predictive-item").on("click",function(){var e=$(this).data("name");"All"===e?($('#location-search-form input[type="text"]').val(""),processSearch(),revealResultsArea(),$(".predictive-box").hide()):($('#location-search-form input[type="text"]').val(e),$(".predictive-box").hide())})}function createResultsList(e){var t=app.model.raw_data.rows;if(!e)return t;var a=t.filter(function(t){return t.name===e||t.location_name===e||t.location_city===e});return a}function processSearch(e){$(".results-list").html(""),$(".results-section .loader").show(),$('#location-search-form input[type="text"]').val(""),$.when(getData(e)).then(function(t){app.model.raw_data=t,app.model.locations=createResultsList(e),app.components.results_area.update(locations),app.model.locations,setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()}).fail(function(t){console.error("Could not connect to API.","Using session storage..",t),app.model.locations=createResultsList(e),app.components.results_area.update(app.model.locations),setDimensionsForResponsiveElements(),$(".results-section .loader").fadeOut()})}function setEventHandlers(){$("#location-search-form").submit(function(e){var t=$('input[type="text"]').val();e.preventDefault(),t&&(processSearch(t),$('input[type="text"]').val(""),revealResultsArea())}),$('#location-search-form input[type="text"]').focus(function(){$('#location-search-form input[type="text"]').keyup(function(e){var t=$('#location-search-form input[type="text"]').val();predictSearch(t),$(".predictive-box").show(),27==e.keyCode&&($(".predictive-box").hide(),$('#location-search-form input[type="text"]').val(""))})}),$('#location-search-form input[type="text"]').focusout(function(){$(".predictive-box").is(":hover")||$(".predictive-box").hide()}),$(".predictive-item").on("click",function(){$(".predictive-results").html(""),$(this).data("name"),$(".predictive-box").hide()})}var max_results=20,app={model:{raw_data:void 0,locations:void 0,location_names:void 0},components:{main_carousel:void 0,results_area:void 0},init:function(){if(sessionStorage.getItem("location_data")){var e=sessionStorage.getItem("location_data");app.model.raw_data=JSON.parse(e),console.log("Using data from session storage..",app.model.raw_data),app.setUp()}else $(".loader").show(),app.setData()},setData:function(){$.when(getData()).then(function(e){console.log("Retrieved data",e),sessionStorage.setItem("location_data",JSON.stringify(e)),app.model.raw_data=e,app.setUp(),$(".loader").fadeOut()})},setUp:function(){app.model.locations=app.model.raw_data.rows;var e=app.model.locations.slice(0,Math.min(max_results,app.model.locations.length-1)),t=app.model.locations.reduce(function(e,t){return e.concat(t.image_urls)},[]);$(document).ready(function(){app.model.location_names=createSearchList(app.model.raw_data.rows),app.components.main_carousel=createCarousel("carousel",t),app.components.results_area=createResultsArea(),app.components.results_area.update(e),$(".search-box").show(),setEventHandlers(),setDimensionsForResponsiveElements()})}};app.init(),$(window).resize(function(){setDimensionsForResponsiveElements()});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhc2UuanMiLCJjcmVhdGVDYXJvdXNlbC5qcyIsImNyZWF0ZVJlc3VsdHNBcmVhLmpzIiwic2VhcmNoX2Z1bmN0aW9ucy5qcyIsInNldEV2ZW50SGFuZGxlcnMuanMiXSwibmFtZXMiOlsiZ2V0RGF0YSIsInNlYXJjaF9pbnF1aXJ5IiwiJCIsImFqYXgiLCJkYXRhVHlwZSIsInVybCIsInNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMiLCJjc3MiLCJ3aWR0aCIsImxlbmd0aCIsImNyZWF0ZUNhcm91c2VsIiwiZWxlbWVudCIsImltYWdlX2FyciIsImNyZWF0ZUNvbnRyb2xzIiwidGVtcGxhdGUiLCIkY2Fyb3VzZWwiLCJhcHBlbmQiLCJmaW5kIiwib24iLCJuZXh0SW1hZ2UiLCJwcmV2SW1hZ2UiLCJjdXJyZW50X2ltYWdlX2luZGV4IiwiaW1hZ2VzIiwiZ29Ub0ltYWdlIiwiaW5kZXgiLCJmYWRlT3V0IiwiZmFkZUluIiwiaGlkZSIsInNob3ciLCJ1cGRhdGVTbGlkZXMiLCJzbGlkZXMiLCJoZWFkbGluZXMiLCJodG1sIiwiZm9yRWFjaCIsInNldEludGVydmFsIiwiaXMiLCJ1cGRhdGVSZXN1bHRzIiwibG9jYXRpb25zIiwiY29uc29sZSIsImxvZyIsIm1hcCIsImxvY2F0aW9uIiwibG9jYXRpb25fdXJsIiwid29ya3BsYWNlIiwibmFtZSIsImxvY2F0aW9uX25hbWUiLCJyZXZpZXdfc2NvcmUiLCJyYXRpbmciLCJkYXlfcHJpY2UiLCJob3VyX3ByaWNlIiwiaW1hZ2VfdXJsIiwiaW1hZ2VfdXJsczIiLCJyZXZlYWxSZXN1bHRzQXJlYSIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJoZWlnaHQiLCJjcmVhdGVSZXN1bHRzQXJlYSIsInVwZGF0ZSIsInNjcm9sbFRvIiwiY3JlYXRlU2VhcmNoTGlzdCIsInBsYWNlX2hhc2giLCJsb2NhdGlvbl9uYW1lcyIsInJlZHVjZSIsImFsbF9uYW1lcyIsImNvbmNhdCIsImxvY2F0aW9uX2NpdHkiLCJmaWx0ZXIiLCJpdGVtIiwic29ydCIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsInByZWRpY3RTZWFyY2giLCJzdHIiLCJsaXN0IiwiYXBwIiwibW9kZWwiLCJwbGFjZSIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJmaWxsUHJlZGljdG9yIiwiJHByZWRpY3RvciIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24iLCJfZGlkSXRlcmF0b3JFcnJvciIsIl9pdGVyYXRvckVycm9yIiwidW5kZWZpbmVkIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm5leHQiLCJkb25lIiwidmFsdWUiLCJlcnIiLCJ0aGlzIiwiZGF0YSIsInZhbCIsInByb2Nlc3NTZWFyY2giLCJjcmVhdGVSZXN1bHRzTGlzdCIsInJhd19kYXRhIiwicm93cyIsInJlc3VsdHMiLCJ3aGVuIiwidGhlbiIsImNvbXBvbmVudHMiLCJyZXN1bHRzX2FyZWEiLCJmYWlsIiwiZXJyb3IiLCJzZXRFdmVudEhhbmRsZXJzIiwic3VibWl0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiZm9jdXMiLCJrZXl1cCIsImtleUNvZGUiLCJmb2N1c291dCIsIm1heF9yZXN1bHRzIiwibWFpbl9jYXJvdXNlbCIsImluaXQiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJkYXRhU3RyaW5nIiwiSlNPTiIsInBhcnNlIiwic2V0VXAiLCJzZXREYXRhIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsInNsaWNlIiwiTWF0aCIsIm1pbiIsIm1haW5faW1hZ2VzIiwiYWxsX2ltYWdlcyIsImltYWdlX3VybHMiLCJkb2N1bWVudCIsInJlYWR5Iiwid2luZG93IiwicmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLFNBQVFDLEdBR2IsTUFBT0MsR0FBRUMsTUFDTEMsU0FBVSxPQUNWQyxJQUFLLGlUQUliLFFBQVNDLHNDQUlMSixFQUFFLG1CQUFtQkssSUFBSSxRQUFTTCxFQUFFLGdCQUFnQk0sUUFBVU4sRUFBRSxnQkFBZ0JP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T3ZCLEVBQVM0RixnQkFJdENuSSxHQUFFb0ksVUFBVUMsTUFBTSxXQUNkNUQsSUFBSUMsTUFBTWYsZUFBaUJGLGlCQUFpQmdCLElBQUlDLE1BQU11QixTQUFTQyxNQUMvRHpCLElBQUk2QixXQUFXYSxjQUFnQjNHLGVBQWUsV0FBWXlILEdBQzFEeEQsSUFBSTZCLFdBQVdDLGFBQWVqRCxvQkFDOUJtQixJQUFJNkIsV0FBV0MsYUFBYWhELE9BQU9wQixHQUNuQ25DLEVBQUUsZUFBZTBCLE9BQ2pCZ0YsbUJBQ0F0Ryx3Q0FNWnFFLEtBQUkyQyxPQUNKcEgsRUFBRXNJLFFBQVFDLE9BQU8sV0FDYm5JIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBtYXhfcmVzdWx0cyA9IDIwOyAvL1VzZSB0aGlzIG51bWJlciB0byBjYXAgdGhlIGFtb3VudCBvZiBkYXRhIGJlaW5nIHJlcXVlc3RlZCBmcm9tIEFQSVxuXG5mdW5jdGlvbiBnZXREYXRhKHNlYXJjaF9pbnF1aXJ5KSB7XG4gICAgLy8gU2VhcmNoIGlucXVpcnkgd291bGQgYmUgdXNlZCB0byBnZXQgc3BlY2lmaWMgcmVzdWx0cyBmcm9tIEFQSVxuICAgIC8vIEZvciB0aGlzIGNoYWxsZW5nZSwgb25seSB1c2luZyBzcGVjaWZpZWQgcXVlcnkgc3RyaW5nIGJlbG93OlxuICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICAgIHVybDogJ2h0dHBzOi8vd3d3LmRlc2tib29rZXJzLmNvbS9ubC1ubC9zYWpheC5qc29uP3E9QW1zdGVyZGFtJnR5cGU9LSZwZW9wbGU9YW55JmZhdm9yaXRlPTAmcGlkPSZzdz01Mi4yOTM3NTMlMkM0LjYzNDk0MiZuZT01Mi40NTU1NjIlMkM1LjE2MjI4NiZpZHM9MTcyMDElMkMxOTY0MCUyQzEzNjkyJTJDMTM2OTElMkMxMjEzNiUyQzE3OTM4JTJDMTUyOTIlMkMxNDg4NiUyQzE0ODg1JTJDMTQ4ODQlMkMxNDg4MyUyQzE1NzMwJTJDMTUzNTMlMkMxNTM1MSUyQzE1MzMwJTJDMTUwODAlMkMxNzI5MCUyQzE1NDU0JTJDMTU0NTElMkMxNTM3OSdcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpIHtcbiAgICAvLyBTZXQgd2lkdGggb2YgcmVzdWx0cyBsaXN0IGJ5IGZpZ3VyaW5nIG91dCAxLzUgb2Ygd2luZG93IHdpZHRoIFxuICAgIC8vIHRoZW4gbXVsdGlwbHlpbmcgdGhhdCBieSB0aGUgbnVtYmVyIG9mIGl0ZW1zXG4gICAgLy8gR2l2ZXNcbiAgICAkKCd1bC5yZXN1bHRzLWxpc3QnKS5jc3MoJ3dpZHRoJywgJCgnLnJlc3VsdC1pdGVtJykud2lkdGgoKSAqICQoJy5yZXN1bHQtaXRlbScpLmxlbmd0aCArICdweCcpO1xufVxuXG52YXIgYXBwID0ge1xuICAgIC8vIEluaXRpYWxpemUgdGhlIGFwcFxuICAgIC8vIFRoaXMgbGF5cyBvdXQgdGhlIHN0cnVjdHVyZVxuICAgIG1vZGVsOiB7XG4gICAgICAgIHJhd19kYXRhOiB1bmRlZmluZWQsIC8vQWxsIGRhdGEgZnJvbSBzZXJ2ZXJcbiAgICAgICAgbG9jYXRpb25zOiB1bmRlZmluZWQsIC8vQ3VycmVudCByZXN1bHQgZGF0YVxuICAgICAgICBsb2NhdGlvbl9uYW1lczogdW5kZWZpbmVkIC8vUG9zc2libGUgc2VhcmNoIHJlc3VsdHNcbiAgICB9LFxuICAgIGNvbXBvbmVudHM6IHtcbiAgICAgICAgbWFpbl9jYXJvdXNlbDogdW5kZWZpbmVkLCAvLyBcbiAgICAgICAgcmVzdWx0c19hcmVhOiB1bmRlZmluZWRcbiAgICB9LFxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBVc2Ugc2Vzc2lvbiBzdG9yYWdlIGlmIGF2YWlsYWJsZVxuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbG9jYXRpb25fZGF0YScpKSB7XG4gICAgICAgICAgICBsZXQgZGF0YVN0cmluZyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2xvY2F0aW9uX2RhdGEnKTtcbiAgICAgICAgICAgIGFwcC5tb2RlbC5yYXdfZGF0YSA9IEpTT04ucGFyc2UoZGF0YVN0cmluZyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgZGF0YSBmcm9tIHNlc3Npb24gc3RvcmFnZS4uJywgYXBwLm1vZGVsLnJhd19kYXRhKTtcbiAgICAgICAgICAgIGFwcC5zZXRVcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLmxvYWRlcicpLnNob3coKTtcbiAgICAgICAgICAgIGFwcC5zZXREYXRhKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8gR2V0IGFuZCBzZXQgZGF0YSBmcm9tIHRoZSBBUElcbiAgICBzZXREYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJC53aGVuKGdldERhdGEoKSkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUmV0cmlldmVkIGRhdGEnLCBkYXRhKTtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2xvY2F0aW9uX2RhdGEnLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICBhcHAubW9kZWwucmF3X2RhdGEgPSBkYXRhO1xuICAgICAgICAgICAgYXBwLnNldFVwKCk7XG4gICAgICAgICAgICAkKCcubG9hZGVyJykuZmFkZU91dCgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIC8vIFNldCB1cCB2aWV3c1xuICAgIHNldFVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gU2V0IHJlc3VsdCBkYXRhIGZyb20gYWxsIGRhdGFcbiAgICAgICAgYXBwLm1vZGVsLmxvY2F0aW9ucyA9IGFwcC5tb2RlbC5yYXdfZGF0YS5yb3dzO1xuICAgICAgICB2YXIgbG9jYXRpb25zID0gYXBwLm1vZGVsLmxvY2F0aW9ucy5zbGljZSgwLCBNYXRoLm1pbihtYXhfcmVzdWx0cywgYXBwLm1vZGVsLmxvY2F0aW9ucy5sZW5ndGggLSAxKSk7XG5cbiAgICAgICAgLy8gVGhpcyB3YXMgaW5pdGlhbGx5IHNldCB1cCB0byBqdXN0IGhhdmUgYSBjYXJvdXNlbCBmb3Igb25lIGxvY2F0aW9uXG4gICAgICAgIC8vIHZhciBtYWluX2ltYWdlcyA9IGxvY2F0aW9uc1swXS5pbWFnZV91cmxzLmNvbmNhdChsb2NhdGlvbnNbMF0uaW1hZ2VfdXJsczIpO1xuXG4gICAgICAgIHZhciBtYWluX2ltYWdlcyA9IGFwcC5tb2RlbC5sb2NhdGlvbnMucmVkdWNlKGZ1bmN0aW9uKGFsbF9pbWFnZXMsIGxvY2F0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxsX2ltYWdlcy5jb25jYXQobG9jYXRpb24uaW1hZ2VfdXJscyk7XG4gICAgICAgIH0sIFtdKTtcblxuICAgICAgICAvLyBXYWl0IGZvciB0aGUgZG9jdW1ldCByZWFkeSBiZWZvcmUgYnVpbGRpbmcgdmlld3NcbiAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBhcHAubW9kZWwubG9jYXRpb25fbmFtZXMgPSBjcmVhdGVTZWFyY2hMaXN0KGFwcC5tb2RlbC5yYXdfZGF0YS5yb3dzKTtcbiAgICAgICAgICAgIGFwcC5jb21wb25lbnRzLm1haW5fY2Fyb3VzZWwgPSBjcmVhdGVDYXJvdXNlbCgnY2Fyb3VzZWwnLCBtYWluX2ltYWdlcyk7XG4gICAgICAgICAgICBhcHAuY29tcG9uZW50cy5yZXN1bHRzX2FyZWEgPSBjcmVhdGVSZXN1bHRzQXJlYSgpO1xuICAgICAgICAgICAgYXBwLmNvbXBvbmVudHMucmVzdWx0c19hcmVhLnVwZGF0ZShsb2NhdGlvbnMpO1xuICAgICAgICAgICAgJCgnLnNlYXJjaC1ib3gnKS5zaG93KCk7XG4gICAgICAgICAgICBzZXRFdmVudEhhbmRsZXJzKCk7XG4gICAgICAgICAgICBzZXREaW1lbnNpb25zRm9yUmVzcG9uc2l2ZUVsZW1lbnRzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLy8gU3RhcnQgcHJvY2Vzc1xuYXBwLmluaXQoKTtcbiQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG4gICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xufSlcbiIsImZ1bmN0aW9uIGNyZWF0ZUNhcm91c2VsKGVsZW1lbnQsIGltYWdlX2Fycikge1xuXG4gICAgdmFyICRjYXJvdXNlbCA9ICQoZWxlbWVudCk7XG4gICAgJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPSAwOyAvLyBcbiAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gaW1hZ2VfYXJyO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ29udHJvbHMoKSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sLXdyYXBwZXIgbGVmdFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIGxlZnQtY29udHJvbFwiPlxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWNoZXZyb24tbGVmdFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbnRyb2wtd3JhcHBlciByaWdodFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9sIHJpZ2h0LWNvbnRyb2xcIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1jaGV2cm9uLXJpZ2h0XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgJGNhcm91c2VsLmFwcGVuZCh0ZW1wbGF0ZSk7XG5cbiAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwubmV4dEltYWdlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwucHJldkltYWdlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICAkKCcuY2Fyb3VzZWwtaXRlbScpLmZhZGVPdXQoMjAwMCk7XG4gICAgICAgICQoYC5jYXJvdXNlbC1pdGVtW2RhdGEtaWQ9XCIke2luZGV4fVwiXWApLmZhZGVJbigyMDAwKTtcblxuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICAvKlxuICAgICAgICAvLyBVbm5lY2Vzc2FyeSB3aXRoIG5ldyBsb29waW5nIGZlYXR1cmVcbiAgICAgICAgZWxzZSBpZiAoJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICB9IGVsc2UgaWYgKCRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID09PSAkY2Fyb3VzZWwuaW1hZ2VzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcubGVmdC1jb250cm9sJykuc2hvdygpO1xuICAgICAgICAgICAgJGNhcm91c2VsLmZpbmQoJy5yaWdodC1jb250cm9sJykuaGlkZSgpO1xuICAgICAgICB9IFxuICAgICAgICAqL1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCcuY29udHJvbCcpLnNob3coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC51cGRhdGVTbGlkZXMgPSBmdW5jdGlvbihzbGlkZXMsIGhlYWRsaW5lcykge1xuICAgICAgICAkY2Fyb3VzZWwuaW1hZ2VzID0gc2xpZGVzO1xuICAgICAgICAkY2Fyb3VzZWwuZmluZCgndWwnKS5odG1sKFwiXCIpO1xuICAgICAgICBzbGlkZXMuZm9yRWFjaChmdW5jdGlvbih1cmwsIGluZGV4KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHsgLy8gVHlwZSBjaGVja1xuICAgICAgICAgICAgICAgICRjYXJvdXNlbC5maW5kKCd1bCcpLmFwcGVuZChgPGxpIFxuICAgICAgICAgICAgICAgICAgICBpZD1cImltYWdlLSR7aW5kZXh9XCIgXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtaWQ9XCIke2luZGV4fVwiIFxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImNhcm91c2VsLWl0ZW1cIiBcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHt1cmx9JylcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzcz1cImhlYWRsaW5lXCI+JHtoZWFkbGluZXNbaW5kZXhdIHx8IFwiSGVhZGxpbmUgI1wiICsgKGluZGV4KzEpfTwvaDE+XG4gICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoMCk7XG4gICAgfVxuXG4gICAgJGNhcm91c2VsLm5leHRJbWFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoJGNhcm91c2VsLmltYWdlc1skY2Fyb3VzZWwuY3VycmVudF9pbWFnZV9pbmRleCArIDFdKSB7XG4gICAgICAgICAgICAkY2Fyb3VzZWwuZ29Ub0ltYWdlKCsrJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTG9vcFxuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgwKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRjYXJvdXNlbC5wcmV2SW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRjYXJvdXNlbC5pbWFnZXNbJGNhcm91c2VsLmN1cnJlbnRfaW1hZ2VfaW5kZXggLSAxXSkge1xuICAgICAgICAgICAgJGNhcm91c2VsLmdvVG9JbWFnZSgtLSRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIExvb3BcbiAgICAgICAgICAgICRjYXJvdXNlbC5nb1RvSW1hZ2UoJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICRjYXJvdXNlbC5jdXJyZW50X2ltYWdlX2luZGV4ID0gJGNhcm91c2VsLmltYWdlcy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY3JlYXRlQ29udHJvbHMoKTtcbiAgICAkY2Fyb3VzZWwuYXBwZW5kKCc8dWw+PC91bD4nKTtcbiAgICAkY2Fyb3VzZWwudXBkYXRlU2xpZGVzKGltYWdlX2FyciwgW1wiRmFzdCwgRWFzeSwgRmxleGlibGVcIiwgXCJCb29rIG9uZSBvZiBvdXIgc3BhY2VzXCJdKTtcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCEkY2Fyb3VzZWwuaXMoXCI6aG92ZXJcIikpIHtcbiAgICAgICAgICAgICRjYXJvdXNlbC5uZXh0SW1hZ2UoKTtcbiAgICAgICAgfVxuICAgIH0sIDYwMDApO1xuICAgIHJldHVybiAkY2Fyb3VzZWw7XG59IiwiZnVuY3Rpb24gdXBkYXRlUmVzdWx0cyhsb2NhdGlvbnMpIHtcbiAgICAvLyBGaWxsIHJlc3VsdHMgZGl2XG4gICAgY29uc29sZS5sb2coJ1VwZGF0ZSBSZXN1bHRzJywgbG9jYXRpb25zKTtcbiAgICBsb2NhdGlvbnMubWFwKGZ1bmN0aW9uKGxvY2F0aW9uLCBpbmRleCkge1xuICAgICAgICBsZXQgbG9jYXRpb25fdXJsID0gbG9jYXRpb24udXJsO1xuICAgICAgICBsZXQgd29ya3BsYWNlID0gbG9jYXRpb24ubmFtZTtcbiAgICAgICAgbGV0IGxvY2F0aW9uX25hbWUgPSBsb2NhdGlvbi5sb2NhdGlvbl9uYW1lO1xuICAgICAgICBsZXQgcmV2aWV3X3Njb3JlID0gbG9jYXRpb24ucmF0aW5nIHx8IFwiLVwiO1xuICAgICAgICBsZXQgZGF5X3ByaWNlID0gKGxvY2F0aW9uLmRheV9wcmljZSkgPyAn4oKsJyArIGxvY2F0aW9uLmRheV9wcmljZSArIFwiL2RheVwiIDogXCJcIjtcbiAgICAgICAgbGV0IGhvdXJfcHJpY2UgPSAobG9jYXRpb24uaG91cl9wcmljZSkgPyAn4oKsJyArIGxvY2F0aW9uLmhvdXJfcHJpY2UgKyBcIi9ob3VyXCIgOiBcIlwiO1xuICAgICAgICBsZXQgaW1hZ2VfdXJsID0gbG9jYXRpb24uaW1hZ2VfdXJsczJbMF07IC8vIFVzZSBzbWFsbGVyIHRodW1ic1xuXG4gICAgICAgICQoJy5yZXN1bHRzLWxpc3QnKS5hcHBlbmQoYDxsaSBcbiAgICAgICAgICAgIGlkPVwibG9jYXRpb24tJHtpbmRleH1cIiBcbiAgICAgICAgICAgIGNsYXNzPVwicmVzdWx0LWl0ZW1cIiBcbiAgICAgICAgICAgIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTp1cmwoJyR7aW1hZ2VfdXJsfScpOyBkaXNwbGF5OiBub25lO1wiPlxuICAgICAgICAgICAgICAgIDxhIGhyZWY9XCIke2xvY2F0aW9uX3VybCB8fCBcIiNcIn1cIj5cbiAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPVwibG9jYXRpb24taW5mb1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPVwiZmlyc3QtbGluZVwiPiR7d29ya3BsYWNlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHtsb2NhdGlvbl9uYW1lfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+U2NvcmU6ICR7cmV2aWV3X3Njb3JlfTwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGk+JHtkYXlfcHJpY2V9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4ke2hvdXJfcHJpY2V9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICA8L2xpPmApO1xuICAgICAgICAkKCcjbG9jYXRpb24tJytpbmRleCkuZmFkZUluKDEwMDAgKiBpbmRleCk7IC8vIENyZWF0ZXMgY29vbCBwcm9ncmVzc2l2ZSBmYWRlIGluXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldmVhbFJlc3VsdHNBcmVhKCkge1xuICAgIC8vIFNjcm9sbCBkb3duIHRvIGRpc3BsYXkgcmVzdWx0c1xuICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiAkKFwiLnJlc3VsdHMtc2VjdGlvblwiKS5oZWlnaHQoKVxuICAgICB9LCAxMDAwKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVzdWx0c0FyZWEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdXBkYXRlOiB1cGRhdGVSZXN1bHRzLFxuICAgICAgICBzY3JvbGxUbzogcmV2ZWFsUmVzdWx0c0FyZWFcbiAgICB9XG59IiwiZnVuY3Rpb24gY3JlYXRlU2VhcmNoTGlzdChsb2NhdGlvbnMpIHtcbiAgICBsZXQgcGxhY2VfaGFzaCA9IHt9O1xuICAgIC8vIENyZWF0ZSBhIGxpc3Qgb2YgcGxhY2VzIHRvIHNlYXJjaFxuICAgIGxldCBsb2NhdGlvbl9uYW1lcyA9IGxvY2F0aW9ucy5yZWR1Y2UoZnVuY3Rpb24oYWxsX25hbWVzLCBsb2NhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGFsbF9uYW1lcy5jb25jYXQoW2xvY2F0aW9uLm5hbWUsIGxvY2F0aW9uLmxvY2F0aW9uX25hbWUsIGxvY2F0aW9uLmxvY2F0aW9uX2NpdHldKTtcbiAgICAgICAgfSwgW10pXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgaWYgKCFwbGFjZV9oYXNoW2l0ZW1dKSB7XG4gICAgICAgICAgICAgICAgcGxhY2VfaGFzaFtpdGVtXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAvLyBTb3J0IGxpc3QgYW5kIHJldHVyblxuICAgIGxvY2F0aW9uX25hbWVzLnNvcnQoKGEsIGIpID0+IGEubG9jYWxlQ29tcGFyZShiKSk7XG4gICAgcmV0dXJuIGxvY2F0aW9uX25hbWVzO1xufVxuXG5mdW5jdGlvbiBwcmVkaWN0U2VhcmNoKHN0cikge1xuICAgIC8vIFByZWRpY3QgYnkgbG9jYXRpb24gbmFtZVxuICAgIC8vIEZpbHRlciBsaXN0IGJ5IGlucHV0IHN0cmluZ1xuICAgIGxldCBsaXN0ID0gYXBwLm1vZGVsLmxvY2F0aW9uX25hbWVzLmZpbHRlcihmdW5jdGlvbihwbGFjZSkge1xuICAgICAgICAvLyBUaGVyZSBpcyBwcm9iYWJseSBhIGJldHRlciB3YXkgdG8gZG8gdGhpcyB3aXRoIGEgdHJpZVxuICAgICAgICByZXR1cm4gcGxhY2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzdHIudG9Mb3dlckNhc2UoKSk7XG4gICAgfSk7XG5cbiAgICAvLyBGdWxsIHByZWRpY3RvciB3aXRoIG9ubHkgdG9wIDUgcmVzdWx0c1xuICAgIGZpbGxQcmVkaWN0b3IoJy5wcmVkaWN0aXZlLXJlc3VsdHMnLCBsaXN0KTtcbn1cblxuZnVuY3Rpb24gZmlsbFByZWRpY3RvcihlbGVtZW50LCBsaXN0KSB7XG4gICAgdmFyICRwcmVkaWN0b3IgPSAkKGVsZW1lbnQpO1xuICAgICRwcmVkaWN0b3IuaHRtbChcIlwiKTtcbiAgICAkcHJlZGljdG9yLmFwcGVuZChgXG4gICAgICAgICAgICA8bGkgZGF0YS1pZD1cIlwiIFxuICAgICAgICAgICAgICAgIGNsYXNzPVwicHJlZGljdGl2ZS1pdGVtXCJcbiAgICAgICAgICAgICAgICBkYXRhLW5hbWU9XCJBbGxcIj5TZWFyY2ggYWxsIGxvY2F0aW9ucy4uPC9saT5gKTtcbiAgICBmb3IgKGxldCBsb2NhdGlvbiBvZiBsaXN0KSB7XG4gICAgICAgICRwcmVkaWN0b3IuYXBwZW5kKGBcbiAgICAgICAgICAgIDxsaSBkYXRhLWlkPVwiXCIgXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJwcmVkaWN0aXZlLWl0ZW1cIlxuICAgICAgICAgICAgICAgIGRhdGEtbmFtZT1cIiR7bG9jYXRpb259XCI+JHtsb2NhdGlvbn08L2xpPmApO1xuICAgIH1cblxuICAgIC8vIFNldCBoYW5kbGVyXG4gICAgJCgnLnByZWRpY3RpdmUtaXRlbScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBsZXQgbmFtZSA9ICQodGhpcykuZGF0YSgnbmFtZScpO1xuICAgICAgICBpZiAobmFtZSA9PT0gXCJBbGxcIikge1xuICAgICAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICAgICAgICAgcHJvY2Vzc1NlYXJjaCgpO1xuICAgICAgICAgICAgcmV2ZWFsUmVzdWx0c0FyZWEoKTtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbChuYW1lKTtcbiAgICAgICAgICAgICQoJy5wcmVkaWN0aXZlLWJveCcpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlc3VsdHNMaXN0KHN0cikge1xuICAgIGxldCBsb2NhdGlvbnMgPSBhcHAubW9kZWwucmF3X2RhdGEucm93cztcbiAgICBpZiAoIXN0cikgcmV0dXJuIGxvY2F0aW9uczsgLy8gSWYgbm8gc2VhcmNoIGNyaXRlcmlhLCByZXR1cm4gd2hvbGUgbGlzdFxuICAgIGxldCByZXN1bHRzID0gbG9jYXRpb25zLmZpbHRlcihmdW5jdGlvbihsb2NhdGlvbikge1xuICAgICAgICBpZihsb2NhdGlvbi5uYW1lID09PSBzdHIgfHwgXG4gICAgICAgICAgIGxvY2F0aW9uLmxvY2F0aW9uX25hbWUgPT09IHN0ciB8fFxuICAgICAgICAgICBsb2NhdGlvbi5sb2NhdGlvbl9jaXR5ID09PSBzdHIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbn1cblxuZnVuY3Rpb24gcHJvY2Vzc1NlYXJjaChzdHIpIHtcbiAgICAvLyBGaXJzdCBjbGVhciByZXN1bHRzIGFuZCBzaG93IGxvYWRlclxuICAgICQoJy5yZXN1bHRzLWxpc3QnKS5odG1sKFwiXCIpO1xuICAgICQoJy5yZXN1bHRzLXNlY3Rpb24gLmxvYWRlcicpLnNob3coKTtcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS52YWwoXCJcIik7XG4gICAgXG4gICAgJC53aGVuKGdldERhdGEoc3RyKSkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIC8vIFByZXRlbmQgdG8gZ2V0IG5ldyBzZWFyY2ggcmVzdWx0cyB3aXRoIG5ldyBxdWVyeVxuICAgICAgICAvLyBhbmQgdXBkYXRlIG1vZGVsXG4gICAgICAgIGFwcC5tb2RlbC5yYXdfZGF0YSA9IGRhdGE7XG4gICAgICAgIGFwcC5tb2RlbC5sb2NhdGlvbnMgPSBjcmVhdGVSZXN1bHRzTGlzdChzdHIpO1xuXG4gICAgICAgIC8vIFVwZGF0ZSByZXN1bHRzIGFuZCByZXNldCByZXNwb25zaXZlIGVsZW1lbnRzXG4gICAgICAgIGFwcC5jb21wb25lbnRzLnJlc3VsdHNfYXJlYS51cGRhdGUobG9jYXRpb25zKTsoYXBwLm1vZGVsLmxvY2F0aW9ucyk7XG4gICAgICAgIHNldERpbWVuc2lvbnNGb3JSZXNwb25zaXZlRWxlbWVudHMoKTtcbiAgICAgICAgLy8gSGlkZSBsb2FkZXIgYWZ0ZXIgbG9hZGluZyBuZXcgcmVzdWx0c1xuICAgICAgICAkKCcucmVzdWx0cy1zZWN0aW9uIC5sb2FkZXInKS5mYWRlT3V0KCk7XG4gICAgfSkuZmFpbChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IGNvbm5lY3QgdG8gQVBJLlwiLFwiVXNpbmcgc2Vzc2lvbiBzdG9yYWdlLi5cIiwgZXJyb3IpO1xuICAgICAgICBhcHAubW9kZWwubG9jYXRpb25zID0gY3JlYXRlUmVzdWx0c0xpc3Qoc3RyKTtcbiAgICAgICAgLy8gVXBkYXRlIHJlc3VsdHMgYW5kIHJlc2V0IHJlc3BvbnNpdmUgZWxlbWVudHNcbiAgICAgICAgYXBwLmNvbXBvbmVudHMucmVzdWx0c19hcmVhLnVwZGF0ZShhcHAubW9kZWwubG9jYXRpb25zKTtcbiAgICAgICAgc2V0RGltZW5zaW9uc0ZvclJlc3BvbnNpdmVFbGVtZW50cygpO1xuICAgICAgICAvLyBIaWRlIGxvYWRlciBhZnRlciBsb2FkaW5nIG5ldyByZXN1bHRzXG4gICAgICAgICQoJy5yZXN1bHRzLXNlY3Rpb24gLmxvYWRlcicpLmZhZGVPdXQoKTtcbiAgICB9KTtcblxufSIsImZ1bmN0aW9uIHNldEV2ZW50SGFuZGxlcnMoKSB7XG4gICAgLy8gU2VhcmNoIGZvcm1cbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZSkge1xuICAgICAgICBsZXQgc2VhcmNoX2lucXVpcnkgPSAkKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpLnZhbCgpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmKHNlYXJjaF9pbnF1aXJ5KSB7XG4gICAgICAgICAgICBwcm9jZXNzU2VhcmNoKHNlYXJjaF9pbnF1aXJ5KTtcbiAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICAgICAgICAgcmV2ZWFsUmVzdWx0c0FyZWEoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2VhcmNoIGZvcm0gcHJlZGljdGl2ZSBzZWFyY2hcbiAgICAkKCcjbG9jYXRpb24tc2VhcmNoLWZvcm0gaW5wdXRbdHlwZT1cInRleHRcIl0nKS5mb2N1cyhmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gV2hlbiBmb2N1cyBpcyBvbiBzZWFyY2ggaW5wdXRcbiAgICAgICAgLy8gRXZhbHVhdGUgc3RyaW5nIG9uIGtleXVwIC0ga2V5ZG93biBmaXJlcyBiZWZvcmUgdGV4dCBpcyBhdmFpbGFibGVcbiAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykua2V5dXAoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgbGV0IHNlYXJjaF9pbnF1aXJ5ID0gJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdLZXkgRG93bicpO1xuICAgICAgICAgICAgcHJlZGljdFNlYXJjaChzZWFyY2hfaW5xdWlyeSk7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5zaG93KCk7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDI3KSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlciBwcmVzc2VkIGVzYyBrZXlcbiAgICAgICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJCgnI2xvY2F0aW9uLXNlYXJjaC1mb3JtIGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0pO1xuXG4gICAgLy8gSGlkZSBwcmVkaWN0aW9uIGJveCB3aGVuIGZvY3VzIGlzbid0IG9uIHNlYXJjaFxuICAgICQoJyNsb2NhdGlvbi1zZWFyY2gtZm9ybSBpbnB1dFt0eXBlPVwidGV4dFwiXScpLmZvY3Vzb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoISQoJy5wcmVkaWN0aXZlLWJveCcpLmlzKFwiOmhvdmVyXCIpKSB7XG4gICAgICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEZpbGwgc2VhcmNoIGJhciB3aXRoIHdoYXRldmVyIGEgdXNlciBzZWxlY3RzIGZyb20gbGlzdFxuICAgICQoJy5wcmVkaWN0aXZlLWl0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnLnByZWRpY3RpdmUtcmVzdWx0cycpLmh0bWwoXCJcIik7XG4gICAgICAgICQodGhpcykuZGF0YSgnbmFtZScpO1xuICAgICAgICAkKCcucHJlZGljdGl2ZS1ib3gnKS5oaWRlKCk7XG4gICAgfSlcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
